import{a as K_,b as Tc,c as zh,d as Ac,e as wo,f as Gh,g as bc,h as Cc,i as H_,j as Wh,k as Ce,l as Pn,m as rn,n as Sc,o as Vr,p as Eo,q as Rc,r as Ri,s as Pc,t as Je,u as At,v as Kh}from"./chunk-XYUT62KH.js";import{$ as Q,$a as Qe,$b as Q_,A as Kn,Aa as dc,Ab as N_,B as xr,Ba as w_,Bb as V_,C as Ph,Ca as ho,Cb as Ci,D as xt,Da as Ie,Db as O_,E as l_,Ea as Z,Eb as Nr,F as h_,Fa as fc,Fb as F_,G as oo,Ga as pc,Gb as L_,H as Yt,Ha as bi,Hb as ct,I as Dh,Ia as fo,Ib as U_,J as d_,Ja as po,Jb as _o,K as lc,Ka as de,Kb as j_,L as Ei,La as Oh,Lb as B_,M as kh,Ma as E_,Mb as vo,N as Ii,Na as Qn,Nb as qh,O as xe,Oa as I_,Ob as $_,P as xh,Pa as T_,Pb as nn,Q as f_,Qa as Fh,Qb as q_,R as Re,Ra as Lh,Rb as Si,S as Ee,Sa as $t,Sb as z_,T as Hn,Ta as gc,Tb as Rn,U as ao,Ua as je,Ub as G_,V as ee,Va as Uh,Vb as W_,W as We,Wa as q,X as p_,Xa as L,Y as re,Ya as Oe,Z as Mh,Za as Sn,_ as O,_a as _e,a as n_,aa as Ke,ab as A_,ac as Io,b as r_,ba as g_,bb as B,bc as Dc,c as Dt,ca as co,cb as tn,d as bh,da as bn,db as Xn,e as Ch,ea as Me,eb as go,f as Jt,fa as He,fb as b_,g as kt,ga as yt,gb as C_,gc as X_,h as cc,ha as Mt,hb as S_,hc as kc,i as i_,ia as m_,ib as R_,j as Gn,ja as Ti,jb as mo,jc as J_,k as Wn,ka as Cn,kb as P_,l as kr,la as Mr,lb as mc,m as ge,ma as jt,mb as D_,n as J,na as Bt,nb as yc,o as so,oa as Ai,ob as _c,oc as Y_,p as s_,pa as y_,pb as jh,q as o_,qa as Zt,qb as vc,r as Y,ra as Nh,rb as Bh,s as uc,sa as uo,sb as wc,t as Et,ta as en,tb as yo,u as Sh,ua as __,ub as k_,v as a_,va as hc,vb as Ec,w as Rh,wa as v_,wb as x_,x as c_,xa as Tt,xb as $h,y as u_,ya as lo,yb as Ic,z as It,za as Vh,zb as M_}from"./chunk-ZMP2LM6Q.js";import{a as z,b as ye,c as t_,e as Ah,f as R}from"./chunk-CQCHLVVT.js";var Mc=class n{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let r=t.indexOf(":");if(r>0){let i=t.slice(0,r),s=i.toLowerCase(),o=t.slice(r+1).trim();this.maybeSetNormalizedName(i,s),this.headers.has(s)?this.headers.get(s).push(o):this.headers.set(s,[o])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(e.name,t);let i=(e.op==="a"?this.headers.get(t):void 0)||[];i.push(...r),this.headers.set(t,i);break;case"d":let s=e.value;if(!s)this.headers.delete(t),this.normalizedNames.delete(t);else{let o=this.headers.get(t);if(!o)return;o=o.filter(c=>s.indexOf(c)===-1),o.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}break}}setHeaderEntries(e,t){let r=(Array.isArray(t)?t:[t]).map(s=>s.toString()),i=e.toLowerCase();this.headers.set(i,r),this.maybeSetNormalizedName(e,i)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var ov=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(ov||{}),Hh=class{constructor(e,t=av.Ok,r="OK"){this.headers=e.headers||new Mc,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}};var Nc=class n extends Hh{constructor(e={}){super(e),this.type=ov.Response,this.body=e.body!==void 0?e.body:null}clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}};var av=function(n){return n[n.Continue=100]="Continue",n[n.SwitchingProtocols=101]="SwitchingProtocols",n[n.Processing=102]="Processing",n[n.EarlyHints=103]="EarlyHints",n[n.Ok=200]="Ok",n[n.Created=201]="Created",n[n.Accepted=202]="Accepted",n[n.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",n[n.NoContent=204]="NoContent",n[n.ResetContent=205]="ResetContent",n[n.PartialContent=206]="PartialContent",n[n.MultiStatus=207]="MultiStatus",n[n.AlreadyReported=208]="AlreadyReported",n[n.ImUsed=226]="ImUsed",n[n.MultipleChoices=300]="MultipleChoices",n[n.MovedPermanently=301]="MovedPermanently",n[n.Found=302]="Found",n[n.SeeOther=303]="SeeOther",n[n.NotModified=304]="NotModified",n[n.UseProxy=305]="UseProxy",n[n.Unused=306]="Unused",n[n.TemporaryRedirect=307]="TemporaryRedirect",n[n.PermanentRedirect=308]="PermanentRedirect",n[n.BadRequest=400]="BadRequest",n[n.Unauthorized=401]="Unauthorized",n[n.PaymentRequired=402]="PaymentRequired",n[n.Forbidden=403]="Forbidden",n[n.NotFound=404]="NotFound",n[n.MethodNotAllowed=405]="MethodNotAllowed",n[n.NotAcceptable=406]="NotAcceptable",n[n.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",n[n.RequestTimeout=408]="RequestTimeout",n[n.Conflict=409]="Conflict",n[n.Gone=410]="Gone",n[n.LengthRequired=411]="LengthRequired",n[n.PreconditionFailed=412]="PreconditionFailed",n[n.PayloadTooLarge=413]="PayloadTooLarge",n[n.UriTooLong=414]="UriTooLong",n[n.UnsupportedMediaType=415]="UnsupportedMediaType",n[n.RangeNotSatisfiable=416]="RangeNotSatisfiable",n[n.ExpectationFailed=417]="ExpectationFailed",n[n.ImATeapot=418]="ImATeapot",n[n.MisdirectedRequest=421]="MisdirectedRequest",n[n.UnprocessableEntity=422]="UnprocessableEntity",n[n.Locked=423]="Locked",n[n.FailedDependency=424]="FailedDependency",n[n.TooEarly=425]="TooEarly",n[n.UpgradeRequired=426]="UpgradeRequired",n[n.PreconditionRequired=428]="PreconditionRequired",n[n.TooManyRequests=429]="TooManyRequests",n[n.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",n[n.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",n[n.InternalServerError=500]="InternalServerError",n[n.NotImplemented=501]="NotImplemented",n[n.BadGateway=502]="BadGateway",n[n.ServiceUnavailable=503]="ServiceUnavailable",n[n.GatewayTimeout=504]="GatewayTimeout",n[n.HttpVersionNotSupported=505]="HttpVersionNotSupported",n[n.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",n[n.InsufficientStorage=507]="InsufficientStorage",n[n.LoopDetected=508]="LoopDetected",n[n.NotExtended=510]="NotExtended",n[n.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",n}(av||{});var IA=new re("");var Z_="b",ev="h",tv="s",nv="st",rv="u",iv="rt",xc=new re(""),TA=["GET","HEAD"];function AA(n,e){let p=Q(xc),{isCacheActive:t}=p,r=t_(p,["isCacheActive"]),{transferCache:i,method:s}=n;if(!t||s==="POST"&&!r.includePostRequests&&!i||s!=="POST"&&!TA.includes(s)||i===!1||r.filter?.(n)===!1)return e(n);let o=Q(dc),c=CA(n),u=o.get(c,null),l=r.includeHeaders;if(typeof i=="object"&&i.includeHeaders&&(l=i.includeHeaders),u){let{[Z_]:m,[iv]:E,[ev]:k,[tv]:x,[nv]:D,[rv]:$}=u,K=m;switch(E){case"arraybuffer":K=new TextEncoder().encode(m).buffer;break;case"blob":K=new Blob([m]);break}let V=new Mc(k);return J(new Nc({body:K,headers:V,status:x,statusText:D,url:$}))}let f=Rn(Q(Tt));return e(n).pipe(Re(m=>{m instanceof Nc&&f&&o.set(c,{[Z_]:m.body,[ev]:bA(m.headers,l),[tv]:m.status,[nv]:m.statusText,[rv]:m.url||"",[iv]:n.responseType})}))}function bA(n,e){if(!e)return{};let t={};for(let r of e){let i=n.getAll(r);i!==null&&(t[r]=i)}return t}function sv(n){return[...n.keys()].sort().map(e=>`${e}=${n.getAll(e)}`).join("&")}function CA(n){let{params:e,method:t,responseType:r,url:i}=n,s=sv(e),o=n.serializeBody();o instanceof URLSearchParams?o=sv(o):typeof o!="string"&&(o="");let c=[t,r,i,o,s].join("|"),u=SA(c);return u}function SA(n){let e=0;for(let t of n)e=Math.imul(31,e)+t.charCodeAt(0)<<0;return e+=2147483648,e.toString()}function cv(n){return[{provide:xc,useFactory:()=>(po("NgHttpTransferCache"),z({isCacheActive:!0},n))},{provide:IA,useValue:AA,multi:!0,deps:[dc,xc]},{provide:wc,multi:!0,useFactory:()=>{let e=Q(yo),t=Q(xc);return()=>{k_(e).then(()=>{t.isCacheActive=!1})}}}]}var Jh=class extends L_{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Yh=class n extends Jh{static makeCurrent(){F_(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=PA();return t==null?null:DA(t)}resetBaseElement(){To=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return qh(document.cookie,e)}},To=null;function PA(){return To=To||document.querySelector("base"),To?To.getAttribute("href"):null}function DA(n){return new URL(n,document.baseURI).pathname}var Zh=class{addToWindow(e){Hn.getAngularTestability=(r,i=!0)=>{let s=e.findTestabilityInTree(r,i);if(s==null)throw new Ee(5103,!1);return s},Hn.getAllAngularTestabilities=()=>e.getAllTestabilities(),Hn.getAllAngularRootElements=()=>e.getAllRootElements();let t=r=>{let i=Hn.getAllAngularTestabilities(),s=i.length,o=function(){s--,s==0&&r()};i.forEach(c=>{c.whenStable(o)})};Hn.frameworkStabilizers||(Hn.frameworkStabilizers=[]),Hn.frameworkStabilizers.push(t)}findTestabilityInTree(e,t,r){if(t==null)return null;let i=e.getTestability(t);return i??(r?Nr().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},kA=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:e.\u0275fac});let n=e;return n})(),ed=new re(""),hv=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new Ee(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(O(ed),O(de))},e.\u0275prov=ee({token:e,factory:e.\u0275fac});let n=e;return n})(),Vc=class{constructor(e){this._doc=e}},Qh="ng-app-id",dv=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Rn(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${Qh}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(Qh),o;{let c=this.doc.createElement("style");return this.nonce&&c.setAttribute("nonce",this.nonce),c.textContent=i,this.platformIsServer&&c.setAttribute(Qh,this.appId),r.appendChild(c),c}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,c=o.get(i)?.elements;c?c.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(O(ct),O(hc),O(Vh,8),O(Tt))},e.\u0275prov=ee({token:e,factory:e.\u0275fac});let n=e;return n})(),Xh={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},rd=/%COMP%/g,fv="%COMP%",xA=`_nghost-${fv}`,MA=`_ngcontent-${fv}`,NA=!0,VA=new re("",{providedIn:"root",factory:()=>NA});function OA(n){return MA.replace(rd,n)}function FA(n){return xA.replace(rd,n)}function pv(n,e){return e.map(t=>t.replace(rd,n))}var Pi=(()=>{let e=class e{constructor(r,i,s,o,c,u,l,f=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=c,this.platformId=u,this.ngZone=l,this.nonce=f,this.rendererByCompId=new Map,this.platformIsServer=Rn(u),this.defaultRenderer=new Ao(r,c,l,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===co.ShadowDom&&(i=ye(z({},i),{encapsulation:co.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof Oc?s.applyToHost(r):s instanceof bo&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let c=this.doc,u=this.ngZone,l=this.eventManager,f=this.sharedStylesHost,p=this.removeStylesOnCompDestroy,m=this.platformIsServer;switch(i.encapsulation){case co.Emulated:o=new Oc(l,f,i,this.appId,p,c,u,m);break;case co.ShadowDom:return new td(l,f,r,i,c,u,this.nonce,m);default:o=new bo(l,f,i,p,c,u,m);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(O(hv),O(dv),O(hc),O(VA),O(ct),O(Tt),O(de),O(Vh))},e.\u0275prov=ee({token:e,factory:e.\u0275fac});let n=e;return n})(),Ao=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(Xh[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(uv(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(uv(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new Ee(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=Xh[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=Xh[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(ho.DashCase|ho.Important)?e.style.setProperty(t,r,i&ho.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&ho.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=Nr().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function uv(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var td=class extends Ao{constructor(e,t,r,i,s,o,c,u){super(e,s,o,u),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let l=pv(i.id,i.styles);for(let f of l){let p=document.createElement("style");c&&p.setAttribute("nonce",c),p.textContent=f,this.shadowRoot.appendChild(p)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},bo=class extends Ao{constructor(e,t,r,i,s,o,c,u){super(e,s,o,c),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=u?pv(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Oc=class extends bo{constructor(e,t,r,i,s,o,c,u){let l=i+"-"+r.id;super(e,t,r,s,o,c,u,l),this.contentAttr=OA(l),this.hostAttr=FA(l)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},LA=(()=>{let e=class e extends Vc{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(O(ct))},e.\u0275prov=ee({token:e,factory:e.\u0275fac});let n=e;return n})(),lv=["alt","control","meta","shift"],UA={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},jA={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},BA=(()=>{let e=class e extends Vc{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),c=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Nr().onAndCancel(r,o.domEventName,c))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),c="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),c="code."),lv.forEach(f=>{let p=i.indexOf(f);p>-1&&(i.splice(p,1),c+=f+".")}),c+=o,i.length!=0||o.length===0)return null;let l={};return l.domEventName=s,l.fullKey=c,l}static matchEventFullKeyCode(r,i){let s=UA[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),lv.forEach(c=>{if(c!==s){let u=jA[c];u(r)&&(o+=c+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(O(ct))},e.\u0275prov=ee({token:e,factory:e.\u0275fac});let n=e;return n})();function $A(){Yh.makeCurrent()}function qA(){return new Nh}function zA(){return __(document),document}var GA=[{provide:Tt,useValue:z_},{provide:v_,useValue:$A,multi:!0},{provide:ct,useFactory:zA,deps:[]}],gv=x_(M_,"browser",GA),WA=new re(""),KA=[{provide:yc,useClass:Zh,deps:[]},{provide:D_,useClass:_c,deps:[de,jh,yc]},{provide:_c,useClass:_c,deps:[de,jh,yc]}],HA=[{provide:m_,useValue:"root"},{provide:Nh,useFactory:qA,deps:[]},{provide:ed,useClass:LA,multi:!0,deps:[ct,de,Tt]},{provide:ed,useClass:BA,multi:!0,deps:[ct]},Pi,dv,hv,{provide:bi,useExisting:Pi},{provide:W_,useClass:kA,deps:[]},[]],Fc=(()=>{let e=class e{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:hc,useValue:r.appId}]}}};e.\u0275fac=function(i){return new(i||e)(O(WA,12))},e.\u0275mod=He({type:e}),e.\u0275inj=We({providers:[...HA,...KA],imports:[Si,N_]});let n=e;return n})();var mv=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(O(ct))},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var nd=function(n){return n[n.NoHttpTransferCache=0]="NoHttpTransferCache",n[n.HttpTransferCacheOptions=1]="HttpTransferCacheOptions",n}(nd||{});function yv(...n){let e=[],t=new Set,r=t.has(nd.HttpTransferCacheOptions);for(let{\u0275providers:i,\u0275kind:s}of n)t.add(s),i.length&&e.push(i);return Mt([[],V_(),t.has(nd.NoHttpTransferCache)||r?[]:cv({}),e])}var oe="primary",Bo=Symbol("RouteTitle"),cd=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function Ni(n){return new cd(n)}function QA(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],c=n[s];if(o.startsWith(":"))i[o.substring(1)]=c;else if(o!==c.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function XA(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!sn(n[t],e[t]))return!1;return!0}function sn(n,e){let t=n?ud(n):void 0,r=e?ud(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!Sv(n[i],e[i]))return!1;return!0}function ud(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function Sv(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function Rv(n){return n.length>0?n[n.length-1]:null}function er(n){return s_(n)?n:vc(n)?ge(Promise.resolve(n)):J(n)}var JA={exact:Dv,subset:kv},Pv={exact:YA,subset:ZA,ignored:()=>!0};function vv(n,e,t){return JA[t.paths](n.root,e.root,t.matrixParams)&&Pv[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function YA(n,e){return sn(n,e)}function Dv(n,e,t){if(!Fr(n.segments,e.segments)||!jc(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!Dv(n.children[r],e.children[r],t))return!1;return!0}function ZA(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>Sv(n[t],e[t]))}function kv(n,e,t){return xv(n,e,e.segments,t)}function xv(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!Fr(i,t)||e.hasChildren()||!jc(i,t,r))}else if(n.segments.length===t.length){if(!Fr(n.segments,t)||!jc(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!kv(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!Fr(n.segments,i)||!jc(n.segments,i,r)||!n.children[oe]?!1:xv(n.children[oe],e,s,r)}}function jc(n,e,t){return e.every((r,i)=>Pv[t](n[i].parameters,r.parameters))}var Jn=class{constructor(e=new fe([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Ni(this.queryParams),this._queryParamMap}toString(){return nb.serialize(this)}},fe=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Bc(this)}},Or=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=Ni(this.parameters),this._parameterMap}toString(){return Nv(this)}};function eb(n,e){return Fr(n,e)&&n.every((t,r)=>sn(t.parameters,e[r].parameters))}function Fr(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function tb(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===oe&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==oe&&(t=t.concat(e(i,r)))}),t}var $o=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:()=>new xo,providedIn:"root"});let n=e;return n})(),xo=class{parse(e){let t=new hd(e);return new Jn(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Co(e.root,!0)}`,r=sb(e.queryParams),i=typeof e.fragment=="string"?`#${rb(e.fragment)}`:"";return`${t}${r}${i}`}},nb=new xo;function Bc(n){return n.segments.map(e=>Nv(e)).join("/")}function Co(n,e){if(!n.hasChildren())return Bc(n);if(e){let t=n.children[oe]?Co(n.children[oe],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==oe&&r.push(`${i}:${Co(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=tb(n,(r,i)=>i===oe?[Co(n.children[oe],!1)]:[`${i}:${Co(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[oe]!=null?`${Bc(n)}/${t[0]}`:`${Bc(n)}/(${t.join("//")})`}}function Mv(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Lc(n){return Mv(n).replace(/%3B/gi,";")}function rb(n){return encodeURI(n)}function ld(n){return Mv(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function $c(n){return decodeURIComponent(n)}function wv(n){return $c(n.replace(/\+/g,"%20"))}function Nv(n){return`${ld(n.path)}${ib(n.parameters)}`}function ib(n){return Object.entries(n).map(([e,t])=>`;${ld(e)}=${ld(t)}`).join("")}function sb(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${Lc(t)}=${Lc(i)}`).join("&"):`${Lc(t)}=${Lc(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var ob=/^[^\/()?;#]+/;function id(n){let e=n.match(ob);return e?e[0]:""}var ab=/^[^\/()?;=#]+/;function cb(n){let e=n.match(ab);return e?e[0]:""}var ub=/^[^=?&#]+/;function lb(n){let e=n.match(ub);return e?e[0]:""}var hb=/^[^&#]+/;function db(n){let e=n.match(hb);return e?e[0]:""}var hd=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new fe([],{}):new fe([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[oe]=new fe(e,t)),r}parseSegment(){let e=id(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new Ee(4009,!1);return this.capture(e),new Or($c(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=cb(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=id(this.remaining);i&&(r=i,this.capture(r))}e[$c(t)]=$c(r)}parseQueryParam(e){let t=lb(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=db(this.remaining);o&&(r=o,this.capture(r))}let i=wv(t),s=wv(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=id(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new Ee(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=oe);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[oe]:new fe([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new Ee(4011,!1)}};function Vv(n){return n.segments.length>0?new fe([],{[oe]:n}):n}function Ov(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=Ov(i);if(r===oe&&s.segments.length===0&&s.hasChildren())for(let[o,c]of Object.entries(s.children))e[o]=c;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new fe(n.segments,e);return fb(t)}function fb(n){if(n.numberOfChildren===1&&n.children[oe]){let e=n.children[oe];return new fe(n.segments.concat(e.segments),e.children)}return n}function Vi(n){return n instanceof Jn}function pb(n,e,t=null,r=null){let i=Fv(n);return Lv(i,e,t,r)}function Fv(n){let e;function t(s){let o={};for(let u of s.children){let l=t(u);o[u.outlet]=l}let c=new fe(s.url,o);return s===n&&(e=c),c}let r=t(n.root),i=Vv(r);return e??i}function Lv(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return sd(i,i,i,t,r);let s=gb(e);if(s.toRoot())return sd(i,i,new fe([],{}),t,r);let o=mb(s,i,n),c=o.processChildren?Po(o.segmentGroup,o.index,s.commands):jv(o.segmentGroup,o.index,s.commands);return sd(i,o.segmentGroup,c,t,r)}function qc(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Mo(n){return typeof n=="object"&&n!=null&&n.outlets}function sd(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([u,l])=>{s[u]=Array.isArray(l)?l.map(f=>`${f}`):`${l}`});let o;n===e?o=t:o=Uv(n,e,t);let c=Vv(Ov(o));return new Jn(c,s,i)}function Uv(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=Uv(s,e,t)}),new fe(n.segments,r)}var zc=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&qc(r[0]))throw new Ee(4003,!1);let i=r.find(Mo);if(i&&i!==Rv(r))throw new Ee(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function gb(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new zc(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let c={};return Object.entries(s.outlets).forEach(([u,l])=>{c[u]=typeof l=="string"?l.split("/"):l}),[...i,{outlets:c}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((c,u)=>{u==0&&c==="."||(u==0&&c===""?t=!0:c===".."?e++:c!=""&&i.push(c))}),i):[...i,s]},[]);return new zc(t,e,r)}var xi=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function mb(n,e,t){if(n.isAbsolute)return new xi(e,!0,0);if(!t)return new xi(e,!1,NaN);if(t.parent===null)return new xi(t,!0,0);let r=qc(n.commands[0])?0:1,i=t.segments.length-1+r;return yb(t,i,n.numberOfDoubleDots)}function yb(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new Ee(4005,!1);i=r.segments.length}return new xi(r,!1,i-s)}function _b(n){return Mo(n[0])?n[0].outlets:{[oe]:n}}function jv(n,e,t){if(n??=new fe([],{}),n.segments.length===0&&n.hasChildren())return Po(n,e,t);let r=vb(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new fe(n.segments.slice(0,r.pathIndex),{});return s.children[oe]=new fe(n.segments.slice(r.pathIndex),n.children),Po(s,0,i)}else return r.match&&i.length===0?new fe(n.segments,{}):r.match&&!n.hasChildren()?dd(n,e,t):r.match?Po(n,0,i):dd(n,e,t)}function Po(n,e,t){if(t.length===0)return new fe(n.segments,{});{let r=_b(t),i={};if(Object.keys(r).some(s=>s!==oe)&&n.children[oe]&&n.numberOfChildren===1&&n.children[oe].segments.length===0){let s=Po(n.children[oe],e,t);return new fe(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=jv(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new fe(n.segments,i)}}function vb(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],c=t[r];if(Mo(c))break;let u=`${c}`,l=r<t.length-1?t[r+1]:null;if(i>0&&u===void 0)break;if(u&&l&&typeof l=="object"&&l.outlets===void 0){if(!Iv(u,l,o))return s;r+=2}else{if(!Iv(u,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function dd(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(Mo(s)){let u=wb(s.outlets);return new fe(r,u)}if(i===0&&qc(t[0])){let u=n.segments[e];r.push(new Or(u.path,Ev(t[0]))),i++;continue}let o=Mo(s)?s.outlets[oe]:`${s}`,c=i<t.length-1?t[i+1]:null;o&&c&&qc(c)?(r.push(new Or(o,Ev(c))),i+=2):(r.push(new Or(o,{})),i++)}return new fe(r,{})}function wb(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=dd(new fe([],{}),0,r))}),e}function Ev(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function Iv(n,e,t){return n==t.path&&sn(e,t.parameters)}var Do="imperative",Ye=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(Ye||{}),Nt=class{constructor(e,t){this.id=e,this.url=t}},Oi=class extends Nt{constructor(e,t,r="imperative",i=null){super(e,t),this.type=Ye.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},on=class extends Nt{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=Ye.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Ct=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(Ct||{}),Gc=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(Gc||{}),Yn=class extends Nt{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Ye.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Zn=class extends Nt{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Ye.NavigationSkipped}},No=class extends Nt{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=Ye.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Wc=class extends Nt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ye.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},fd=class extends Nt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ye.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},pd=class extends Nt{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=Ye.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},gd=class extends Nt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ye.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},md=class extends Nt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ye.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},yd=class{constructor(e){this.route=e,this.type=Ye.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},_d=class{constructor(e){this.route=e,this.type=Ye.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},vd=class{constructor(e){this.snapshot=e,this.type=Ye.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},wd=class{constructor(e){this.snapshot=e,this.type=Ye.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Ed=class{constructor(e){this.snapshot=e,this.type=Ye.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Id=class{constructor(e){this.snapshot=e,this.type=Ye.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Kc=class{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=Ye.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},Vo=class{},Oo=class{constructor(e){this.url=e}};var Td=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new qo,this.attachRef=null}},qo=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new Td,this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Hc=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=Ad(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=Ad(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=bd(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return bd(e,this._root).map(t=>t.value)}};function Ad(n,e){if(n===e.value)return e;for(let t of e.children){let r=Ad(n,t);if(r)return r}return null}function bd(n,e){if(n===e.value)return[e];for(let t of e.children){let r=bd(n,t);if(r.length)return r.unshift(e),r}return[]}var bt=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function ki(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Qc=class extends Hc{constructor(e,t){super(e),this.snapshot=t,Vd(this,e)}toString(){return this.snapshot.toString()}};function Bv(n){let e=Eb(n),t=new kt([new Or("",{})]),r=new kt({}),i=new kt({}),s=new kt({}),o=new kt(""),c=new qt(t,r,s,o,i,oe,n,e.root);return c.snapshot=e.root,new Qc(new bt(c,[]),e)}function Eb(n){let e={},t={},r={},i="",s=new Fo([],e,r,i,t,oe,n,null,{});return new Xc("",new bt(s,[]))}var qt=class{constructor(e,t,r,i,s,o,c,u){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=c,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(Y(l=>l[Bo]))??J(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Y(e=>Ni(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Y(e=>Ni(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Nd(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:z(z({},e.params),n.params),data:z(z({},e.data),n.data),resolve:z(z(z(z({},n.data),e.data),i?.data),n._resolvedData)}:r={params:z({},n.params),data:z({},n.data),resolve:z(z({},n.data),n._resolvedData??{})},i&&qv(i)&&(r.resolve[Bo]=i.title),r}var Fo=class{get title(){return this.data?.[Bo]}constructor(e,t,r,i,s,o,c,u,l){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=c,this.routeConfig=u,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Ni(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Ni(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Xc=class extends Hc{constructor(e,t){super(t),this.url=e,Vd(this,t)}toString(){return $v(this._root)}};function Vd(n,e){e.value._routerState=n,e.children.forEach(t=>Vd(n,t))}function $v(n){let e=n.children.length>0?` { ${n.children.map($v).join(", ")} } `:"";return`${n.value}${e}`}function od(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,sn(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),sn(e.params,t.params)||n.paramsSubject.next(t.params),XA(e.url,t.url)||n.urlSubject.next(t.url),sn(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function Cd(n,e){let t=sn(n.params,e.params)&&eb(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||Cd(n.parent,e.parent))}function qv(n){return typeof n.title=="string"||n.title===null}var Od=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=oe,this.activateEvents=new en,this.deactivateEvents=new en,this.attachEvents=new en,this.detachEvents=new en,this.parentContexts=Q(qo),this.location=Q(E_),this.changeDetector=Q(Ic),this.environmentInjector=Q(Ti),this.inputBinder=Q(tu,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ee(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ee(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ee(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new Ee(4013,!1);this._activatedRoute=r;let s=this.location,c=r.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,l=new Sd(r,u,s.injector);this.activated=s.createComponent(c,{index:s.length,injector:l,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=yt({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Mr]});let n=e;return n})(),Sd=class n{__ngOutletInjector(e){return new n(this.route,this.childContexts,e)}constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===qt?this.route:e===qo?this.childContexts:this.parent.get(e,t)}},tu=new re(""),Tv=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){let{activatedRoute:i}=r,s=uc([i.queryParams,i.params,i.data]).pipe(xe(([o,c,u],l)=>(u=z(z(z({},o),c),u),l===0?J(u):Promise.resolve(u)))).subscribe(o=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(r);return}let c=O_(i.component);if(!c){this.unsubscribeFromRouteData(r);return}for(let{templateName:u}of c.inputs)r.activatedComponentRef.setInput(u,o[u])});this.outletDataSubscriptions.set(r,s)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:e.\u0275fac});let n=e;return n})();function Ib(n,e,t){let r=Lo(n,e._root,t?t._root:void 0);return new Qc(r,e)}function Lo(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=Tb(n,e,t);return new bt(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(c=>Lo(n,c)),o}}let r=Ab(e.value),i=e.children.map(s=>Lo(n,s));return new bt(r,i)}}function Tb(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return Lo(n,r,i);return Lo(n,r)})}function Ab(n){return new qt(new kt(n.url),new kt(n.params),new kt(n.queryParams),new kt(n.fragment),new kt(n.data),n.outlet,n.component,n)}var zv="ngNavigationCancelingError";function Gv(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=Vi(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=Wv(!1,Ct.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function Wv(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[zv]=!0,t.cancellationCode=e,t}function bb(n){return Kv(n)&&Vi(n.url)}function Kv(n){return!!n&&n[zv]}var Cb=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Me({type:e,selectors:[["ng-component"]],standalone:!0,features:[b_],decls:1,vars:0,template:function(i,s){i&1&&Oe(0,"router-outlet")},dependencies:[Od],encapsulation:2});let n=e;return n})();function Sb(n,e){return n.providers&&!n._injector&&(n._injector=Fh(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Fd(n){let e=n.children&&n.children.map(Fd),t=e?ye(z({},n),{children:e}):z({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==oe&&(t.component=Cb),t}function an(n){return n.outlet||oe}function Rb(n,e){let t=n.filter(r=>an(r)===e);return t.push(...n.filter(r=>an(r)!==e)),t}function zo(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var Pb=(n,e,t,r)=>Y(i=>(new Rd(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),Rd=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),od(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=ki(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=ki(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),c=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:c})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=ki(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=ki(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new Id(s.value.snapshot))}),e.children.length&&this.forwardEvent(new wd(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(od(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let c=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(c.contexts),o.attachRef=c.componentRef,o.route=c.route.value,o.outlet&&o.outlet.attach(c.componentRef,c.route.value),od(c.route.value),this.activateChildRoutes(e,null,o.children)}else{let c=zo(i.snapshot);o.attachRef=null,o.route=i,o.injector=c,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},Jc=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Mi=class{constructor(e,t){this.component=e,this.route=t}};function Db(n,e,t){let r=n._root,i=e?e._root:null;return So(r,i,t,[r.value])}function kb(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function Li(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!p_(n)?n:e.get(n):r}function So(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=ki(e);return n.children.forEach(o=>{xb(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,c])=>ko(c,t.getContext(o),i)),i}function xb(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,c=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let u=Mb(o,s,s.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new Jc(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?So(n,e,c?c.children:null,r,i):So(n,e,t,r,i),u&&c&&c.outlet&&c.outlet.isActivated&&i.canDeactivateChecks.push(new Mi(c.outlet.component,o))}else o&&ko(e,c,i),i.canActivateChecks.push(new Jc(r)),s.component?So(n,null,c?c.children:null,r,i):So(n,null,t,r,i);return i}function Mb(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!Fr(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Fr(n.url,e.url)||!sn(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Cd(n,e)||!sn(n.queryParams,e.queryParams);case"paramsChange":default:return!Cd(n,e)}}function ko(n,e,t){let r=ki(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?ko(o,e.children.getContext(s),t):ko(o,null,t):ko(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Mi(e.outlet.component,i)):t.canDeactivateChecks.push(new Mi(null,i)):t.canDeactivateChecks.push(new Mi(null,i))}function Go(n){return typeof n=="function"}function Nb(n){return typeof n=="boolean"}function Vb(n){return n&&Go(n.canLoad)}function Ob(n){return n&&Go(n.canActivate)}function Fb(n){return n&&Go(n.canActivateChild)}function Lb(n){return n&&Go(n.canDeactivate)}function Ub(n){return n&&Go(n.canMatch)}function Hv(n){return n instanceof o_||n?.name==="EmptyError"}var Uc=Symbol("INITIAL_VALUE");function Fi(){return xe(n=>uc(n.map(e=>e.pipe(xt(1),Ii(Uc)))).pipe(Y(e=>{for(let t of e)if(t!==!0){if(t===Uc)return Uc;if(t===!1||t instanceof Jn)return t}return!0}),It(e=>e!==Uc),xt(1)))}function jb(n,e){return Et(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?J(ye(z({},t),{guardsResult:!0})):Bb(o,r,i,n).pipe(Et(c=>c&&Nb(c)?$b(r,s,n,e):J(c)),Y(c=>ye(z({},t),{guardsResult:c})))})}function Bb(n,e,t,r){return ge(n).pipe(Et(i=>Kb(i.component,i.route,t,e,r)),Yt(i=>i!==!0,!0))}function $b(n,e,t,r){return ge(e).pipe(xr(i=>a_(zb(i.route.parent,r),qb(i.route,r),Wb(n,i.path,t),Gb(n,i.route,t))),Yt(i=>i!==!0,!0))}function qb(n,e){return n!==null&&e&&e(new Ed(n)),J(!0)}function zb(n,e){return n!==null&&e&&e(new vd(n)),J(!0)}function Gb(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return J(!0);let i=r.map(s=>Rh(()=>{let o=zo(e)??t,c=Li(s,o),u=Ob(c)?c.canActivate(e,n):Cn(o,()=>c(e,n));return er(u).pipe(Yt())}));return J(i).pipe(Fi())}function Wb(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>kb(o)).filter(o=>o!==null).map(o=>Rh(()=>{let c=o.guards.map(u=>{let l=zo(o.node)??t,f=Li(u,l),p=Fb(f)?f.canActivateChild(r,n):Cn(l,()=>f(r,n));return er(p).pipe(Yt())});return J(c).pipe(Fi())}));return J(s).pipe(Fi())}function Kb(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return J(!0);let o=s.map(c=>{let u=zo(e)??i,l=Li(c,u),f=Lb(l)?l.canDeactivate(n,e,t,r):Cn(u,()=>l(n,e,t,r));return er(f).pipe(Yt())});return J(o).pipe(Fi())}function Hb(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return J(!0);let s=i.map(o=>{let c=Li(o,n),u=Vb(c)?c.canLoad(e,t):Cn(n,()=>c(e,t));return er(u)});return J(s).pipe(Fi(),Qv(r))}function Qv(n){return r_(Re(e=>{if(Vi(e))throw Gv(n,e)}),Y(e=>e===!0))}function Qb(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return J(!0);let s=i.map(o=>{let c=Li(o,n),u=Ub(c)?c.canMatch(e,t):Cn(n,()=>c(e,t));return er(u)});return J(s).pipe(Fi(),Qv(r))}var Uo=class{constructor(e){this.segmentGroup=e||null}},Yc=class extends Error{constructor(e){super(),this.urlTree=e}};function Di(n){return so(new Uo(n))}function Xb(n){return so(new Ee(4e3,!1))}function Jb(n){return so(Wv(!1,Ct.GuardRejected))}var Pd=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return J(r);if(i.numberOfChildren>1||!i.children[oe])return Xb(e.redirectTo);i=i.children[oe]}}applyRedirectCommands(e,t,r){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new Yc(i);return i}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new Jn(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let c=s.substring(1);r[i]=t[c]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([c,u])=>{o[c]=this.createSegmentGroup(e,u,r,i)}),new fe(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new Ee(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},Dd={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Yb(n,e,t,r,i){let s=Ld(n,e,t);return s.matched?(r=Sb(e,r),Qb(r,e,t,i).pipe(Y(o=>o===!0?s:z({},Dd)))):J(s)}function Ld(n,e,t){if(e.path==="**")return Zb(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?z({},Dd):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||QA)(t,n,e);if(!i)return z({},Dd);let s={};Object.entries(i.posParams??{}).forEach(([c,u])=>{s[c]=u.path});let o=i.consumed.length>0?z(z({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function Zb(n){return{matched:!0,parameters:n.length>0?Rv(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function Av(n,e,t,r){return t.length>0&&nC(n,t,r)?{segmentGroup:new fe(e,tC(r,new fe(t,n.children))),slicedSegments:[]}:t.length===0&&rC(n,t,r)?{segmentGroup:new fe(n.segments,eC(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new fe(n.segments,n.children),slicedSegments:t}}function eC(n,e,t,r){let i={};for(let s of t)if(nu(n,e,s)&&!r[an(s)]){let o=new fe([],{});i[an(s)]=o}return z(z({},r),i)}function tC(n,e){let t={};t[oe]=e;for(let r of n)if(r.path===""&&an(r)!==oe){let i=new fe([],{});t[an(r)]=i}return t}function nC(n,e,t){return t.some(r=>nu(n,e,r)&&an(r)!==oe)}function rC(n,e,t){return t.some(r=>nu(n,e,r))}function nu(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function iC(n,e,t,r){return an(n)!==r&&(r===oe||!nu(e,t,n))?!1:Ld(e,n,t).matched}function sC(n,e,t){return e.length===0&&!n.children[t]}var kd=class{};function oC(n,e,t,r,i,s,o="emptyOnly"){return new xd(n,e,t,r,i,o,s).recognize()}var aC=31,xd=class{constructor(e,t,r,i,s,o,c){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=c,this.applyRedirects=new Pd(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new Ee(4002,`'${e.segmentGroup}'`)}recognize(){let e=Av(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(Y(t=>{let r=new Fo([],Object.freeze({}),Object.freeze(z({},this.urlTree.queryParams)),this.urlTree.fragment,{},oe,this.rootComponentType,null,{}),i=new bt(r,t),s=new Xc("",i),o=pb(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,oe).pipe(Kn(r=>{if(r instanceof Yc)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Uo?this.noMatchError(r):r}))}inheritParamsAndData(e,t){let r=e.value,i=Nd(r,t,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,t,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(Y(s=>s instanceof bt?[s]:[]))}processChildren(e,t,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return ge(i).pipe(xr(s=>{let o=r.children[s],c=Rb(t,s);return this.processSegmentGroup(e,c,o,s)}),Ei((s,o)=>(s.push(...o),s)),Ph(null),d_(),Et(s=>{if(s===null)return Di(r);let o=Xv(s);return cC(o),J(o)}))}processSegment(e,t,r,i,s,o){return ge(t).pipe(xr(c=>this.processSegmentAgainstRoute(c._injector??e,t,c,r,i,s,o).pipe(Kn(u=>{if(u instanceof Uo)return J(null);throw u}))),Yt(c=>!!c),Kn(c=>{if(Hv(c))return sC(r,i,s)?J(new kd):Di(r);throw c}))}processSegmentAgainstRoute(e,t,r,i,s,o,c){return iC(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&c?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o):Di(i):Di(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){let{matched:c,consumedSegments:u,positionalParamSegments:l,remainingSegments:f}=Ld(t,i,s);if(!c)return Di(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>aC&&(this.allowRedirects=!1));let p=this.applyRedirects.applyRedirectCommands(u,i.redirectTo,l);return this.applyRedirects.lineralizeSegments(i,p).pipe(Et(m=>this.processSegment(e,r,t,m.concat(f),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let o=Yb(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),o.pipe(xe(c=>c.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(xe(({routes:u})=>{let l=r._loadedInjector??e,{consumedSegments:f,remainingSegments:p,parameters:m}=c,E=new Fo(f,m,Object.freeze(z({},this.urlTree.queryParams)),this.urlTree.fragment,lC(r),an(r),r.component??r._loadedComponent??null,r,hC(r)),{segmentGroup:k,slicedSegments:x}=Av(t,f,p,u);if(x.length===0&&k.hasChildren())return this.processChildren(l,u,k).pipe(Y($=>$===null?null:new bt(E,$)));if(u.length===0&&x.length===0)return J(new bt(E,[]));let D=an(r)===s;return this.processSegment(l,u,k,x,D?oe:s,!0).pipe(Y($=>new bt(E,$ instanceof bt?[$]:[])))}))):Di(t)))}getChildConfig(e,t,r){return t.children?J({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?J({routes:t._loadedRoutes,injector:t._loadedInjector}):Hb(e,t,r,this.urlSerializer).pipe(Et(i=>i?this.configLoader.loadChildren(e,t).pipe(Re(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):Jb(t))):J({routes:[],injector:e})}};function cC(n){n.sort((e,t)=>e.value.outlet===oe?-1:t.value.outlet===oe?1:e.value.outlet.localeCompare(t.value.outlet))}function uC(n){let e=n.value.routeConfig;return e&&e.path===""}function Xv(n){let e=[],t=new Set;for(let r of n){if(!uC(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=Xv(r.children);e.push(new bt(r.value,i))}return e.filter(r=>!t.has(r))}function lC(n){return n.data||{}}function hC(n){return n.resolve||{}}function dC(n,e,t,r,i,s){return Et(o=>oC(n,e,t,r,o.extractedUrl,i,s).pipe(Y(({state:c,tree:u})=>ye(z({},o),{targetSnapshot:c,urlAfterRedirects:u}))))}function fC(n,e){return Et(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return J(t);let s=new Set(i.map(u=>u.route)),o=new Set;for(let u of s)if(!o.has(u))for(let l of Jv(u))o.add(l);let c=0;return ge(o).pipe(xr(u=>s.has(u)?pC(u,r,n,e):(u.data=Nd(u,u.parent,n).resolve,J(void 0))),Re(()=>c++),Dh(1),Et(u=>c===o.size?J(t):Gn))})}function Jv(n){let e=n.children.map(t=>Jv(t)).flat();return[n,...e]}function pC(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!qv(i)&&(s[Bo]=i.title),gC(s,n,e,r).pipe(Y(o=>(n._resolvedData=o,n.data=Nd(n,n.parent,t).resolve,null)))}function gC(n,e,t,r){let i=ud(n);if(i.length===0)return J({});let s={};return ge(i).pipe(Et(o=>mC(n[o],e,t,r).pipe(Yt(),Re(c=>{s[o]=c}))),Dh(1),l_(s),Kn(o=>Hv(o)?Gn:so(o)))}function mC(n,e,t,r){let i=zo(e)??r,s=Li(n,i),o=s.resolve?s.resolve(e,t):Cn(i,()=>s(e,t));return er(o)}function ad(n){return xe(e=>{let t=n(e);return t?ge(t).pipe(Y(()=>e)):J(e)})}var Yv=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===oe);return i}getResolvedTitleForRoute(r){return r.data[Bo]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:()=>Q(yC),providedIn:"root"});let n=e;return n})(),yC=(()=>{let e=class e extends Yv{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(O(mv))},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Wo=new re("",{providedIn:"root",factory:()=>({})}),Zc=new re(""),Ud=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Q(Ec)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return J(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=er(r.loadComponent()).pipe(Y(Zv),Re(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),oo(()=>{this.componentLoaders.delete(r)})),s=new Ch(i,()=>new Jt).pipe(bh());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return J({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=_C(i,this.compiler,r,this.onLoadEndListener).pipe(oo(()=>{this.childrenLoaders.delete(i)})),c=new Ch(o,()=>new Jt).pipe(bh());return this.childrenLoaders.set(i,c),c}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function _C(n,e,t,r){return er(n.loadChildren()).pipe(Y(Zv),Et(i=>i instanceof T_||Array.isArray(i)?J(i):ge(e.compileModuleAsync(i))),Y(i=>{r&&r(n);let s,o,c=!1;return Array.isArray(i)?(o=i,c=!0):(s=i.create(t).injector,o=s.get(Zc,[],{optional:!0,self:!0}).flat()),{routes:o.map(Fd),injector:s}}))}function vC(n){return n&&typeof n=="object"&&"default"in n}function Zv(n){return vC(n)?n.default:n}var jd=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:()=>Q(wC),providedIn:"root"});let n=e;return n})(),wC=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),ew=new re(""),tw=new re("");function EC(n,e,t){let r=n.get(tw),i=n.get(ct);return n.get(de).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,new Promise(l=>setTimeout(l));let s,o=new Promise(l=>{s=l}),c=i.startViewTransition(()=>(s(),IC(n))),{onViewTransitionCreated:u}=r;return u&&Cn(n,()=>u({transition:c,from:e,to:t})),o})}function IC(n){return new Promise(e=>{Oh(e,{injector:n})})}var Bd=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Jt,this.transitionAbortSubject=new Jt,this.configLoader=Q(Ud),this.environmentInjector=Q(Ti),this.urlSerializer=Q($o),this.rootContexts=Q(qo),this.location=Q(vo),this.inputBindingEnabled=Q(tu,{optional:!0})!==null,this.titleStrategy=Q(Yv),this.options=Q(Wo,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Q(jd),this.createViewTransition=Q(ew,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>J(void 0),this.rootComponentType=null;let r=s=>this.events.next(new yd(s)),i=s=>this.events.next(new _d(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(ye(z(z({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new kt({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Do,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(It(o=>o.id!==0),Y(o=>ye(z({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),xe(o=>{let c=!1,u=!1;return J(o).pipe(xe(l=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",Ct.SupersededByNewNavigation),Gn;this.currentTransition=o,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?ye(z({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let f=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),p=l.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!f&&p!=="reload"){let m="";return this.events.next(new Zn(l.id,this.urlSerializer.serialize(l.rawUrl),m,Gc.IgnoredSameUrlNavigation)),l.resolve(null),Gn}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return J(l).pipe(xe(m=>{let E=this.transitions?.getValue();return this.events.next(new Oi(m.id,this.urlSerializer.serialize(m.extractedUrl),m.source,m.restoredState)),E!==this.transitions?.getValue()?Gn:Promise.resolve(m)}),dC(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),Re(m=>{o.targetSnapshot=m.targetSnapshot,o.urlAfterRedirects=m.urlAfterRedirects,this.currentNavigation=ye(z({},this.currentNavigation),{finalUrl:m.urlAfterRedirects});let E=new Wc(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(E)}));if(f&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:m,extractedUrl:E,source:k,restoredState:x,extras:D}=l,$=new Oi(m,this.urlSerializer.serialize(E),k,x);this.events.next($);let K=Bv(this.rootComponentType).snapshot;return this.currentTransition=o=ye(z({},l),{targetSnapshot:K,urlAfterRedirects:E,extras:ye(z({},D),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=E,J(o)}else{let m="";return this.events.next(new Zn(l.id,this.urlSerializer.serialize(l.extractedUrl),m,Gc.IgnoredByUrlHandlingStrategy)),l.resolve(null),Gn}}),Re(l=>{let f=new fd(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(f)}),Y(l=>(this.currentTransition=o=ye(z({},l),{guards:Db(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),o)),jb(this.environmentInjector,l=>this.events.next(l)),Re(l=>{if(o.guardsResult=l.guardsResult,Vi(l.guardsResult))throw Gv(this.urlSerializer,l.guardsResult);let f=new pd(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(f)}),It(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",Ct.GuardRejected),!1)),ad(l=>{if(l.guards.canActivateChecks.length)return J(l).pipe(Re(f=>{let p=new gd(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(p)}),xe(f=>{let p=!1;return J(f).pipe(fC(this.paramsInheritanceStrategy,this.environmentInjector),Re({next:()=>p=!0,complete:()=>{p||this.cancelNavigationTransition(f,"",Ct.NoDataFromResolver)}}))}),Re(f=>{let p=new md(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(p)}))}),ad(l=>{let f=p=>{let m=[];p.routeConfig?.loadComponent&&!p.routeConfig._loadedComponent&&m.push(this.configLoader.loadComponent(p.routeConfig).pipe(Re(E=>{p.component=E}),Y(()=>{})));for(let E of p.children)m.push(...f(E));return m};return uc(f(l.targetSnapshot.root)).pipe(Ph(null),xt(1))}),ad(()=>this.afterPreactivation()),xe(()=>{let{currentSnapshot:l,targetSnapshot:f}=o,p=this.createViewTransition?.(this.environmentInjector,l.root,f.root);return p?ge(p).pipe(Y(()=>o)):J(o)}),Y(l=>{let f=Ib(r.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=o=ye(z({},l),{targetRouterState:f}),this.currentNavigation.targetRouterState=f,o}),Re(()=>{this.events.next(new Vo)}),Pb(this.rootContexts,r.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),xt(1),Re({next:l=>{c=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new on(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{c=!0}}),f_(this.transitionAbortSubject.pipe(Re(l=>{throw l}))),oo(()=>{!c&&!u&&this.cancelNavigationTransition(o,"",Ct.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),Kn(l=>{if(u=!0,Kv(l))this.events.next(new Yn(o.id,this.urlSerializer.serialize(o.extractedUrl),l.message,l.cancellationCode)),bb(l)?this.events.next(new Oo(l.url)):o.resolve(!1);else{this.events.next(new No(o.id,this.urlSerializer.serialize(o.extractedUrl),l,o.targetSnapshot??void 0));try{o.resolve(r.errorHandler(l))}catch(f){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(f)}}return Gn}))}))}cancelNavigationTransition(r,i,s){let o=new Yn(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function TC(n){return n!==Do}var AC=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:()=>Q(bC),providedIn:"root"});let n=e;return n})(),Md=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},bC=(()=>{let e=class e extends Md{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Ai(e)))(s||e)}})(),e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),nw=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:()=>Q(CC),providedIn:"root"});let n=e;return n})(),CC=(()=>{let e=class e extends nw{constructor(){super(...arguments),this.location=Q(vo),this.urlSerializer=Q($o),this.options=Q(Wo,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Q(jd),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Jn,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Bv(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof Oi)this.stateMemento=this.createStateMemento();else if(r instanceof Zn)this.rawUrlTree=i.initialUrl;else if(r instanceof Wc){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof Vo?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof Yn&&(r.code===Ct.GuardRejected||r.code===Ct.NoDataFromResolver)?this.restoreHistory(i):r instanceof No?this.restoreHistory(i,!0):r instanceof on&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,c=z(z({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",c)}else{let o=z(z({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Ai(e)))(s||e)}})(),e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Ro=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(Ro||{});function rw(n,e){n.events.pipe(It(t=>t instanceof on||t instanceof Yn||t instanceof No||t instanceof Zn),Y(t=>t instanceof on||t instanceof Zn?Ro.COMPLETE:(t instanceof Yn?t.code===Ct.Redirect||t.code===Ct.SupersededByNewNavigation:!1)?Ro.REDIRECTING:Ro.FAILED),It(t=>t!==Ro.REDIRECTING),xt(1)).subscribe(()=>{e()})}function SC(n){throw n}var RC={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},PC={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Te=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Q(mc),this.stateManager=Q(nw),this.options=Q(Wo,{optional:!0})||{},this.pendingTasks=Q(Lh),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Q(Bd),this.urlSerializer=Q($o),this.location=Q(vo),this.urlHandlingStrategy=Q(jd),this._events=new Jt,this.errorHandler=this.options.errorHandler||SC,this.navigated=!1,this.routeReuseStrategy=Q(AC),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Q(Zc,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Q(tu,{optional:!0}),this.eventsSubscription=new n_,this.isNgZoneEnabled=Q(de)instanceof de&&de.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof Yn&&i.code!==Ct.Redirect&&i.code!==Ct.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof on)this.navigated=!0;else if(i instanceof Oo){let c=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),u={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||TC(s.source)};this.scheduleNavigation(c,Do,null,u,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}kC(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Do,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},c=s?.navigationId?s:null;if(s){let l=z({},s);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(o.state=l)}let u=this.parseUrl(r);this.scheduleNavigation(u,i,c,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(Fd),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:c,queryParamsHandling:u,preserveFragment:l}=i,f=l?this.currentUrlTree.fragment:c,p=null;switch(u){case"merge":p=z(z({},this.currentUrlTree.queryParams),o);break;case"preserve":p=this.currentUrlTree.queryParams;break;default:p=o||null}p!==null&&(p=this.removeEmptyProps(p));let m;try{let E=s?s.snapshot:this.routerState.snapshot.root;m=Fv(E)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),m=this.currentUrlTree.root}return Lv(m,r,p,f??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=Vi(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,Do,null,i)}navigate(r,i={skipLocationChange:!1}){return DC(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=z({},RC):i===!1?s=z({},PC):s=i,Vi(r))return vv(this.currentUrlTree,r,s);let o=this.parseUrl(r);return vv(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,c){if(this.disposed)return Promise.resolve(!1);let u,l,f;c?(u=c.resolve,l=c.reject,f=c.promise):f=new Promise((m,E)=>{u=m,l=E});let p=this.pendingTasks.add();return rw(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(p))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:u,reject:l,promise:f,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),f.catch(m=>Promise.reject(m))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function DC(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new Ee(4008,!1)}function kC(n){return!(n instanceof Vo)&&!(n instanceof Oo)}var iw=(()=>{let e=class e{constructor(r,i,s,o,c,u){this.router=r,this.route=i,this.tabIndexAttribute=s,this.renderer=o,this.el=c,this.locationStrategy=u,this.href=null,this.commands=null,this.onChanges=new Jt,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let l=c.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=r.events.subscribe(f=>{f instanceof on&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(r){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",r)}ngOnChanges(r){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(r){r!=null?(this.commands=Array.isArray(r)?r:[r],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(r,i,s,o,c){let u=this.urlTree;if(u===null||this.isAnchorElement&&(r!==0||i||s||o||c||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(u,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let r=this.urlTree;this.href=r!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(r)):null;let i=this.href===null?null:w_(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(r,i){let s=this.renderer,o=this.el.nativeElement;i!==null?s.setAttribute(o,r,i):s.removeAttribute(o,r)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(i){return new(i||e)(Z(Te),Z(qt),y_("tabindex"),Z(fo),Z(uo),Z(_o))},e.\u0275dir=yt({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){i&1&&_e("click",function(c){return s.onClick(c.button,c.ctrlKey,c.shiftKey,c.altKey,c.metaKey)}),i&2&&gc("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[bn.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Ci],skipLocationChange:[bn.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Ci],replaceUrl:[bn.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Ci],routerLink:"routerLink"},standalone:!0,features:[I_,Mr]});let n=e;return n})();var eu=class{};var xC=(()=>{let e=class e{constructor(r,i,s,o,c){this.router=r,this.injector=s,this.preloadingStrategy=o,this.loader=c}setUpPreloading(){this.subscription=this.router.events.pipe(It(r=>r instanceof on),xr(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,i){let s=[];for(let o of i){o.providers&&!o._injector&&(o._injector=Fh(o.providers,r,`Route: ${o.path}`));let c=o._injector??r,u=o._loadedInjector??c;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(c,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(u,o.children??o._loadedRoutes))}return ge(s).pipe(Sh())}preloadConfig(r,i){return this.preloadingStrategy.preload(i,()=>{let s;i.loadChildren&&i.canLoad===void 0?s=this.loader.loadChildren(r,i):s=J(null);let o=s.pipe(Et(c=>c===null?J(void 0):(i._loadedRoutes=c.routes,i._loadedInjector=c.injector,this.processRoutes(c.injector??r,c.routes))));if(i.loadComponent&&!i._loadedComponent){let c=this.loader.loadComponent(i);return ge([o,c]).pipe(Sh())}else return o})}};e.\u0275fac=function(i){return new(i||e)(O(Te),O(Ec),O(Ti),O(eu),O(Ud))},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),sw=new re(""),MC=(()=>{let e=class e{constructor(r,i,s,o,c={}){this.urlSerializer=r,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=c,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},this.environmentInjector=Q(Ti),c.scrollPositionRestoration||="disabled",c.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Oi?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof on?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof Zn&&r.code===Gc.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Kc&&(r.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(r.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,i){this.zone.runOutsideAngular(()=>R(this,null,function*(){yield new Promise(s=>{setTimeout(()=>{s()}),Oh(()=>{s()},{injector:this.environmentInjector})}),this.zone.run(()=>{this.transitions.events.next(new Kc(r,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(i){fc()},e.\u0275prov=ee({token:e,factory:e.\u0275fac});let n=e;return n})();function NC(n){return n.routerState.root}function Ko(n,e){return{\u0275kind:n,\u0275providers:e}}function VC(){let n=Q(Zt);return e=>{let t=n.get(yo);if(e!==t.components[0])return;let r=n.get(Te),i=n.get(ow);n.get($d)===1&&r.initialNavigation(),n.get(aw,null,Mh.Optional)?.setUpPreloading(),n.get(sw,null,Mh.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var ow=new re("",{factory:()=>new Jt}),$d=new re("",{providedIn:"root",factory:()=>1});function OC(){return Ko(2,[{provide:$d,useValue:0},{provide:Bh,multi:!0,deps:[Zt],useFactory:e=>{let t=e.get(U_,Promise.resolve());return()=>t.then(()=>new Promise(r=>{let i=e.get(Te),s=e.get(ow);rw(i,()=>{r(!0)}),e.get(Bd).afterPreactivation=()=>(r(!0),s.closed?J(void 0):s),i.initialNavigation()}))}}])}function FC(){return Ko(3,[{provide:Bh,multi:!0,useFactory:()=>{let e=Q(Te);return()=>{e.setUpLocationChangeListener()}}},{provide:$d,useValue:2}])}var aw=new re("");function LC(n){return Ko(0,[{provide:aw,useExisting:xC},{provide:eu,useExisting:n}])}function UC(){return Ko(8,[Tv,{provide:tu,useExisting:Tv}])}function jC(n){let e=[{provide:ew,useValue:EC},{provide:tw,useValue:z({skipNextTransition:!!n?.skipInitialTransition},n)}];return Ko(9,e)}var bv=new re("ROUTER_FORROOT_GUARD"),BC=[vo,{provide:$o,useClass:xo},Te,qo,{provide:qt,useFactory:NC,deps:[Te]},Ud,[]],Ho=(()=>{let e=class e{constructor(r){}static forRoot(r,i){return{ngModule:e,providers:[BC,[],{provide:Zc,multi:!0,useValue:r},{provide:bv,useFactory:GC,deps:[[Te,new Ke,new g_]]},{provide:Wo,useValue:i||{}},i?.useHash?qC():zC(),$C(),i?.preloadingStrategy?LC(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?WC(i):[],i?.bindToComponentInputs?UC().\u0275providers:[],i?.enableViewTransitions?jC().\u0275providers:[],KC()]}}static forChild(r){return{ngModule:e,providers:[{provide:Zc,multi:!0,useValue:r}]}}};e.\u0275fac=function(i){return new(i||e)(O(bv,8))},e.\u0275mod=He({type:e}),e.\u0275inj=We({});let n=e;return n})();function $C(){return{provide:sw,useFactory:()=>{let n=Q(G_),e=Q(de),t=Q(Wo),r=Q(Bd),i=Q($o);return t.scrollOffset&&n.setOffset(t.scrollOffset),new MC(i,r,n,e,t)}}}function qC(){return{provide:_o,useClass:B_}}function zC(){return{provide:_o,useClass:j_}}function GC(n){return"guarded"}function WC(n){return[n.initialNavigation==="disabled"?FC().\u0275providers:[],n.initialNavigation==="enabledBlocking"?OC().\u0275providers:[]]}var Cv=new re("");function KC(){return[{provide:Cv,useFactory:VC},{provide:wc,multi:!0,useExisting:Cv}]}var HC="firebase",QC="10.12.0";Je(HC,QC,"app");var Gt=new mo("ANGULARFIRE2_VERSION");function ji(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Ur=(n,e)=>{let t=e?[e]:Pc(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},St=class{constructor(){return Ur(XC)}},XC="app-check";function Ui(){}var ru=class{zone;delegate;constructor(e,t=i_){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},qd=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Ui,{},Ui,Ui)),t.pipe(Re({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},cn=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new ru(Zone.current)),this.insideAngular=t.run(()=>new ru(Zone.current,cc)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(O(de))};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function iu(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function JC(n){return iu().ngZone.runOutsideAngular(()=>n())}function Lr(n){return iu().ngZone.run(()=>n())}function ft(n){return YC(iu())(n)}function YC(n){return function(t){return t=t.lift(new qd(n.ngZone)),t.pipe(kr(n.outsideAngular),Wn(n.insideAngular))}}var ZC=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Lr(()=>n.apply(void 0,r))},Bi=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=Lr(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Ui,{},Ui,Ui))),r[s]=ZC(r[s],t));let i=JC(()=>n.apply(this,r));if(!e)if(i instanceof Dt){let s=iu();return i.pipe(kr(s.outsideAngular),Wn(s.insideAngular))}else return Lr(()=>i);return i instanceof Dt?i.pipe(ft):i instanceof Promise?Lr(()=>new Promise((s,o)=>i.then(c=>Lr(()=>s(c)),c=>Lr(()=>o(c))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:Lr(()=>i)};var tr=class{constructor(e){return e}},nr=class{constructor(){return Pc()}};var eS=new Map,tS={activated:!1,tokenObservers:[]},nS={initialized:!1,enabled:!1};function Wt(n){return eS.get(n)||Object.assign({},tS)}function fw(){return nS}var rS="https://content-firebaseappcheck.googleapis.com/v1";var iS="exchangeDebugToken",uw={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},H1=24*60*60*1e3;var Gd=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return R(this,null,function*(){this.stop();try{this.pending=new zh,this.pending.promise.catch(t=>{}),yield sS(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new zh,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function sS(n){return new Promise(e=>{setTimeout(e,n)})}var oS={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},rr=new H_("appCheck","AppCheck",oS);function pw(n){if(!Wt(n).activated)throw rr.create("use-before-activation",{appName:n.name})}function gw(r,i){return R(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let E=yield o.getHeartbeatsHeader();E&&(s["X-Firebase-Client"]=E)}let c={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(n,c)}catch(E){throw rr.create("fetch-network-error",{originalErrorMessage:E?.message})}if(u.status!==200)throw rr.create("fetch-status-error",{httpStatus:u.status});let l;try{l=yield u.json()}catch(E){throw rr.create("fetch-parse-error",{originalErrorMessage:E?.message})}let f=l.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw rr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${l.ttl}`});let p=Number(f[1])*1e3,m=Date.now();return{token:l.token,expireTimeMillis:m+p,issuedAtTimeMillis:m}})}function mw(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${rS}/projects/${t}/apps/${r}:${iS}?key=${i}`,body:{debug_token:e}}}var aS="firebase-app-check-database",cS=1,Wd="firebase-app-check-store";var su=null;function uS(){return su||(su=new Promise((n,e)=>{try{let t=indexedDB.open(aS,cS);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(rr.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Wd,{keyPath:"compositeKey"})}}}catch(t){e(rr.create("storage-open",{originalErrorMessage:t?.message}))}}),su)}function lS(n,e){return hS(dS(n),e)}function hS(n,e){return R(this,null,function*(){let r=(yield uS()).transaction(Wd,"readwrite"),s=r.objectStore(Wd).put({compositeKey:n,value:e});return new Promise((o,c)=>{s.onsuccess=u=>{o()},r.onerror=u=>{var l;c(rr.create("storage-set",{originalErrorMessage:(l=u.target.error)===null||l===void 0?void 0:l.message}))}})})}function dS(n){return`${n.options.appId}-${n.name}`}var Kd=new Sc("@firebase/app-check");function zd(n,e){return bc()?lS(n,e).catch(t=>{Kd.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function yw(){return fw().enabled}function _w(){return R(this,null,function*(){let n=fw();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var fS={error:"UNKNOWN_ERROR"};function pS(n){return K_.encodeString(JSON.stringify(n),!1)}function Hd(n,e=!1){return R(this,null,function*(){let t=n.app;pw(t);let r=Wt(t),i=r.token,s;if(i&&!Qo(i)&&(r.token=void 0,i=void 0),!i){let u=yield r.cachedTokenPromise;u&&(Qo(u)?i=u:yield zd(t,void 0))}if(!e&&i&&Qo(i))return{token:i.token};let o=!1;if(yw()){r.exchangeTokenPromise||(r.exchangeTokenPromise=gw(mw(t,yield _w()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let u=yield r.exchangeTokenPromise;return yield zd(t,u),r.token=u,{token:u.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield Wt(t).exchangeTokenPromise}catch(u){u.code==="appCheck/throttled"?Kd.warn(u.message):Kd.error(u),s=u}let c;return i?s?Qo(i)?c={token:i.token,internalError:s}:c=hw(s):(c={token:i.token},r.token=i,yield zd(t,i)):c=hw(s),o&&_S(t,c),c})}function gS(n){return R(this,null,function*(){let e=n.app;pw(e);let{provider:t}=Wt(e);if(yw()){let r=yield _w(),{token:i}=yield gw(mw(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function mS(n,e,t,r){let{app:i}=n,s=Wt(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Qo(s.token)){let c=s.token;Promise.resolve().then(()=>{t({token:c.token}),lw(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>lw(n))}function vw(n,e){let t=Wt(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function lw(n){let{app:e}=n,t=Wt(e),r=t.tokenRefresher;r||(r=yS(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function yS(n){let{app:e}=n;return new Gd(()=>R(this,null,function*(){let t=Wt(e),r;if(t.token?r=yield Hd(n,!0):r=yield Hd(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Wt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},uw.RETRIAL_MIN_WAIT,uw.RETRIAL_MAX_WAIT)}function _S(n,e){let t=Wt(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Qo(n){return n.expireTimeMillis-Date.now()>0}function hw(n){return{token:pS(fS),error:n}}var Qd=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Wt(this.app);for(let t of e)vw(this.app,t.next);return Promise.resolve()}};function vS(n,e){return new Qd(n,e)}function wS(n){return{getToken:e=>Hd(n,e),getLimitedUseToken:()=>gS(n),addTokenListener:e=>mS(n,"INTERNAL",e),removeTokenListener:e=>vw(n.app,e)}}var ES="@firebase/app-check",IS="0.8.4";var TS="app-check",dw="app-check-internal";function AS(){Vr(new Pn(TS,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return vS(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(dw).initialize()})),Vr(new Pn(dw,n=>{let e=n.getProvider("app-check").getImmediate();return wS(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Je(ES,IS)}AS();var bS=["localhost","0.0.0.0","127.0.0.1"],oM=typeof window<"u"&&bS.includes(window.location.hostname);var CS="firebase",SS="10.12.0";At.registerVersion(CS,SS,"app-compat");var RS=["ngOnDestroy"],Iw=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(RS.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(c=>{let u=c?.[s];return typeof u=="function"?u.bind(c):u?.then?u.then(l=>t.run(()=>l)):t.run(()=>u)});return new Proxy(()=>{},{get:(c,u)=>o[u],apply:(c,u,l)=>o.then(f=>{let p=f?.(...l);return r?.spy?.apply&&r.spy.apply(s,l,p),p})})})});var ou=class{constructor(e){return e}},$i=new re("angularfire2.app.options"),qi=new re("angularfire2.app.name");function Xo(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=At.apps.filter(c=>c&&c.name===i.name)[0]||e.runOutsideAngular(()=>At.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let c=!!module.hot;PS("error",`${o.name} Firebase App already initialized with different options${c?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new ou(o)}var PS=(n,...e)=>{$h()&&typeof console<"u"&&console[n](...e)},DS={provide:ou,useFactory:Xo,deps:[$i,de,[new Ke,qi]]},Tw=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:$i,useValue:t},{provide:qi,useValue:r}]}}constructor(t){At.registerVersion("angularfire",Gt.full,"core"),At.registerVersion("angularfire",Gt.full,"app-compat"),At.registerVersion("angular",P_.full,t.toString())}static \u0275fac=function(r){return new(r||n)(O(Tt))};static \u0275mod=He({type:n});static \u0275inj=We({providers:[DS]})}return n})();function au(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(c=>c[0]===n)||[];if(s)return kS(i,o)||(Ew("error",`${e} was already initialized on the ${t} Firebase App with different settings.${xS?" You may need to reload as Firebase is not HMR aware.":""}`),Ew("warn",{is:i,was:o})),s;{let c=r();return globalThis.\u0275AngularfireInstanceCache.push([n,c,i]),c}}function kS(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var xS=typeof module<"u"&&!!module.hot,Ew=(n,...e)=>{$h()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Xd=new re("angularfire2.auth.use-emulator"),Jd=new re("angularfire2.auth.settings"),Yd=new re("angularfire2.auth.tenant-id"),Zd=new re("angularfire2.auth.langugage-code"),ef=new re("angularfire2.auth.use-device-language"),tf=new re("angularfire.auth.persistence"),nf=(n,e,t,r,i,s,o,c)=>au(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let u=e.runOutsideAngular(()=>n.auth());if(t&&u.useEmulator(...t),r&&(u.tenantId=r),u.languageCode=i,s&&u.useDeviceLanguage(),o)for(let[l,f]of Object.entries(o))u.settings[l]=f;return c&&u.setPersistence(c),u},[t,r,i,s,o,c]),un=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,c,u,l,f,p,m,E){let k=new Jt,x=J(void 0).pipe(Wn(o.outsideAngular),xe(()=>s.runOutsideAngular(()=>import("./chunk-4HAA3ATJ.js"))),Y(()=>Xo(t,s,r)),Y(D=>nf(D,s,c,l,f,p,u,m)),kh({bufferSize:1,refCount:!1}));if(Rn(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=J(null);else{x.pipe(Yt()).subscribe();let D=x.pipe(xe(V=>V.getRedirectResult().then(W=>W,()=>null)),ft,kh({bufferSize:1,refCount:!1})),$=x.pipe(xe(V=>new Dt(W=>({unsubscribe:s.runOutsideAngular(()=>V.onAuthStateChanged(te=>W.next(te),te=>W.error(te),()=>W.complete()))})))),K=x.pipe(xe(V=>new Dt(W=>({unsubscribe:s.runOutsideAngular(()=>V.onIdTokenChanged(te=>W.next(te),te=>W.error(te),()=>W.complete()))}))));this.authState=D.pipe(xh($),kr(o.outsideAngular),Wn(o.insideAngular)),this.user=D.pipe(xh(K),kr(o.outsideAngular),Wn(o.insideAngular)),this.idToken=this.user.pipe(xe(V=>V?ge(V.getIdToken()):J(null))),this.idTokenResult=this.user.pipe(xe(V=>V?ge(V.getIdTokenResult()):J(null))),this.credential=u_(D,k,this.authState.pipe(It(V=>!V))).pipe(Y(V=>V?.user?V:null),kr(o.outsideAngular),Wn(o.insideAngular))}return Iw(this,x,s,{spy:{apply:(D,$,K)=>{(D.startsWith("signIn")||D.startsWith("createUser"))&&K.then(V=>k.next(V))}}})}static \u0275fac=function(r){return new(r||n)(O($i),O(qi,8),O(Tt),O(de),O(cn),O(Xd,8),O(Jd,8),O(Yd,8),O(Zd,8),O(ef,8),O(tf,8),O(St,8))};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var Aw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},bw={};var ir,rf;(function(){var n;function e(w,y){function v(){}v.prototype=y.prototype,w.D=y.prototype,w.prototype=new v,w.prototype.constructor=w,w.C=function(I,T,b){for(var _=Array(arguments.length-2),In=2;In<arguments.length;In++)_[In-2]=arguments[In];return y.prototype[T].apply(I,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,y,v){v||(v=0);var I=Array(16);if(typeof y=="string")for(var T=0;16>T;++T)I[T]=y.charCodeAt(v++)|y.charCodeAt(v++)<<8|y.charCodeAt(v++)<<16|y.charCodeAt(v++)<<24;else for(T=0;16>T;++T)I[T]=y[v++]|y[v++]<<8|y[v++]<<16|y[v++]<<24;y=w.g[0],v=w.g[1],T=w.g[2];var b=w.g[3],_=y+(b^v&(T^b))+I[0]+3614090360&4294967295;y=v+(_<<7&4294967295|_>>>25),_=b+(T^y&(v^T))+I[1]+3905402710&4294967295,b=y+(_<<12&4294967295|_>>>20),_=T+(v^b&(y^v))+I[2]+606105819&4294967295,T=b+(_<<17&4294967295|_>>>15),_=v+(y^T&(b^y))+I[3]+3250441966&4294967295,v=T+(_<<22&4294967295|_>>>10),_=y+(b^v&(T^b))+I[4]+4118548399&4294967295,y=v+(_<<7&4294967295|_>>>25),_=b+(T^y&(v^T))+I[5]+1200080426&4294967295,b=y+(_<<12&4294967295|_>>>20),_=T+(v^b&(y^v))+I[6]+2821735955&4294967295,T=b+(_<<17&4294967295|_>>>15),_=v+(y^T&(b^y))+I[7]+4249261313&4294967295,v=T+(_<<22&4294967295|_>>>10),_=y+(b^v&(T^b))+I[8]+1770035416&4294967295,y=v+(_<<7&4294967295|_>>>25),_=b+(T^y&(v^T))+I[9]+2336552879&4294967295,b=y+(_<<12&4294967295|_>>>20),_=T+(v^b&(y^v))+I[10]+4294925233&4294967295,T=b+(_<<17&4294967295|_>>>15),_=v+(y^T&(b^y))+I[11]+2304563134&4294967295,v=T+(_<<22&4294967295|_>>>10),_=y+(b^v&(T^b))+I[12]+1804603682&4294967295,y=v+(_<<7&4294967295|_>>>25),_=b+(T^y&(v^T))+I[13]+4254626195&4294967295,b=y+(_<<12&4294967295|_>>>20),_=T+(v^b&(y^v))+I[14]+2792965006&4294967295,T=b+(_<<17&4294967295|_>>>15),_=v+(y^T&(b^y))+I[15]+1236535329&4294967295,v=T+(_<<22&4294967295|_>>>10),_=y+(T^b&(v^T))+I[1]+4129170786&4294967295,y=v+(_<<5&4294967295|_>>>27),_=b+(v^T&(y^v))+I[6]+3225465664&4294967295,b=y+(_<<9&4294967295|_>>>23),_=T+(y^v&(b^y))+I[11]+643717713&4294967295,T=b+(_<<14&4294967295|_>>>18),_=v+(b^y&(T^b))+I[0]+3921069994&4294967295,v=T+(_<<20&4294967295|_>>>12),_=y+(T^b&(v^T))+I[5]+3593408605&4294967295,y=v+(_<<5&4294967295|_>>>27),_=b+(v^T&(y^v))+I[10]+38016083&4294967295,b=y+(_<<9&4294967295|_>>>23),_=T+(y^v&(b^y))+I[15]+3634488961&4294967295,T=b+(_<<14&4294967295|_>>>18),_=v+(b^y&(T^b))+I[4]+3889429448&4294967295,v=T+(_<<20&4294967295|_>>>12),_=y+(T^b&(v^T))+I[9]+568446438&4294967295,y=v+(_<<5&4294967295|_>>>27),_=b+(v^T&(y^v))+I[14]+3275163606&4294967295,b=y+(_<<9&4294967295|_>>>23),_=T+(y^v&(b^y))+I[3]+4107603335&4294967295,T=b+(_<<14&4294967295|_>>>18),_=v+(b^y&(T^b))+I[8]+1163531501&4294967295,v=T+(_<<20&4294967295|_>>>12),_=y+(T^b&(v^T))+I[13]+2850285829&4294967295,y=v+(_<<5&4294967295|_>>>27),_=b+(v^T&(y^v))+I[2]+4243563512&4294967295,b=y+(_<<9&4294967295|_>>>23),_=T+(y^v&(b^y))+I[7]+1735328473&4294967295,T=b+(_<<14&4294967295|_>>>18),_=v+(b^y&(T^b))+I[12]+2368359562&4294967295,v=T+(_<<20&4294967295|_>>>12),_=y+(v^T^b)+I[5]+4294588738&4294967295,y=v+(_<<4&4294967295|_>>>28),_=b+(y^v^T)+I[8]+2272392833&4294967295,b=y+(_<<11&4294967295|_>>>21),_=T+(b^y^v)+I[11]+1839030562&4294967295,T=b+(_<<16&4294967295|_>>>16),_=v+(T^b^y)+I[14]+4259657740&4294967295,v=T+(_<<23&4294967295|_>>>9),_=y+(v^T^b)+I[1]+2763975236&4294967295,y=v+(_<<4&4294967295|_>>>28),_=b+(y^v^T)+I[4]+1272893353&4294967295,b=y+(_<<11&4294967295|_>>>21),_=T+(b^y^v)+I[7]+4139469664&4294967295,T=b+(_<<16&4294967295|_>>>16),_=v+(T^b^y)+I[10]+3200236656&4294967295,v=T+(_<<23&4294967295|_>>>9),_=y+(v^T^b)+I[13]+681279174&4294967295,y=v+(_<<4&4294967295|_>>>28),_=b+(y^v^T)+I[0]+3936430074&4294967295,b=y+(_<<11&4294967295|_>>>21),_=T+(b^y^v)+I[3]+3572445317&4294967295,T=b+(_<<16&4294967295|_>>>16),_=v+(T^b^y)+I[6]+76029189&4294967295,v=T+(_<<23&4294967295|_>>>9),_=y+(v^T^b)+I[9]+3654602809&4294967295,y=v+(_<<4&4294967295|_>>>28),_=b+(y^v^T)+I[12]+3873151461&4294967295,b=y+(_<<11&4294967295|_>>>21),_=T+(b^y^v)+I[15]+530742520&4294967295,T=b+(_<<16&4294967295|_>>>16),_=v+(T^b^y)+I[2]+3299628645&4294967295,v=T+(_<<23&4294967295|_>>>9),_=y+(T^(v|~b))+I[0]+4096336452&4294967295,y=v+(_<<6&4294967295|_>>>26),_=b+(v^(y|~T))+I[7]+1126891415&4294967295,b=y+(_<<10&4294967295|_>>>22),_=T+(y^(b|~v))+I[14]+2878612391&4294967295,T=b+(_<<15&4294967295|_>>>17),_=v+(b^(T|~y))+I[5]+4237533241&4294967295,v=T+(_<<21&4294967295|_>>>11),_=y+(T^(v|~b))+I[12]+1700485571&4294967295,y=v+(_<<6&4294967295|_>>>26),_=b+(v^(y|~T))+I[3]+2399980690&4294967295,b=y+(_<<10&4294967295|_>>>22),_=T+(y^(b|~v))+I[10]+4293915773&4294967295,T=b+(_<<15&4294967295|_>>>17),_=v+(b^(T|~y))+I[1]+2240044497&4294967295,v=T+(_<<21&4294967295|_>>>11),_=y+(T^(v|~b))+I[8]+1873313359&4294967295,y=v+(_<<6&4294967295|_>>>26),_=b+(v^(y|~T))+I[15]+4264355552&4294967295,b=y+(_<<10&4294967295|_>>>22),_=T+(y^(b|~v))+I[6]+2734768916&4294967295,T=b+(_<<15&4294967295|_>>>17),_=v+(b^(T|~y))+I[13]+1309151649&4294967295,v=T+(_<<21&4294967295|_>>>11),_=y+(T^(v|~b))+I[4]+4149444226&4294967295,y=v+(_<<6&4294967295|_>>>26),_=b+(v^(y|~T))+I[11]+3174756917&4294967295,b=y+(_<<10&4294967295|_>>>22),_=T+(y^(b|~v))+I[2]+718787259&4294967295,T=b+(_<<15&4294967295|_>>>17),_=v+(b^(T|~y))+I[9]+3951481745&4294967295,w.g[0]=w.g[0]+y&4294967295,w.g[1]=w.g[1]+(T+(_<<21&4294967295|_>>>11))&4294967295,w.g[2]=w.g[2]+T&4294967295,w.g[3]=w.g[3]+b&4294967295}r.prototype.u=function(w,y){y===void 0&&(y=w.length);for(var v=y-this.blockSize,I=this.B,T=this.h,b=0;b<y;){if(T==0)for(;b<=v;)i(this,w,b),b+=this.blockSize;if(typeof w=="string"){for(;b<y;)if(I[T++]=w.charCodeAt(b++),T==this.blockSize){i(this,I),T=0;break}}else for(;b<y;)if(I[T++]=w[b++],T==this.blockSize){i(this,I),T=0;break}}this.h=T,this.o+=y},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var y=1;y<w.length-8;++y)w[y]=0;var v=8*this.o;for(y=w.length-8;y<w.length;++y)w[y]=v&255,v/=256;for(this.u(w),w=Array(16),y=v=0;4>y;++y)for(var I=0;32>I;I+=8)w[v++]=this.g[y]>>>I&255;return w};function s(w,y){var v=c;return Object.prototype.hasOwnProperty.call(v,w)?v[w]:v[w]=y(w)}function o(w,y){this.h=y;for(var v=[],I=!0,T=w.length-1;0<=T;T--){var b=w[T]|0;I&&b==y||(v[T]=b,I=!1)}this.g=v}var c={};function u(w){return-128<=w&&128>w?s(w,function(y){return new o([y|0],0>y?-1:0)}):new o([w|0],0>w?-1:0)}function l(w){if(isNaN(w)||!isFinite(w))return p;if(0>w)return D(l(-w));for(var y=[],v=1,I=0;w>=v;I++)y[I]=w/v|0,v*=4294967296;return new o(y,0)}function f(w,y){if(w.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(w.charAt(0)=="-")return D(f(w.substring(1),y));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=l(Math.pow(y,8)),I=p,T=0;T<w.length;T+=8){var b=Math.min(8,w.length-T),_=parseInt(w.substring(T,T+b),y);8>b?(b=l(Math.pow(y,b)),I=I.j(b).add(l(_))):(I=I.j(v),I=I.add(l(_)))}return I}var p=u(0),m=u(1),E=u(16777216);n=o.prototype,n.m=function(){if(x(this))return-D(this).m();for(var w=0,y=1,v=0;v<this.g.length;v++){var I=this.i(v);w+=(0<=I?I:4294967296+I)*y,y*=4294967296}return w},n.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(k(this))return"0";if(x(this))return"-"+D(this).toString(w);for(var y=l(Math.pow(w,6)),v=this,I="";;){var T=W(v,y).g;v=$(v,T.j(y));var b=((0<v.g.length?v.g[0]:v.h)>>>0).toString(w);if(v=T,k(v))return b+I;for(;6>b.length;)b="0"+b;I=b+I}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function k(w){if(w.h!=0)return!1;for(var y=0;y<w.g.length;y++)if(w.g[y]!=0)return!1;return!0}function x(w){return w.h==-1}n.l=function(w){return w=$(this,w),x(w)?-1:k(w)?0:1};function D(w){for(var y=w.g.length,v=[],I=0;I<y;I++)v[I]=~w.g[I];return new o(v,~w.h).add(m)}n.abs=function(){return x(this)?D(this):this},n.add=function(w){for(var y=Math.max(this.g.length,w.g.length),v=[],I=0,T=0;T<=y;T++){var b=I+(this.i(T)&65535)+(w.i(T)&65535),_=(b>>>16)+(this.i(T)>>>16)+(w.i(T)>>>16);I=_>>>16,b&=65535,_&=65535,v[T]=_<<16|b}return new o(v,v[v.length-1]&-2147483648?-1:0)};function $(w,y){return w.add(D(y))}n.j=function(w){if(k(this)||k(w))return p;if(x(this))return x(w)?D(this).j(D(w)):D(D(this).j(w));if(x(w))return D(this.j(D(w)));if(0>this.l(E)&&0>w.l(E))return l(this.m()*w.m());for(var y=this.g.length+w.g.length,v=[],I=0;I<2*y;I++)v[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<w.g.length;T++){var b=this.i(I)>>>16,_=this.i(I)&65535,In=w.i(T)>>>16,js=w.i(T)&65535;v[2*I+2*T]+=_*js,K(v,2*I+2*T),v[2*I+2*T+1]+=b*js,K(v,2*I+2*T+1),v[2*I+2*T+1]+=_*In,K(v,2*I+2*T+1),v[2*I+2*T+2]+=b*In,K(v,2*I+2*T+2)}for(I=0;I<y;I++)v[I]=v[2*I+1]<<16|v[2*I];for(I=y;I<2*y;I++)v[I]=0;return new o(v,0)};function K(w,y){for(;(w[y]&65535)!=w[y];)w[y+1]+=w[y]>>>16,w[y]&=65535,y++}function V(w,y){this.g=w,this.h=y}function W(w,y){if(k(y))throw Error("division by zero");if(k(w))return new V(p,p);if(x(w))return y=W(D(w),y),new V(D(y.g),D(y.h));if(x(y))return y=W(w,D(y)),new V(D(y.g),y.h);if(30<w.g.length){if(x(w)||x(y))throw Error("slowDivide_ only works with positive integers.");for(var v=m,I=y;0>=I.l(w);)v=te(v),I=te(I);var T=ne(v,1),b=ne(I,1);for(I=ne(I,2),v=ne(v,2);!k(I);){var _=b.add(I);0>=_.l(w)&&(T=T.add(v),b=_),I=ne(I,1),v=ne(v,1)}return y=$(w,T.j(y)),new V(T,y)}for(T=p;0<=w.l(y);){for(v=Math.max(1,Math.floor(w.m()/y.m())),I=Math.ceil(Math.log(v)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),b=l(v),_=b.j(y);x(_)||0<_.l(w);)v-=I,b=l(v),_=b.j(y);k(b)&&(b=m),T=T.add(b),w=$(w,_)}return new V(T,w)}n.A=function(w){return W(this,w).h},n.and=function(w){for(var y=Math.max(this.g.length,w.g.length),v=[],I=0;I<y;I++)v[I]=this.i(I)&w.i(I);return new o(v,this.h&w.h)},n.or=function(w){for(var y=Math.max(this.g.length,w.g.length),v=[],I=0;I<y;I++)v[I]=this.i(I)|w.i(I);return new o(v,this.h|w.h)},n.xor=function(w){for(var y=Math.max(this.g.length,w.g.length),v=[],I=0;I<y;I++)v[I]=this.i(I)^w.i(I);return new o(v,this.h^w.h)};function te(w){for(var y=w.g.length+1,v=[],I=0;I<y;I++)v[I]=w.i(I)<<1|w.i(I-1)>>>31;return new o(v,w.h)}function ne(w,y){var v=y>>5;y%=32;for(var I=w.g.length-v,T=[],b=0;b<I;b++)T[b]=0<y?w.i(b+v)>>>y|w.i(b+v+1)<<32-y:w.i(b+v);return new o(T,w.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,rf=bw.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=f,ir=bw.Integer=o}).apply(typeof Aw<"u"?Aw:typeof self<"u"?self:typeof window<"u"?window:{});var cu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Dn={};var sf,of,zi,af,Yo,uu,cf,uf,lf;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,h,d){return a==Array.prototype||a==Object.prototype||(a[h]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof cu=="object"&&cu];for(var h=0;h<a.length;++h){var d=a[h];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function i(a,h){if(h)e:{var d=r;a=a.split(".");for(var g=0;g<a.length-1;g++){var A=a[g];if(!(A in d))break e;d=d[A]}a=a[a.length-1],g=d[a],h=h(g),h!=g&&h!=null&&e(d,a,{configurable:!0,writable:!0,value:h})}}function s(a,h){a instanceof String&&(a+="");var d=0,g=!1,A={next:function(){if(!g&&d<a.length){var S=d++;return{value:h(S,a[S]),done:!1}}return g=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(a){return a||function(){return s(this,function(h,d){return d})}});var o=o||{},c=this||self;function u(a){var h=typeof a;return h=h!="object"?h:a?Array.isArray(a)?"array":h:"null",h=="array"||h=="object"&&typeof a.length=="number"}function l(a){var h=typeof a;return h=="object"&&a!=null||h=="function"}function f(a,h,d){return a.call.apply(a.bind,arguments)}function p(a,h,d){if(!a)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,g),a.apply(h,A)}}return function(){return a.apply(h,arguments)}}function m(a,h,d){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,m.apply(null,arguments)}function E(a,h){var d=Array.prototype.slice.call(arguments,1);return function(){var g=d.slice();return g.push.apply(g,arguments),a.apply(this,g)}}function k(a,h){function d(){}d.prototype=h.prototype,a.aa=h.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(g,A,S){for(var F=Array(arguments.length-2),me=2;me<arguments.length;me++)F[me-2]=arguments[me];return h.prototype[A].apply(g,F)}}function x(a){let h=a.length;if(0<h){let d=Array(h);for(let g=0;g<h;g++)d[g]=a[g];return d}return[]}function D(a,h){for(let d=1;d<arguments.length;d++){let g=arguments[d];if(u(g)){let A=a.length||0,S=g.length||0;a.length=A+S;for(let F=0;F<S;F++)a[A+F]=g[F]}else a.push(g)}}class ${constructor(h,d){this.i=h,this.j=d,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function K(a){return/^[\s\xa0]*$/.test(a)}function V(){var a=c.navigator;return a&&(a=a.userAgent)?a:""}function W(a){return W[" "](a),a}W[" "]=function(){};var te=V().indexOf("Gecko")!=-1&&!(V().toLowerCase().indexOf("webkit")!=-1&&V().indexOf("Edge")==-1)&&!(V().indexOf("Trident")!=-1||V().indexOf("MSIE")!=-1)&&V().indexOf("Edge")==-1;function ne(a,h,d){for(let g in a)h.call(d,a[g],g,a)}function w(a,h){for(let d in a)h.call(void 0,a[d],d,a)}function y(a){let h={};for(let d in a)h[d]=a[d];return h}let v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(a,h){let d,g;for(let A=1;A<arguments.length;A++){g=arguments[A];for(d in g)a[d]=g[d];for(let S=0;S<v.length;S++)d=v[S],Object.prototype.hasOwnProperty.call(g,d)&&(a[d]=g[d])}}function T(a){var h=1;a=a.split(":");let d=[];for(;0<h&&a.length;)d.push(a.shift()),h--;return a.length&&d.push(a.join(":")),d}function b(a){c.setTimeout(()=>{throw a},0)}function _(){var a=Zl;let h=null;return a.g&&(h=a.g,a.g=a.g.next,a.g||(a.h=null),h.next=null),h}class In{constructor(){this.h=this.g=null}add(h,d){let g=js.get();g.set(h,d),this.h?this.h.next=g:this.g=g,this.h=g}}var js=new $(()=>new jT,a=>a.reset());class jT{constructor(){this.next=this.g=this.h=null}set(h,d){this.h=h,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Bs,$s=!1,Zl=new In,ey=()=>{let a=c.Promise.resolve(void 0);Bs=()=>{a.then(BT)}};var BT=()=>{for(var a;a=_();){try{a.h.call(a.g)}catch(d){b(d)}var h=js;h.j(a),100>h.h&&(h.h++,a.next=h.g,h.g=a)}$s=!1};function Bn(){this.s=this.s,this.C=this.C}Bn.prototype.s=!1,Bn.prototype.ma=function(){this.s||(this.s=!0,this.N())},Bn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function it(a,h){this.type=a,this.g=this.target=h,this.defaultPrevented=!1}it.prototype.h=function(){this.defaultPrevented=!0};var $T=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var a=!1,h=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};c.addEventListener("test",d,h),c.removeEventListener("test",d,h)}catch{}return a}();function qs(a,h){if(it.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,g=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=h,h=a.relatedTarget){if(te){e:{try{W(h.nodeName);var A=!0;break e}catch{}A=!1}A||(h=null)}}else d=="mouseover"?h=a.fromElement:d=="mouseout"&&(h=a.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:qT[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&qs.aa.h.call(this)}}k(qs,it);var qT={2:"touch",3:"pen",4:"mouse"};qs.prototype.h=function(){qs.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var zs="closure_listenable_"+(1e6*Math.random()|0),zT=0;function GT(a,h,d,g,A){this.listener=a,this.proxy=null,this.src=h,this.type=d,this.capture=!!g,this.ha=A,this.key=++zT,this.da=this.fa=!1}function Ga(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Wa(a){this.src=a,this.g={},this.h=0}Wa.prototype.add=function(a,h,d,g,A){var S=a.toString();a=this.g[S],a||(a=this.g[S]=[],this.h++);var F=th(a,h,g,A);return-1<F?(h=a[F],d||(h.fa=!1)):(h=new GT(h,this.src,S,!!g,A),h.fa=d,a.push(h)),h};function eh(a,h){var d=h.type;if(d in a.g){var g=a.g[d],A=Array.prototype.indexOf.call(g,h,void 0),S;(S=0<=A)&&Array.prototype.splice.call(g,A,1),S&&(Ga(h),a.g[d].length==0&&(delete a.g[d],a.h--))}}function th(a,h,d,g){for(var A=0;A<a.length;++A){var S=a[A];if(!S.da&&S.listener==h&&S.capture==!!d&&S.ha==g)return A}return-1}var nh="closure_lm_"+(1e6*Math.random()|0),rh={};function ty(a,h,d,g,A){if(g&&g.once)return ry(a,h,d,g,A);if(Array.isArray(h)){for(var S=0;S<h.length;S++)ty(a,h[S],d,g,A);return null}return d=ah(d),a&&a[zs]?a.K(h,d,l(g)?!!g.capture:!!g,A):ny(a,h,d,!1,g,A)}function ny(a,h,d,g,A,S){if(!h)throw Error("Invalid event type");var F=l(A)?!!A.capture:!!A,me=sh(a);if(me||(a[nh]=me=new Wa(a)),d=me.add(h,d,g,F,S),d.proxy)return d;if(g=WT(),d.proxy=g,g.src=a,g.listener=d,a.addEventListener)$T||(A=F),A===void 0&&(A=!1),a.addEventListener(h.toString(),g,A);else if(a.attachEvent)a.attachEvent(sy(h.toString()),g);else if(a.addListener&&a.removeListener)a.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return d}function WT(){function a(d){return h.call(a.src,a.listener,d)}let h=KT;return a}function ry(a,h,d,g,A){if(Array.isArray(h)){for(var S=0;S<h.length;S++)ry(a,h[S],d,g,A);return null}return d=ah(d),a&&a[zs]?a.L(h,d,l(g)?!!g.capture:!!g,A):ny(a,h,d,!0,g,A)}function iy(a,h,d,g,A){if(Array.isArray(h))for(var S=0;S<h.length;S++)iy(a,h[S],d,g,A);else g=l(g)?!!g.capture:!!g,d=ah(d),a&&a[zs]?(a=a.i,h=String(h).toString(),h in a.g&&(S=a.g[h],d=th(S,d,g,A),-1<d&&(Ga(S[d]),Array.prototype.splice.call(S,d,1),S.length==0&&(delete a.g[h],a.h--)))):a&&(a=sh(a))&&(h=a.g[h.toString()],a=-1,h&&(a=th(h,d,g,A)),(d=-1<a?h[a]:null)&&ih(d))}function ih(a){if(typeof a!="number"&&a&&!a.da){var h=a.src;if(h&&h[zs])eh(h.i,a);else{var d=a.type,g=a.proxy;h.removeEventListener?h.removeEventListener(d,g,a.capture):h.detachEvent?h.detachEvent(sy(d),g):h.addListener&&h.removeListener&&h.removeListener(g),(d=sh(h))?(eh(d,a),d.h==0&&(d.src=null,h[nh]=null)):Ga(a)}}}function sy(a){return a in rh?rh[a]:rh[a]="on"+a}function KT(a,h){if(a.da)a=!0;else{h=new qs(h,this);var d=a.listener,g=a.ha||a.src;a.fa&&ih(a),a=d.call(g,h)}return a}function sh(a){return a=a[nh],a instanceof Wa?a:null}var oh="__closure_events_fn_"+(1e9*Math.random()>>>0);function ah(a){return typeof a=="function"?a:(a[oh]||(a[oh]=function(h){return a.handleEvent(h)}),a[oh])}function st(){Bn.call(this),this.i=new Wa(this),this.M=this,this.F=null}k(st,Bn),st.prototype[zs]=!0,st.prototype.removeEventListener=function(a,h,d,g){iy(this,a,h,d,g)};function ht(a,h){var d,g=a.F;if(g)for(d=[];g;g=g.F)d.push(g);if(a=a.M,g=h.type||h,typeof h=="string")h=new it(h,a);else if(h instanceof it)h.target=h.target||a;else{var A=h;h=new it(g,a),I(h,A)}if(A=!0,d)for(var S=d.length-1;0<=S;S--){var F=h.g=d[S];A=Ka(F,g,!0,h)&&A}if(F=h.g=a,A=Ka(F,g,!0,h)&&A,A=Ka(F,g,!1,h)&&A,d)for(S=0;S<d.length;S++)F=h.g=d[S],A=Ka(F,g,!1,h)&&A}st.prototype.N=function(){if(st.aa.N.call(this),this.i){var a=this.i,h;for(h in a.g){for(var d=a.g[h],g=0;g<d.length;g++)Ga(d[g]);delete a.g[h],a.h--}}this.F=null},st.prototype.K=function(a,h,d,g){return this.i.add(String(a),h,!1,d,g)},st.prototype.L=function(a,h,d,g){return this.i.add(String(a),h,!0,d,g)};function Ka(a,h,d,g){if(h=a.i.g[String(h)],!h)return!0;h=h.concat();for(var A=!0,S=0;S<h.length;++S){var F=h[S];if(F&&!F.da&&F.capture==d){var me=F.listener,nt=F.ha||F.src;F.fa&&eh(a.i,F),A=me.call(nt,g)!==!1&&A}}return A&&!g.defaultPrevented}function oy(a,h,d){if(typeof a=="function")d&&(a=m(a,d));else if(a&&typeof a.handleEvent=="function")a=m(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:c.setTimeout(a,h||0)}function ay(a){a.g=oy(()=>{a.g=null,a.i&&(a.i=!1,ay(a))},a.l);let h=a.h;a.h=null,a.m.apply(null,h)}class HT extends Bn{constructor(h,d){super(),this.m=h,this.l=d,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:ay(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Gs(a){Bn.call(this),this.h=a,this.g={}}k(Gs,Bn);var cy=[];function uy(a){ne(a.g,function(h,d){this.g.hasOwnProperty(d)&&ih(h)},a),a.g={}}Gs.prototype.N=function(){Gs.aa.N.call(this),uy(this)},Gs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ch=c.JSON.stringify,QT=c.JSON.parse,XT=class{stringify(a){return c.JSON.stringify(a,void 0)}parse(a){return c.JSON.parse(a,void 0)}};function uh(){}uh.prototype.h=null;function ly(a){return a.h||(a.h=a.i())}function hy(){}var Ws={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function lh(){it.call(this,"d")}k(lh,it);function hh(){it.call(this,"c")}k(hh,it);var Sr={},dy=null;function Ha(){return dy=dy||new st}Sr.La="serverreachability";function fy(a){it.call(this,Sr.La,a)}k(fy,it);function Ks(a){let h=Ha();ht(h,new fy(h))}Sr.STAT_EVENT="statevent";function py(a,h){it.call(this,Sr.STAT_EVENT,a),this.stat=h}k(py,it);function dt(a){let h=Ha();ht(h,new py(h,a))}Sr.Ma="timingevent";function gy(a,h){it.call(this,Sr.Ma,a),this.size=h}k(gy,it);function Hs(a,h){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){a()},h)}function Qs(){this.g=!0}Qs.prototype.xa=function(){this.g=!1};function JT(a,h,d,g,A,S){a.info(function(){if(a.g)if(S)for(var F="",me=S.split("&"),nt=0;nt<me.length;nt++){var he=me[nt].split("=");if(1<he.length){var ot=he[0];he=he[1];var at=ot.split("_");F=2<=at.length&&at[1]=="type"?F+(ot+"="+he+"&"):F+(ot+"=redacted&")}}else F=null;else F=S;return"XMLHTTP REQ ("+g+") [attempt "+A+"]: "+h+`
`+d+`
`+F})}function YT(a,h,d,g,A,S,F){a.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+A+"]: "+h+`
`+d+`
`+S+" "+F})}function yi(a,h,d,g){a.info(function(){return"XMLHTTP TEXT ("+h+"): "+eA(a,d)+(g?" "+g:"")})}function ZT(a,h){a.info(function(){return"TIMEOUT: "+h})}Qs.prototype.info=function(){};function eA(a,h){if(!a.g)return h;if(!h)return null;try{var d=JSON.parse(h);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var g=d[a];if(!(2>g.length)){var A=g[1];if(Array.isArray(A)&&!(1>A.length)){var S=A[0];if(S!="noop"&&S!="stop"&&S!="close")for(var F=1;F<A.length;F++)A[F]=""}}}}return ch(d)}catch{return h}}var Qa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},my={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},dh;function Xa(){}k(Xa,uh),Xa.prototype.g=function(){return new XMLHttpRequest},Xa.prototype.i=function(){return{}},dh=new Xa;function $n(a,h,d,g){this.j=a,this.i=h,this.l=d,this.R=g||1,this.U=new Gs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new yy}function yy(){this.i=null,this.g="",this.h=!1}var _y={},fh={};function ph(a,h,d){a.L=1,a.v=ec(Tn(h)),a.m=d,a.P=!0,vy(a,null)}function vy(a,h){a.F=Date.now(),Ja(a),a.A=Tn(a.v);var d=a.A,g=a.R;Array.isArray(g)||(g=[String(g)]),My(d.i,"t",g),a.C=0,d=a.j.J,a.h=new yy,a.g=Jy(a.j,d?h:null,!a.m),0<a.O&&(a.M=new HT(m(a.Y,a,a.g),a.O)),h=a.U,d=a.g,g=a.ca;var A="readystatechange";Array.isArray(A)||(A&&(cy[0]=A.toString()),A=cy);for(var S=0;S<A.length;S++){var F=ty(d,A[S],g||h.handleEvent,!1,h.h||h);if(!F)break;h.g[F.key]=F}h=a.H?y(a.H):{},a.m?(a.u||(a.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,h)):(a.u="GET",a.g.ea(a.A,a.u,null,h)),Ks(),JT(a.i,a.u,a.A,a.l,a.R,a.m)}$n.prototype.ca=function(a){a=a.target;let h=this.M;h&&An(a)==3?h.j():this.Y(a)},$n.prototype.Y=function(a){try{if(a==this.g)e:{let at=An(this.g);var h=this.g.Ba();let wi=this.g.Z();if(!(3>at)&&(at!=3||this.g&&(this.h.h||this.g.oa()||jy(this.g)))){this.J||at!=4||h==7||(h==8||0>=wi?Ks(3):Ks(2)),gh(this);var d=this.g.Z();this.X=d;t:if(wy(this)){var g=jy(this.g);a="";var A=g.length,S=An(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Rr(this),Xs(this);var F="";break t}this.h.i=new c.TextDecoder}for(h=0;h<A;h++)this.h.h=!0,a+=this.h.i.decode(g[h],{stream:!(S&&h==A-1)});g.length=0,this.h.g+=a,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=d==200,YT(this.i,this.u,this.A,this.l,this.R,at,d),this.o){if(this.T&&!this.K){t:{if(this.g){var me,nt=this.g;if((me=nt.g?nt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(me)){var he=me;break t}}he=null}if(d=he)yi(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,mh(this,d);else{this.o=!1,this.s=3,dt(12),Rr(this),Xs(this);break e}}if(this.P){d=!0;let Ut;for(;!this.J&&this.C<F.length;)if(Ut=tA(this,F),Ut==fh){at==4&&(this.s=4,dt(14),d=!1),yi(this.i,this.l,null,"[Incomplete Response]");break}else if(Ut==_y){this.s=4,dt(15),yi(this.i,this.l,F,"[Invalid Chunk]"),d=!1;break}else yi(this.i,this.l,Ut,null),mh(this,Ut);if(wy(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),at!=4||F.length!=0||this.h.h||(this.s=1,dt(16),d=!1),this.o=this.o&&d,!d)yi(this.i,this.l,F,"[Invalid Chunked Response]"),Rr(this),Xs(this);else if(0<F.length&&!this.W){this.W=!0;var ot=this.j;ot.g==this&&ot.ba&&!ot.M&&(ot.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Ih(ot),ot.M=!0,dt(11))}}else yi(this.i,this.l,F,null),mh(this,F);at==4&&Rr(this),this.o&&!this.J&&(at==4?Ky(this.j,this):(this.o=!1,Ja(this)))}else _A(this.g),d==400&&0<F.indexOf("Unknown SID")?(this.s=3,dt(12)):(this.s=0,dt(13)),Rr(this),Xs(this)}}}catch{}finally{}};function wy(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function tA(a,h){var d=a.C,g=h.indexOf(`
`,d);return g==-1?fh:(d=Number(h.substring(d,g)),isNaN(d)?_y:(g+=1,g+d>h.length?fh:(h=h.slice(g,g+d),a.C=g+d,h)))}$n.prototype.cancel=function(){this.J=!0,Rr(this)};function Ja(a){a.S=Date.now()+a.I,Ey(a,a.I)}function Ey(a,h){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Hs(m(a.ba,a),h)}function gh(a){a.B&&(c.clearTimeout(a.B),a.B=null)}$n.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(ZT(this.i,this.A),this.L!=2&&(Ks(),dt(17)),Rr(this),this.s=2,Xs(this)):Ey(this,this.S-a)};function Xs(a){a.j.G==0||a.J||Ky(a.j,a)}function Rr(a){gh(a);var h=a.M;h&&typeof h.ma=="function"&&h.ma(),a.M=null,uy(a.U),a.g&&(h=a.g,a.g=null,h.abort(),h.ma())}function mh(a,h){try{var d=a.j;if(d.G!=0&&(d.g==a||yh(d.h,a))){if(!a.K&&yh(d.h,a)&&d.G==3){try{var g=d.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var A=g;if(A[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)sc(d),rc(d);else break e;Eh(d),dt(18)}}else d.za=A[1],0<d.za-d.T&&37500>A[2]&&d.F&&d.v==0&&!d.C&&(d.C=Hs(m(d.Za,d),6e3));if(1>=Ay(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Dr(d,11)}else if((a.K||d.g==a)&&sc(d),!K(h))for(A=d.Da.g.parse(h),h=0;h<A.length;h++){let he=A[h];if(d.T=he[0],he=he[1],d.G==2)if(he[0]=="c"){d.K=he[1],d.ia=he[2];let ot=he[3];ot!=null&&(d.la=ot,d.j.info("VER="+d.la));let at=he[4];at!=null&&(d.Aa=at,d.j.info("SVER="+d.Aa));let wi=he[5];wi!=null&&typeof wi=="number"&&0<wi&&(g=1.5*wi,d.L=g,d.j.info("backChannelRequestTimeoutMs_="+g)),g=d;let Ut=a.g;if(Ut){let ac=Ut.g?Ut.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ac){var S=g.h;S.g||ac.indexOf("spdy")==-1&&ac.indexOf("quic")==-1&&ac.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(_h(S,S.h),S.h=null))}if(g.D){let Th=Ut.g?Ut.g.getResponseHeader("X-HTTP-Session-Id"):null;Th&&(g.ya=Th,be(g.I,g.D,Th))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),g=d;var F=a;if(g.qa=Xy(g,g.J?g.ia:null,g.W),F.K){by(g.h,F);var me=F,nt=g.L;nt&&(me.I=nt),me.B&&(gh(me),Ja(me)),g.g=F}else Gy(g);0<d.i.length&&ic(d)}else he[0]!="stop"&&he[0]!="close"||Dr(d,7);else d.G==3&&(he[0]=="stop"||he[0]=="close"?he[0]=="stop"?Dr(d,7):wh(d):he[0]!="noop"&&d.l&&d.l.ta(he),d.v=0)}}Ks(4)}catch{}}var nA=class{constructor(a,h){this.g=a,this.map=h}};function Iy(a){this.l=a||10,c.PerformanceNavigationTiming?(a=c.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ty(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Ay(a){return a.h?1:a.g?a.g.size:0}function yh(a,h){return a.h?a.h==h:a.g?a.g.has(h):!1}function _h(a,h){a.g?a.g.add(h):a.h=h}function by(a,h){a.h&&a.h==h?a.h=null:a.g&&a.g.has(h)&&a.g.delete(h)}Iy.prototype.cancel=function(){if(this.i=Cy(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Cy(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let h=a.i;for(let d of a.g.values())h=h.concat(d.D);return h}return x(a.i)}function rA(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(u(a)){for(var h=[],d=a.length,g=0;g<d;g++)h.push(a[g]);return h}h=[],d=0;for(g in a)h[d++]=a[g];return h}function iA(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||typeof a=="string"){var h=[];a=a.length;for(var d=0;d<a;d++)h.push(d);return h}h=[],d=0;for(let g in a)h[d++]=g;return h}}}function Sy(a,h){if(a.forEach&&typeof a.forEach=="function")a.forEach(h,void 0);else if(u(a)||typeof a=="string")Array.prototype.forEach.call(a,h,void 0);else for(var d=iA(a),g=rA(a),A=g.length,S=0;S<A;S++)h.call(void 0,g[S],d&&d[S],a)}var Ry=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sA(a,h){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var g=a[d].indexOf("="),A=null;if(0<=g){var S=a[d].substring(0,g);A=a[d].substring(g+1)}else S=a[d];h(S,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Pr(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof Pr){this.h=a.h,Ya(this,a.j),this.o=a.o,this.g=a.g,Za(this,a.s),this.l=a.l;var h=a.i,d=new Zs;d.i=h.i,h.g&&(d.g=new Map(h.g),d.h=h.h),Py(this,d),this.m=a.m}else a&&(h=String(a).match(Ry))?(this.h=!1,Ya(this,h[1]||"",!0),this.o=Js(h[2]||""),this.g=Js(h[3]||"",!0),Za(this,h[4]),this.l=Js(h[5]||"",!0),Py(this,h[6]||"",!0),this.m=Js(h[7]||"")):(this.h=!1,this.i=new Zs(null,this.h))}Pr.prototype.toString=function(){var a=[],h=this.j;h&&a.push(Ys(h,Dy,!0),":");var d=this.g;return(d||h=="file")&&(a.push("//"),(h=this.o)&&a.push(Ys(h,Dy,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(Ys(d,d.charAt(0)=="/"?cA:aA,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",Ys(d,lA)),a.join("")};function Tn(a){return new Pr(a)}function Ya(a,h,d){a.j=d?Js(h,!0):h,a.j&&(a.j=a.j.replace(/:$/,""))}function Za(a,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);a.s=h}else a.s=null}function Py(a,h,d){h instanceof Zs?(a.i=h,hA(a.i,a.h)):(d||(h=Ys(h,uA)),a.i=new Zs(h,a.h))}function be(a,h,d){a.i.set(h,d)}function ec(a){return be(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Js(a,h){return a?h?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Ys(a,h,d){return typeof a=="string"?(a=encodeURI(a).replace(h,oA),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function oA(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Dy=/[#\/\?@]/g,aA=/[#\?:]/g,cA=/[#\?]/g,uA=/[#\?@]/g,lA=/#/g;function Zs(a,h){this.h=this.g=null,this.i=a||null,this.j=!!h}function qn(a){a.g||(a.g=new Map,a.h=0,a.i&&sA(a.i,function(h,d){a.add(decodeURIComponent(h.replace(/\+/g," ")),d)}))}n=Zs.prototype,n.add=function(a,h){qn(this),this.i=null,a=_i(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(h),this.h+=1,this};function ky(a,h){qn(a),h=_i(a,h),a.g.has(h)&&(a.i=null,a.h-=a.g.get(h).length,a.g.delete(h))}function xy(a,h){return qn(a),h=_i(a,h),a.g.has(h)}n.forEach=function(a,h){qn(this),this.g.forEach(function(d,g){d.forEach(function(A){a.call(h,A,g,this)},this)},this)},n.na=function(){qn(this);let a=Array.from(this.g.values()),h=Array.from(this.g.keys()),d=[];for(let g=0;g<h.length;g++){let A=a[g];for(let S=0;S<A.length;S++)d.push(h[g])}return d},n.V=function(a){qn(this);let h=[];if(typeof a=="string")xy(this,a)&&(h=h.concat(this.g.get(_i(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)h=h.concat(a[d])}return h},n.set=function(a,h){return qn(this),this.i=null,a=_i(this,a),xy(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[h]),this.h+=1,this},n.get=function(a,h){return a?(a=this.V(a),0<a.length?String(a[0]):h):h};function My(a,h,d){ky(a,h),0<d.length&&(a.i=null,a.g.set(_i(a,h),x(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],h=Array.from(this.g.keys());for(var d=0;d<h.length;d++){var g=h[d];let S=encodeURIComponent(String(g)),F=this.V(g);for(g=0;g<F.length;g++){var A=S;F[g]!==""&&(A+="="+encodeURIComponent(String(F[g]))),a.push(A)}}return this.i=a.join("&")};function _i(a,h){return h=String(h),a.j&&(h=h.toLowerCase()),h}function hA(a,h){h&&!a.j&&(qn(a),a.i=null,a.g.forEach(function(d,g){var A=g.toLowerCase();g!=A&&(ky(this,g),My(this,A,d))},a)),a.j=h}function dA(a,h){let d=new Qs;if(c.Image){let g=new Image;g.onload=E(zn,d,"TestLoadImage: loaded",!0,h,g),g.onerror=E(zn,d,"TestLoadImage: error",!1,h,g),g.onabort=E(zn,d,"TestLoadImage: abort",!1,h,g),g.ontimeout=E(zn,d,"TestLoadImage: timeout",!1,h,g),c.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=a}else h(!1)}function fA(a,h){let d=new Qs,g=new AbortController,A=setTimeout(()=>{g.abort(),zn(d,"TestPingServer: timeout",!1,h)},1e4);fetch(a,{signal:g.signal}).then(S=>{clearTimeout(A),S.ok?zn(d,"TestPingServer: ok",!0,h):zn(d,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(A),zn(d,"TestPingServer: error",!1,h)})}function zn(a,h,d,g,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),g(d)}catch{}}function pA(){this.g=new XT}function gA(a,h,d){let g=d||"";try{Sy(a,function(A,S){let F=A;l(A)&&(F=ch(A)),h.push(g+S+"="+encodeURIComponent(F))})}catch(A){throw h.push(g+"type="+encodeURIComponent("_badmap")),A}}function eo(a){this.l=a.Ub||null,this.j=a.eb||!1}k(eo,uh),eo.prototype.g=function(){return new tc(this.l,this.j)},eo.prototype.i=function(a){return function(){return a}}({});function tc(a,h){st.call(this),this.D=a,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(tc,st),n=tc.prototype,n.open=function(a,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=h,this.readyState=1,no(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(h.body=a),(this.D||c).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,to(this)),this.readyState=0},n.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,no(this)),this.g&&(this.readyState=3,no(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ny(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ny(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}n.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var h=a.value?a.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!a.done}))&&(this.response=this.responseText+=h)}a.done?to(this):no(this),this.readyState==3&&Ny(this)}},n.Ra=function(a){this.g&&(this.response=this.responseText=a,to(this))},n.Qa=function(a){this.g&&(this.response=a,to(this))},n.ga=function(){this.g&&to(this)};function to(a){a.readyState=4,a.l=null,a.j=null,a.v=null,no(a)}n.setRequestHeader=function(a,h){this.u.append(a,h)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],h=this.h.entries();for(var d=h.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=h.next();return a.join(`\r
`)};function no(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(tc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Vy(a){let h="";return ne(a,function(d,g){h+=g,h+=":",h+=d,h+=`\r
`}),h}function vh(a,h,d){e:{for(g in d){var g=!1;break e}g=!0}g||(d=Vy(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):be(a,h,d))}function ke(a){st.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(ke,st);var mA=/^https?$/i,yA=["POST","PUT"];n=ke.prototype,n.Ha=function(a){this.J=a},n.ea=function(a,h,d,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);h=h?h.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():dh.g(),this.v=this.o?ly(this.o):ly(dh),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(h,String(a),!0),this.B=!1}catch(S){Oy(this,S);return}if(a=d||"",d=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var A in g)d.set(A,g[A]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let S of g.keys())d.set(S,g.get(S));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(d.keys()).find(S=>S.toLowerCase()=="content-type"),A=c.FormData&&a instanceof c.FormData,!(0<=Array.prototype.indexOf.call(yA,h,void 0))||g||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,F]of d)this.g.setRequestHeader(S,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Uy(this),this.u=!0,this.g.send(a),this.u=!1}catch(S){Oy(this,S)}};function Oy(a,h){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=h,a.m=5,Fy(a),nc(a)}function Fy(a){a.A||(a.A=!0,ht(a,"complete"),ht(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,ht(this,"complete"),ht(this,"abort"),nc(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),nc(this,!0)),ke.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ly(this):this.bb())},n.bb=function(){Ly(this)};function Ly(a){if(a.h&&typeof o<"u"&&(!a.v[1]||An(a)!=4||a.Z()!=2)){if(a.u&&An(a)==4)oy(a.Ea,0,a);else if(ht(a,"readystatechange"),An(a)==4){a.h=!1;try{let F=a.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var d;if(!(d=h)){var g;if(g=F===0){var A=String(a.D).match(Ry)[1]||null;!A&&c.self&&c.self.location&&(A=c.self.location.protocol.slice(0,-1)),g=!mA.test(A?A.toLowerCase():"")}d=g}if(d)ht(a,"complete"),ht(a,"success");else{a.m=6;try{var S=2<An(a)?a.g.statusText:""}catch{S=""}a.l=S+" ["+a.Z()+"]",Fy(a)}}finally{nc(a)}}}}function nc(a,h){if(a.g){Uy(a);let d=a.g,g=a.v[0]?()=>{}:null;a.g=null,a.v=null,h||ht(a,"ready");try{d.onreadystatechange=g}catch{}}}function Uy(a){a.I&&(c.clearTimeout(a.I),a.I=null)}n.isActive=function(){return!!this.g};function An(a){return a.g?a.g.readyState:0}n.Z=function(){try{return 2<An(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(a){if(this.g){var h=this.g.responseText;return a&&h.indexOf(a)==0&&(h=h.substring(a.length)),QT(h)}};function jy(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function _A(a){let h={};a=(a.g&&2<=An(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<a.length;g++){if(K(a[g]))continue;var d=T(a[g]);let A=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let S=h[A]||[];h[A]=S,S.push(d)}w(h,function(g){return g.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ro(a,h,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||h}function By(a){this.Aa=0,this.i=[],this.j=new Qs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ro("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ro("baseRetryDelayMs",5e3,a),this.cb=ro("retryDelaySeedMs",1e4,a),this.Wa=ro("forwardChannelMaxRetries",2,a),this.wa=ro("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Iy(a&&a.concurrentRequestLimit),this.Da=new pA,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=By.prototype,n.la=8,n.G=1,n.connect=function(a,h,d,g){dt(0),this.W=a,this.H=h||{},d&&g!==void 0&&(this.H.OSID=d,this.H.OAID=g),this.F=this.X,this.I=Xy(this,null,this.W),ic(this)};function wh(a){if($y(a),a.G==3){var h=a.U++,d=Tn(a.I);if(be(d,"SID",a.K),be(d,"RID",h),be(d,"TYPE","terminate"),io(a,d),h=new $n(a,a.j,h),h.L=2,h.v=ec(Tn(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(h.v.toString(),"")}catch{}!d&&c.Image&&(new Image().src=h.v,d=!0),d||(h.g=Jy(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Ja(h)}Qy(a)}function rc(a){a.g&&(Ih(a),a.g.cancel(),a.g=null)}function $y(a){rc(a),a.u&&(c.clearTimeout(a.u),a.u=null),sc(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&c.clearTimeout(a.s),a.s=null)}function ic(a){if(!Ty(a.h)&&!a.s){a.s=!0;var h=a.Ga;Bs||ey(),$s||(Bs(),$s=!0),Zl.add(h,a),a.B=0}}function vA(a,h){return Ay(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=h.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Hs(m(a.Ga,a,h),Hy(a,a.B)),a.B++,!0)}n.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let A=new $n(this,this.j,a),S=this.o;if(this.S&&(S?(S=y(S),I(S,this.S)):S=this.S),this.m!==null||this.O||(A.H=S,S=null),this.P)e:{for(var h=0,d=0;d<this.i.length;d++){t:{var g=this.i[d];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=d;break e}if(h===4096||d===this.i.length-1){h=d+1;break e}}h=1e3}else h=1e3;h=zy(this,A,h),d=Tn(this.I),be(d,"RID",a),be(d,"CVER",22),this.D&&be(d,"X-HTTP-Session-Id",this.D),io(this,d),S&&(this.O?h="headers="+encodeURIComponent(String(Vy(S)))+"&"+h:this.m&&vh(d,this.m,S)),_h(this.h,A),this.Ua&&be(d,"TYPE","init"),this.P?(be(d,"$req",h),be(d,"SID","null"),A.T=!0,ph(A,d,null)):ph(A,d,h),this.G=2}}else this.G==3&&(a?qy(this,a):this.i.length==0||Ty(this.h)||qy(this))};function qy(a,h){var d;h?d=h.l:d=a.U++;let g=Tn(a.I);be(g,"SID",a.K),be(g,"RID",d),be(g,"AID",a.T),io(a,g),a.m&&a.o&&vh(g,a.m,a.o),d=new $n(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),h&&(a.i=h.D.concat(a.i)),h=zy(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),_h(a.h,d),ph(d,g,h)}function io(a,h){a.H&&ne(a.H,function(d,g){be(h,g,d)}),a.l&&Sy({},function(d,g){be(h,g,d)})}function zy(a,h,d){d=Math.min(a.i.length,d);var g=a.l?m(a.l.Na,a.l,a):null;e:{var A=a.i;let S=-1;for(;;){let F=["count="+d];S==-1?0<d?(S=A[0].g,F.push("ofs="+S)):S=0:F.push("ofs="+S);let me=!0;for(let nt=0;nt<d;nt++){let he=A[nt].g,ot=A[nt].map;if(he-=S,0>he)S=Math.max(0,A[nt].g-100),me=!1;else try{gA(ot,F,"req"+he+"_")}catch{g&&g(ot)}}if(me){g=F.join("&");break e}}}return a=a.i.splice(0,d),h.D=a,g}function Gy(a){if(!a.g&&!a.u){a.Y=1;var h=a.Fa;Bs||ey(),$s||(Bs(),$s=!0),Zl.add(h,a),a.v=0}}function Eh(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Hs(m(a.Fa,a),Hy(a,a.v)),a.v++,!0)}n.Fa=function(){if(this.u=null,Wy(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Hs(m(this.ab,this),a)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,dt(10),rc(this),Wy(this))};function Ih(a){a.A!=null&&(c.clearTimeout(a.A),a.A=null)}function Wy(a){a.g=new $n(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var h=Tn(a.qa);be(h,"RID","rpc"),be(h,"SID",a.K),be(h,"AID",a.T),be(h,"CI",a.F?"0":"1"),!a.F&&a.ja&&be(h,"TO",a.ja),be(h,"TYPE","xmlhttp"),io(a,h),a.m&&a.o&&vh(h,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=ec(Tn(h)),d.m=null,d.P=!0,vy(d,a)}n.Za=function(){this.C!=null&&(this.C=null,rc(this),Eh(this),dt(19))};function sc(a){a.C!=null&&(c.clearTimeout(a.C),a.C=null)}function Ky(a,h){var d=null;if(a.g==h){sc(a),Ih(a),a.g=null;var g=2}else if(yh(a.h,h))d=h.D,by(a.h,h),g=1;else return;if(a.G!=0){if(h.o)if(g==1){d=h.m?h.m.length:0,h=Date.now()-h.F;var A=a.B;g=Ha(),ht(g,new gy(g,d)),ic(a)}else Gy(a);else if(A=h.s,A==3||A==0&&0<h.X||!(g==1&&vA(a,h)||g==2&&Eh(a)))switch(d&&0<d.length&&(h=a.h,h.i=h.i.concat(d)),A){case 1:Dr(a,5);break;case 4:Dr(a,10);break;case 3:Dr(a,6);break;default:Dr(a,2)}}}function Hy(a,h){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*h}function Dr(a,h){if(a.j.info("Error code "+h),h==2){var d=m(a.fb,a),g=a.Xa;let A=!g;g=new Pr(g||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Ya(g,"https"),ec(g),A?dA(g.toString(),d):fA(g.toString(),d)}else dt(2);a.G=0,a.l&&a.l.sa(h),Qy(a),$y(a)}n.fb=function(a){a?(this.j.info("Successfully pinged google.com"),dt(2)):(this.j.info("Failed to ping google.com"),dt(1))};function Qy(a){if(a.G=0,a.ka=[],a.l){let h=Cy(a.h);(h.length!=0||a.i.length!=0)&&(D(a.ka,h),D(a.ka,a.i),a.h.i.length=0,x(a.i),a.i.length=0),a.l.ra()}}function Xy(a,h,d){var g=d instanceof Pr?Tn(d):new Pr(d);if(g.g!="")h&&(g.g=h+"."+g.g),Za(g,g.s);else{var A=c.location;g=A.protocol,h=h?h+"."+A.hostname:A.hostname,A=+A.port;var S=new Pr(null);g&&Ya(S,g),h&&(S.g=h),A&&Za(S,A),d&&(S.l=d),g=S}return d=a.D,h=a.ya,d&&h&&be(g,d,h),be(g,"VER",a.la),io(a,g),g}function Jy(a,h,d){if(h&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=a.Ca&&!a.pa?new ke(new eo({eb:d})):new ke(a.pa),h.Ha(a.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Yy(){}n=Yy.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function oc(){}oc.prototype.g=function(a,h){return new wt(a,h)};function wt(a,h){st.call(this),this.g=new By(h),this.l=a,this.h=h&&h.messageUrlParams||null,a=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(a?a["X-WebChannel-Content-Type"]=h.messageContentType:a={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(a?a["X-WebChannel-Client-Profile"]=h.va:a={"X-WebChannel-Client-Profile":h.va}),this.g.S=a,(a=h&&h.Sb)&&!K(a)&&(this.g.m=a),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!K(h)&&(this.g.D=h,a=this.h,a!==null&&h in a&&(a=this.h,h in a&&delete a[h])),this.j=new vi(this)}k(wt,st),wt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},wt.prototype.close=function(){wh(this.g)},wt.prototype.o=function(a){var h=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=ch(a),a=d);h.i.push(new nA(h.Ya++,a)),h.G==3&&ic(h)},wt.prototype.N=function(){this.g.l=null,delete this.j,wh(this.g),delete this.g,wt.aa.N.call(this)};function Zy(a){lh.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var h=a.__sm__;if(h){e:{for(let d in h){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,h=h!==null&&a in h?h[a]:void 0),this.data=h}else this.data=a}k(Zy,lh);function e_(){hh.call(this),this.status=1}k(e_,hh);function vi(a){this.g=a}k(vi,Yy),vi.prototype.ua=function(){ht(this.g,"a")},vi.prototype.ta=function(a){ht(this.g,new Zy(a))},vi.prototype.sa=function(a){ht(this.g,new e_)},vi.prototype.ra=function(){ht(this.g,"b")},oc.prototype.createWebChannel=oc.prototype.g,wt.prototype.send=wt.prototype.o,wt.prototype.open=wt.prototype.m,wt.prototype.close=wt.prototype.close,lf=Dn.createWebChannelTransport=function(){return new oc},uf=Dn.getStatEventTarget=function(){return Ha()},cf=Dn.Event=Sr,uu=Dn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Qa.NO_ERROR=0,Qa.TIMEOUT=8,Qa.HTTP_ERROR=6,Yo=Dn.ErrorCode=Qa,my.COMPLETE="complete",af=Dn.EventType=my,hy.EventType=Ws,Ws.OPEN="a",Ws.CLOSE="b",Ws.ERROR="c",Ws.MESSAGE="d",st.prototype.listen=st.prototype.K,zi=Dn.WebChannel=hy,of=Dn.FetchXmlHttpFactory=eo,ke.prototype.listenOnce=ke.prototype.L,ke.prototype.getLastError=ke.prototype.Ka,ke.prototype.getLastErrorCode=ke.prototype.Ba,ke.prototype.getStatus=ke.prototype.Z,ke.prototype.getResponseJson=ke.prototype.Oa,ke.prototype.getResponseText=ke.prototype.oa,ke.prototype.send=ke.prototype.ea,ke.prototype.setWithCredentials=ke.prototype.Ha,sf=Dn.XhrIo=ke}).apply(typeof cu<"u"?cu:typeof self<"u"?self:typeof window<"u"?window:{});var Cw="@firebase/firestore";var qe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};qe.UNAUTHENTICATED=new qe(null),qe.GOOGLE_CREDENTIALS=new qe("google-credentials-uid"),qe.FIRST_PARTY=new qe("first-party-uid"),qe.MOCK_USER=new qe("mock-user");var Es="10.12.0";var hr=new Sc("@firebase/firestore");function Qi(){return hr.logLevel}function fg(n){hr.setLogLevel(n)}function N(n,...e){if(hr.logLevel<=rn.DEBUG){let t=e.map(pg);hr.debug(`Firestore (${Es}): ${n}`,...t)}}function Fe(n,...e){if(hr.logLevel<=rn.ERROR){let t=e.map(pg);hr.error(`Firestore (${Es}): ${n}`,...t)}}function Ot(n,...e){if(hr.logLevel<=rn.WARN){let t=e.map(pg);hr.warn(`Firestore (${Es}): ${n}`,...t)}}function pg(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function G(n="Unexpected state"){let e=`FIRESTORE (${Es}) INTERNAL ASSERTION FAILED: `+n;throw Fe(e),new Error(e)}function H(n,e){n||G()}function CE(n,e){n||G()}function j(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},M=class extends Cc{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ze=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var wu=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},gf=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(qe.UNAUTHENTICATED))}shutdown(){}},mf=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},yf=class{constructor(e){this.t=e,this.currentUser=qe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new ze;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ze,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>R(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},c=u=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?c(u):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ze)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(H(typeof r.accessToken=="string"),new wu(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return H(e===null||typeof e=="string"),new qe(e)}},_f=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=qe.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},vf=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new _f(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(qe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},wf=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ef=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,N("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(H(typeof t.token=="string"),this.R=t.token,new wf(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function MS(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Eu=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=MS(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function ie(n,e){return n<e?-1:n>e?1:0}function is(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function SE(n){return n+"\0"}var De=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new M(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new M(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new M(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new M(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ie(this.nanoseconds,e.nanoseconds):ie(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var X=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new De(0,0))}static max(){return new n(new De(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Iu=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&G(),r===void 0?r=e.length-t:r>e.length-t&&G(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ue=class n extends Iu{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new M(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},NS=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Le=class n extends Iu{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return NS.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new M(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new M(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new M(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else c==="`"?(o=!o,i++):c!=="."||o?(r+=c,i++):(s(),i++)}if(s(),o)throw new M(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(ue.fromString(e))}static fromName(e){return new n(ue.fromString(e).popFirst(5))}static empty(){return new n(ue.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ue.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ue.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ue(e.slice()))}};var ss=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function If(n){return n.fields.find(e=>e.kind===2)}function Br(n){return n.fields.filter(e=>e.kind!==2)}ss.UNKNOWN_ID=-1;var ts=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var la=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,Ft.min())}};function RE(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=X.fromTimestamp(r===1e9?new De(t+1,0):new De(t,r));return new Ft(i,U.empty(),e)}function PE(n){return new Ft(n.readTime,n.key,-1)}var Ft=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(X.min(),U.empty(),-1)}static max(){return new n(X.max(),U.empty(),-1)}};function gg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(n.documentKey,e.documentKey),t!==0?t:ie(n.largestBatchId,e.largestBatchId))}var DE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Tu=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Er(n){return R(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==DE)throw n;N("LocalStore","Unexpectedly lost primary lease")})}var C=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&G(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(c=>{++i,c.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),c=0;for(let u=0;u<s;u++){let l=u;t(e[l]).next(f=>{o[l]=f,++c,c===s&&r(o)},f=>i(f))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Au=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new ze,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Kr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=mg(r.target.error);this.V.reject(new Kr(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Kr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(N("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Af(t)}},dr=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(wo())===12.2&&Fe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return N("SimpleDb","Removing database:",e),$r(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!bc())return!1;if(n.C())return!0;let e=wo(),t=n.S(e),r=0<t&&t<10,i=kE(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.v)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return R(this,null,function*(){return this.db||(N("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Kr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new M(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new M(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Kr(e,o))},i.onupgradeneeded=s=>{N("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{N("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return R(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let c=Au.open(this.db,e,s?"readonly":"readwrite",r),u=i(c).next(l=>(c.g(),l)).catch(l=>(c.abort(l),C.reject(l))).toPromise();return u.catch(()=>{}),yield c.m,u}catch(c){let u=c,l=u.name!=="FirebaseError"&&o<3;if(N("SimpleDb","Transaction failed with error:",u.message,"Retrying:",l),this.close(),!l)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function kE(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Tf=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return $r(this.B.delete())}},Kr=class extends M{constructor(e,t){super(P.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Ir(n){return n.name==="IndexedDbTransactionError"}var Af=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(N("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),$r(r)}add(e){return N("SimpleDb","ADD",this.store.name,e,e),$r(this.store.add(e))}get(e){return $r(this.store.get(e)).next(t=>(t===void 0&&(t=null),N("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return N("SimpleDb","DELETE",this.store.name,e),$r(this.store.delete(e))}count(){return N("SimpleDb","COUNT",this.store.name),$r(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new C((o,c)=>{s.onerror=u=>{c(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(c,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new C((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){N("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,c)=>c.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new C((r,i)=>{t.onerror=s=>{let o=mg(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(c=>{c?o.continue():r()}):r()}})}W(e,t){let r=[];return new C((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let c=o.target.result;if(!c)return void i();let u=new Tf(c),l=t(c.primaryKey,c.value,u);if(l instanceof C){let f=l.catch(p=>(u.done(),C.reject(p)));r.push(f)}u.isDone?i():u.K===null?c.continue():c.continue(u.K)}}).next(()=>C.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function $r(n){return new C((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=mg(r.target.error);t(i)}})}var Sw=!1;function mg(n){let e=dr.S(wo());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new M("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Sw||(Sw=!0,setTimeout(()=>{throw r},0)),r}}return n}var bf=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){N("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>R(this,null,function*(){this.task=null;try{N("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Ir(t)?N("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Er(t)}yield this.X(6e4)}))}},Cf=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return R(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return C.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return N("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(c=>{i-=c,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(c=>(N("IndexBackfiller",`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=PE(s);gg(o,r)>0&&(r=o)}),new Ft(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Rt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function xa(n){return n==null}function ha(n){return n===0&&1/n==-1/0}function xE(n){return typeof n=="number"&&Number.isInteger(n)&&!ha(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function pt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Rw(e)),e=VS(n.get(t),e);return Rw(e)}function VS(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Rw(n){return n+""}function ln(n){let e=n.length;if(H(e>=2),e===2)return H(n.charAt(0)===""&&n.charAt(1)===""),ue.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&G(),n.charAt(o+1)){case"":let c=n.substring(s,o),u;i.length===0?u=c:(i+=c,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:G()}s=o+2}return new ue(r)}var Pw=["userId","batchId"];function pu(n,e){return[n,pt(e)]}function ME(n,e,t){return[n,pt(e),t]}var OS={},FS=["prefixPath","collectionGroup","readTime","documentId"],LS=["prefixPath","collectionGroup","documentId"],US=["collectionGroup","readTime","prefixPath","documentId"],jS=["canonicalId","targetId"],BS=["targetId","path"],$S=["path","targetId"],qS=["collectionId","parent"],zS=["indexId","uid"],GS=["uid","sequenceNumber"],WS=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],KS=["indexId","uid","orderedDocumentKey"],HS=["userId","collectionPath","documentId"],QS=["userId","collectionPath","largestBatchId"],XS=["userId","collectionGroup","largestBatchId"],NE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],JS=[...NE,"documentOverlays"],VE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],OE=VE,FE=[...OE,"indexConfiguration","indexState","indexEntries"],YS=FE;var da=class extends Tu{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function et(n,e){let t=j(n);return dr.F(t._e,e)}function Dw(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function si(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function LE(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Se=class n{constructor(e,t){this.comparator=e,this.root=t||dn.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,dn.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,dn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new es(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new es(this.root,e,this.comparator,!1)}getReverseIterator(){return new es(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new es(this.root,e,this.comparator,!0)}},es=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},dn=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw G();let e=this.left.check();if(e!==this.right.check())throw G();return e+(this.isRed()?0:1)}};dn.EMPTY=null,dn.RED=!0,dn.BLACK=!1;dn.EMPTY=new class{constructor(){this.size=0}get key(){throw G()}get value(){throw G()}get color(){throw G()}get left(){throw G()}get right(){throw G()}copy(e,t,r,i,s){return this}insert(e,t,r){return new dn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var we=class n{constructor(e){this.comparator=e,this.data=new Se(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new bu(this.data.getIterator())}getIteratorFrom(e){return new bu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},bu=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Gi(n){return n.hasNext()?n.getNext():void 0}var Pt=class n{constructor(e){this.fields=e,e.sort(Le.comparator)}static empty(){return new n([])}unionWith(e){let t=new we(Le.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return is(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Cu=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function UE(){return typeof atob<"u"}var Ze=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Cu("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ie(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ze.EMPTY_BYTE_STRING=new Ze("");var ZS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mn(n){if(H(!!n),typeof n=="string"){let e=0,t=ZS.exec(n);if(H(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ne(n.seconds),nanos:Ne(n.nanos)}}function Ne(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function fr(n){return typeof n=="string"?Ze.fromBase64String(n):Ze.fromUint8Array(n)}function ml(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function yg(n){let e=n.mapValue.fields.__previous_value__;return ml(e)?yg(e):e}function fa(n){let e=Mn(n.mapValue.fields.__local_write_time__.timestampValue);return new De(e.seconds,e.nanos)}var Sf=class{constructor(e,t,r,i,s,o,c,u,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=l}},pr=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var ur={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},gu={nullValue:"NULL_VALUE"};function Hr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ml(n)?4:jE(n)?9007199254740991:10:G()}function gn(n,e){if(n===e)return!0;let t=Hr(n);if(t!==Hr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return fa(n).isEqual(fa(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Mn(i.timestampValue),c=Mn(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return fr(i.bytesValue).isEqual(fr(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Ne(i.geoPointValue.latitude)===Ne(s.geoPointValue.latitude)&&Ne(i.geoPointValue.longitude)===Ne(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ne(i.integerValue)===Ne(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=Ne(i.doubleValue),c=Ne(s.doubleValue);return o===c?ha(o)===ha(c):isNaN(o)&&isNaN(c)}return!1}(n,e);case 9:return is(n.arrayValue.values||[],e.arrayValue.values||[],gn);case 10:return function(i,s){let o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(Dw(o)!==Dw(c))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!gn(o[u],c[u])))return!1;return!0}(n,e);default:return G()}}function pa(n,e){return(n.values||[]).find(t=>gn(t,e))!==void 0}function gr(n,e){if(n===e)return 0;let t=Hr(n),r=Hr(e);if(t!==r)return ie(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ie(n.booleanValue,e.booleanValue);case 2:return function(s,o){let c=Ne(s.integerValue||s.doubleValue),u=Ne(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(n,e);case 3:return kw(n.timestampValue,e.timestampValue);case 4:return kw(fa(n),fa(e));case 5:return ie(n.stringValue,e.stringValue);case 6:return function(s,o){let c=fr(s),u=fr(o);return c.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let c=s.split("/"),u=o.split("/");for(let l=0;l<c.length&&l<u.length;l++){let f=ie(c[l],u[l]);if(f!==0)return f}return ie(c.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let c=ie(Ne(s.latitude),Ne(o.latitude));return c!==0?c:ie(Ne(s.longitude),Ne(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){let c=s.values||[],u=o.values||[];for(let l=0;l<c.length&&l<u.length;++l){let f=gr(c[l],u[l]);if(f)return f}return ie(c.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===ur.mapValue&&o===ur.mapValue)return 0;if(s===ur.mapValue)return 1;if(o===ur.mapValue)return-1;let c=s.fields||{},u=Object.keys(c),l=o.fields||{},f=Object.keys(l);u.sort(),f.sort();for(let p=0;p<u.length&&p<f.length;++p){let m=ie(u[p],f[p]);if(m!==0)return m;let E=gr(c[u[p]],l[f[p]]);if(E!==0)return E}return ie(u.length,f.length)}(n.mapValue,e.mapValue);default:throw G()}}function kw(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ie(n,e);let t=Mn(n),r=Mn(e),i=ie(t.seconds,r.seconds);return i!==0?i:ie(t.nanos,r.nanos)}function os(n){return Rf(n)}function Rf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=Mn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return fr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return U.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Rf(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Rf(t.fields[o])}`;return i+"}"}(n.mapValue):G()}function Qr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Pf(n){return!!n&&"integerValue"in n}function ga(n){return!!n&&"arrayValue"in n}function xw(n){return!!n&&"nullValue"in n}function Mw(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function mu(n){return!!n&&"mapValue"in n}function sa(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return si(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=sa(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=sa(n.arrayValue.values[t]);return e}return Object.assign({},n)}function jE(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function eR(n){return"nullValue"in n?gu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Qr(pr.empty(),U.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:G()}function tR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Qr(pr.empty(),U.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?ur:G()}function Nw(n,e){let t=gr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Vw(n,e){let t=gr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var lt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!mu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sa(t)}setAll(e){let t=Le.emptyPath(),r={},i=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=c.popLast()}o?r[c.lastSegment()]=sa(o):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());mu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return gn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];mu(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){si(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(sa(this.value))}};function BE(n){let e=[];return si(n.fields,(t,r)=>{let i=new Le([t]);if(mu(r)){let s=BE(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Pt(e)}var Ge=class n{constructor(e,t,r,i,s,o,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new n(e,0,X.min(),X.min(),X.min(),lt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,X.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,X.min(),X.min(),lt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,X.min(),X.min(),lt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(X.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=lt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=lt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=X.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var mn=class{constructor(e,t){this.position=e,this.inclusive=t}};function Ow(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=U.comparator(U.fromName(o.referenceValue),t.key):r=gr(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Fw(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!gn(n.position[t],e.position[t]))return!1;return!0}var Xr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function nR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Su=class{},ae=class n extends Su{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new xf(e,t,r):t==="array-contains"?new Vf(e,r):t==="in"?new Ru(e,r):t==="not-in"?new Of(e,r):t==="array-contains-any"?new Ff(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Mf(e,r):new Nf(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(gr(t,this.value)):t!==null&&Hr(this.value)===Hr(t)&&this.matchesComparison(gr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return G()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},pe=class n extends Su{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return as(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function as(n){return n.op==="and"}function Df(n){return n.op==="or"}function _g(n){return $E(n)&&as(n)}function $E(n){for(let e of n.filters)if(e instanceof pe)return!1;return!0}function kf(n){if(n instanceof ae)return n.field.canonicalString()+n.op.toString()+os(n.value);if(_g(n))return n.filters.map(e=>kf(e)).join(",");{let e=n.filters.map(t=>kf(t)).join(",");return`${n.op}(${e})`}}function qE(n,e){return n instanceof ae?function(r,i){return i instanceof ae&&r.op===i.op&&r.field.isEqual(i.field)&&gn(r.value,i.value)}(n,e):n instanceof pe?function(r,i){return i instanceof pe&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,c)=>s&&qE(o,i.filters[c]),!0):!1}(n,e):void G()}function zE(n,e){let t=n.filters.concat(e);return pe.create(t,n.op)}function GE(n){return n instanceof ae?function(t){return`${t.field.canonicalString()} ${t.op} ${os(t.value)}`}(n):n instanceof pe?function(t){return t.op.toString()+" {"+t.getFilters().map(GE).join(" ,")+"}"}(n):"Filter"}var xf=class extends ae{constructor(e,t,r){super(e,t,r),this.key=U.fromName(r.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},Mf=class extends ae{constructor(e,t){super(e,"in",t),this.keys=WE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Nf=class extends ae{constructor(e,t){super(e,"not-in",t),this.keys=WE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function WE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>U.fromName(r.referenceValue))}var Vf=class extends ae{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ga(t)&&pa(t.arrayValue,this.value)}},Ru=class extends ae{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&pa(this.value.arrayValue,t)}},Of=class extends ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(pa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!pa(this.value.arrayValue,t)}},Ff=class extends ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!ga(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>pa(this.value.arrayValue,r))}};var Lf=class{constructor(e,t=null,r=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.ue=null}};function Uf(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Lf(n,e,t,r,i,s,o)}function Jr(n){let e=j(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>kf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),xa(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>os(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>os(r)).join(",")),e.ue=t}return e.ue}function Ma(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!nR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!qE(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Fw(n.startAt,e.startAt)&&Fw(n.endAt,e.endAt)}function Pu(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Du(n,e){return n.filters.filter(t=>t instanceof ae&&t.field.isEqual(e))}function Lw(n,e,t){let r=gu,i=!0;for(let s of Du(n,e)){let o=gu,c=!0;switch(s.op){case"<":case"<=":o=eR(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,c=!1;break;case"!=":case"not-in":o=gu}Nw({value:r,inclusive:i},{value:o,inclusive:c})<0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Nw({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function Uw(n,e,t){let r=ur,i=!0;for(let s of Du(n,e)){let o=ur,c=!0;switch(s.op){case">=":case">":o=tR(s.value),c=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,c=!1;break;case"!=":case"not-in":o=ur}Vw({value:r,inclusive:i},{value:o,inclusive:c})>0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Vw({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var Kt=class{constructor(e,t=null,r=[],i=[],s=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function KE(n,e,t,r,i,s,o,c){return new Kt(n,e,t,r,i,s,o,c)}function Is(n){return new Kt(n)}function jw(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function vg(n){return n.collectionGroup!==null}function ns(n){let e=j(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new we(Le.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(l=>{l.isInequality()&&(c=c.add(l.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Xr(s,r))}),t.has(Le.keyField().canonicalString())||e.ce.push(new Xr(Le.keyField(),r))}return e.ce}function gt(n){let e=j(n);return e.le||(e.le=rR(e,ns(n))),e.le}function rR(n,e){if(n.limitType==="F")return Uf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Xr(i.field,s)});let t=n.endAt?new mn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new mn(n.startAt.position,n.startAt.inclusive):null;return Uf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function jf(n,e){let t=n.filters.concat([e]);return new Kt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ku(n,e,t){return new Kt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Na(n,e){return Ma(gt(n),gt(e))&&n.limitType===e.limitType}function HE(n){return`${Jr(gt(n))}|lt:${n.limitType}`}function Xi(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>GE(i)).join(", ")}]`),xa(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>os(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>os(i)).join(",")),`Target(${r})`}(gt(n))}; limitType=${n.limitType})`}function Va(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):U.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of ns(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,c,u){let l=Ow(o,c,u);return o.inclusive?l<=0:l<0}(r.startAt,ns(r),i)||r.endAt&&!function(o,c,u){let l=Ow(o,c,u);return o.inclusive?l>=0:l>0}(r.endAt,ns(r),i))}(n,e)}function QE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function XE(n){return(e,t)=>{let r=!1;for(let i of ns(n)){let s=iR(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function iR(n,e,t){let r=n.field.isKeyField()?U.comparator(e.key,t.key):function(s,o,c){let u=o.data.field(s),l=c.data.field(s);return u!==null&&l!==null?gr(u,l):G()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return G()}}var yn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){si(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return LE(this.inner)}size(){return this.innerSize}};var sR=new Se(U.comparator);function _t(){return sR}var JE=new Se(U.comparator);function ra(...n){let e=JE;for(let t of n)e=e.insert(t.key,t);return e}function YE(n){let e=JE;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function hn(){return oa()}function ZE(){return oa()}function oa(){return new yn(n=>n.toString(),(n,e)=>n.isEqual(e))}var oR=new Se(U.comparator),aR=new we(U.comparator);function se(...n){let e=aR;for(let t of n)e=e.add(t);return e}var cR=new we(ie);function wg(){return cR}function eI(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ha(e)?"-0":e}}function tI(n){return{integerValue:""+n}}function nI(n,e){return xE(e)?tI(e):eI(n,e)}var cs=class{constructor(){this._=void 0}};function uR(n,e,t){return n instanceof mr?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ml(s)&&(s=yg(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Nn?iI(n,e):n instanceof Vn?sI(n,e):function(i,s){let o=rI(i,s),c=Bw(o)+Bw(i.Pe);return Pf(o)&&Pf(i.Pe)?tI(c):eI(i.serializer,c)}(n,e)}function lR(n,e,t){return n instanceof Nn?iI(n,e):n instanceof Vn?sI(n,e):t}function rI(n,e){return n instanceof yr?function(r){return Pf(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var mr=class extends cs{},Nn=class extends cs{constructor(e){super(),this.elements=e}};function iI(n,e){let t=oI(e);for(let r of n.elements)t.some(i=>gn(i,r))||t.push(r);return{arrayValue:{values:t}}}var Vn=class extends cs{constructor(e){super(),this.elements=e}};function sI(n,e){let t=oI(e);for(let r of n.elements)t=t.filter(i=>!gn(i,r));return{arrayValue:{values:t}}}var yr=class extends cs{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function Bw(n){return Ne(n.integerValue||n.doubleValue)}function oI(n){return ga(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Yr=class{constructor(e,t){this.field=e,this.transform=t}};function hR(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Nn&&i instanceof Nn||r instanceof Vn&&i instanceof Vn?is(r.elements,i.elements,gn):r instanceof yr&&i instanceof yr?gn(r.Pe,i.Pe):r instanceof mr&&i instanceof mr}(n.transform,e.transform)}var Bf=class{constructor(e,t){this.version=e,this.transformResults=t}},Ve=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function yu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var us=class{};function aI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new vr(n.key,Ve.none()):new _r(n.key,n.data,Ve.none());{let t=n.data,r=lt.empty(),i=new we(Le.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Ht(n.key,r,new Pt(i.toArray()),Ve.none())}}function dR(n,e,t){n instanceof _r?function(i,s,o){let c=i.value.clone(),u=qw(i.fieldTransforms,s,o.transformResults);c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):n instanceof Ht?function(i,s,o){if(!yu(i.precondition,s))return void s.convertToUnknownDocument(o.version);let c=qw(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(cI(i)),u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function aa(n,e,t,r){return n instanceof _r?function(s,o,c,u){if(!yu(s.precondition,o))return c;let l=s.value.clone(),f=zw(s.fieldTransforms,u,o);return l.setAll(f),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ht?function(s,o,c,u){if(!yu(s.precondition,o))return c;let l=zw(s.fieldTransforms,u,o),f=o.data;return f.setAll(cI(s)),f.setAll(l),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(n,e,t,r):function(s,o,c){return yu(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(n,e,t)}function fR(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=rI(r.transform,i||null);s!=null&&(t===null&&(t=lt.empty()),t.set(r.field,s))}return t||null}function $w(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&is(r,i,(s,o)=>hR(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var _r=class extends us{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Ht=class extends us{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function cI(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function qw(n,e,t){let r=new Map;H(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,c=e.data.field(s.field);r.set(s.field,lR(o,c,t[i]))}return r}function zw(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,uR(s,o,e))}return r}var vr=class extends us{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ma=class extends us{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ya=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&dR(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=aa(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=aa(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=ZE();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;let u=aI(o,c);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(X.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),se())}isEqual(e){return this.batchId===e.batchId&&is(this.mutations,e.mutations,(t,r)=>$w(t,r))&&is(this.baseMutations,e.baseMutations,(t,r)=>$w(t,r))}},$f=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){H(e.mutations.length===r.length);let i=function(){return oR}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var _a=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var qf=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Be,ce;function uI(n){switch(n){default:return G();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function lI(n){if(n===void 0)return Fe("GRPC error has no .code"),P.UNKNOWN;switch(n){case Be.OK:return P.OK;case Be.CANCELLED:return P.CANCELLED;case Be.UNKNOWN:return P.UNKNOWN;case Be.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Be.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Be.INTERNAL:return P.INTERNAL;case Be.UNAVAILABLE:return P.UNAVAILABLE;case Be.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Be.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Be.NOT_FOUND:return P.NOT_FOUND;case Be.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Be.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Be.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Be.ABORTED:return P.ABORTED;case Be.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Be.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Be.DATA_LOSS:return P.DATA_LOSS;default:return G()}}(ce=Be||(Be={}))[ce.OK=0]="OK",ce[ce.CANCELLED=1]="CANCELLED",ce[ce.UNKNOWN=2]="UNKNOWN",ce[ce.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ce[ce.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ce[ce.NOT_FOUND=5]="NOT_FOUND",ce[ce.ALREADY_EXISTS=6]="ALREADY_EXISTS",ce[ce.PERMISSION_DENIED=7]="PERMISSION_DENIED",ce[ce.UNAUTHENTICATED=16]="UNAUTHENTICATED",ce[ce.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ce[ce.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ce[ce.ABORTED=10]="ABORTED",ce[ce.OUT_OF_RANGE=11]="OUT_OF_RANGE",ce[ce.UNIMPLEMENTED=12]="UNIMPLEMENTED",ce[ce.INTERNAL=13]="INTERNAL",ce[ce.UNAVAILABLE=14]="UNAVAILABLE",ce[ce.DATA_LOSS=15]="DATA_LOSS";var Gw=null;function hI(){return new TextEncoder}var pR=new ir([4294967295,4294967295],0);function Ww(n){let e=hI().encode(n),t=new rf;return t.update(e),new Uint8Array(t.digest())}function Kw(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ir([t,r],0),new ir([i,s],0)]}var zf=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Wr(`Invalid padding: ${t}`);if(r<0)throw new Wr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Wr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Wr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=ir.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(ir.fromNumber(r)));return i.compare(pR)===1&&(i=new ir([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Ww(e),[r,i]=Kw(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(c=>o.insert(c)),o}insert(e){if(this.Ie===0)return;let t=Ww(e),[r,i]=Kw(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Wr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var va=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,wa.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(X.min(),i,new Se(ie),_t(),se())}},wa=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,se(),se(),se())}};var rs=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},xu=class{constructor(e,t){this.targetId=e,this.me=t}},Mu=class{constructor(e,t,r=Ze.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Nu=class{constructor(){this.fe=0,this.ge=Qw(),this.pe=Ze.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=se(),t=se(),r=se();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:G()}}),new wa(this.pe,this.ye,e,t,r)}ve(){this.we=!1,this.ge=Qw()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,H(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Gf=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=_t(),this.qe=Hw(),this.Qe=new Se(ie)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:G()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Pu(s))if(r===0){let o=new U(s.path);this.Ue(t,o,Ge.newNoDocument(o,X.min()))}else H(r===1);else{let o=this.Ye(t);if(o!==r){let c=this.Ze(e),u=c?this.Xe(c,e,o):1;if(u!==0){this.je(t);let l=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,l)}Gw?.et(function(f,p,m,E,k){var x,D,$,K,V,W;let te={localCacheCount:f,existenceFilterCount:p.count,databaseId:m.database,projectId:m.projectId},ne=p.unchangedNames;return ne&&(te.bloomFilter={applied:k===0,hashCount:(x=ne?.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(K=($=(D=ne?.bits)===null||D===void 0?void 0:D.bitmap)===null||$===void 0?void 0:$.length)!==null&&K!==void 0?K:0,padding:(W=(V=ne?.bits)===null||V===void 0?void 0:V.padding)!==null&&W!==void 0?W:0,mightContain:w=>{var y;return(y=E?.mightContain(w))!==null&&y!==void 0&&y}}),te}(o,e.me,this.Le.tt(),c,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,c;try{o=fr(r).toUint8Array()}catch(u){if(u instanceof Cu)return Ot("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new zf(o,i,s)}catch(u){return Ot(u instanceof Wr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.Ie===0?null:c}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let c=this.Je(o);if(c){if(s.current&&Pu(c.target)){let u=new U(c.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,Ge.newNoDocument(u,e))}s.be&&(t.set(o,s.Ce()),s.ve())}});let r=se();this.qe.forEach((s,o)=>{let c=!0;o.forEachWhile(u=>{let l=this.Je(u);return!l||l.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new va(e,t,this.Qe,this.ke,r);return this.ke=_t(),this.qe=Hw(),this.Qe=new Se(ie),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Nu,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new we(ie),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||N("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Nu),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Hw(){return new Se(U.comparator)}function Qw(){return new Se(U.comparator)}var gR={asc:"ASCENDING",desc:"DESCENDING"},mR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},yR={and:"AND",or:"OR"},Wf=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Kf(n,e){return n.useProto3Json||xa(e)?e:{value:e}}function ls(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function dI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function _R(n,e){return ls(n,e.toTimestamp())}function Ue(n){return H(!!n),X.fromTimestamp(function(t){let r=Mn(t);return new De(r.seconds,r.nanos)}(n))}function Eg(n,e){return Hf(n,e).canonicalString()}function Hf(n,e){let t=function(i){return new ue(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function fI(n){let e=ue.fromString(n);return H(TI(e)),e}function Ea(n,e){return Eg(n.databaseId,e.path)}function fn(n,e){let t=fI(e);if(t.get(1)!==n.databaseId.projectId)throw new M(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new M(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(mI(t))}function pI(n,e){return Eg(n.databaseId,e)}function gI(n){let e=fI(n);return e.length===4?ue.emptyPath():mI(e)}function Qf(n){return new ue(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function mI(n){return H(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Xw(n,e,t){return{name:Ea(n,e),fields:t.value.mapValue.fields}}function yI(n,e,t){let r=fn(n,e.name),i=Ue(e.updateTime),s=e.createTime?Ue(e.createTime):X.min(),o=new lt({mapValue:{fields:e.fields}}),c=Ge.newFoundDocument(r,i,s,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function vR(n,e){return"found"in e?function(r,i){H(!!i.found),i.found.name,i.found.updateTime;let s=fn(r,i.found.name),o=Ue(i.found.updateTime),c=i.found.createTime?Ue(i.found.createTime):X.min(),u=new lt({mapValue:{fields:i.found.fields}});return Ge.newFoundDocument(s,o,c,u)}(n,e):"missing"in e?function(r,i){H(!!i.missing),H(!!i.readTime);let s=fn(r,i.missing),o=Ue(i.readTime);return Ge.newNoDocument(s,o)}(n,e):G()}function wR(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:G()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,f){return l.useProto3Json?(H(f===void 0||typeof f=="string"),Ze.fromBase64String(f||"")):(H(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Ze.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(l){let f=l.code===void 0?P.UNKNOWN:lI(l.code);return new M(f,l.message||"")}(o);t=new Mu(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=fn(n,r.document.name),s=Ue(r.document.updateTime),o=r.document.createTime?Ue(r.document.createTime):X.min(),c=new lt({mapValue:{fields:r.document.fields}}),u=Ge.newFoundDocument(i,s,o,c),l=r.targetIds||[],f=r.removedTargetIds||[];t=new rs(l,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=fn(n,r.document),s=r.readTime?Ue(r.readTime):X.min(),o=Ge.newNoDocument(i,s),c=r.removedTargetIds||[];t=new rs([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=fn(n,r.document),s=r.removedTargetIds||[];t=new rs([],s,i,null)}else{if(!("filter"in e))return G();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new qf(i,s),c=r.targetId;t=new xu(c,o)}}return t}function Ia(n,e){let t;if(e instanceof _r)t={update:Xw(n,e.key,e.value)};else if(e instanceof vr)t={delete:Ea(n,e.key)};else if(e instanceof Ht)t={update:Xw(n,e.key,e.data),updateMask:CR(e.fieldMask)};else{if(!(e instanceof ma))return G();t={verify:Ea(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let c=o.transform;if(c instanceof mr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Nn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Vn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof yr)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw G()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:_R(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:G()}(n,e.precondition)),t}function Xf(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Ve.updateTime(Ue(s.updateTime)):s.exists!==void 0?Ve.exists(s.exists):Ve.none()}(e.currentDocument):Ve.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,c){let u=null;if("setToServerValue"in c)H(c.setToServerValue==="REQUEST_TIME"),u=new mr;else if("appendMissingElements"in c){let f=c.appendMissingElements.values||[];u=new Nn(f)}else if("removeAllFromArray"in c){let f=c.removeAllFromArray.values||[];u=new Vn(f)}else"increment"in c?u=new yr(o,c.increment):G();let l=Le.fromServerFormat(c.fieldPath);return new Yr(l,u)}(n,i)):[];if(e.update){e.update.name;let i=fn(n,e.update.name),s=new lt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let l=u.fieldPaths||[];return new Pt(l.map(f=>Le.fromServerFormat(f)))}(e.updateMask);return new Ht(i,s,o,t,r)}return new _r(i,s,t,r)}if(e.delete){let i=fn(n,e.delete);return new vr(i,t)}if(e.verify){let i=fn(n,e.verify);return new ma(i,t)}return G()}function ER(n,e){return n&&n.length>0?(H(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?Ue(i.updateTime):Ue(s);return o.isEqual(X.min())&&(o=Ue(s)),new Bf(o,i.transformResults||[])}(t,e))):[]}function _I(n,e){return{documents:[pI(n,e.path)]}}function vI(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=pI(n,i);let s=function(l){if(l.length!==0)return II(pe.create(l,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(l){if(l.length!==0)return l.map(f=>function(m){return{field:Ji(m.field),direction:TR(m.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let c=Kf(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{_t:t,parent:i}}function wI(n){let e=gI(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){H(r===1);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(p){let m=EI(p);return m instanceof pe&&_g(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(m=>function(k){return new Xr(Yi(k.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(m))}(t.orderBy));let c=null;t.limit&&(c=function(p){let m;return m=typeof p=="object"?p.value:p,xa(m)?null:m}(t.limit));let u=null;t.startAt&&(u=function(p){let m=!!p.before,E=p.values||[];return new mn(E,m)}(t.startAt));let l=null;return t.endAt&&(l=function(p){let m=!p.before,E=p.values||[];return new mn(E,m)}(t.endAt)),KE(e,i,o,s,c,"F",u,l)}function IR(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return G()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function EI(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Yi(t.unaryFilter.field);return ae.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Yi(t.unaryFilter.field);return ae.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Yi(t.unaryFilter.field);return ae.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Yi(t.unaryFilter.field);return ae.create(o,"!=",{nullValue:"NULL_VALUE"});default:return G()}}(n):n.fieldFilter!==void 0?function(t){return ae.create(Yi(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return G()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return pe.create(t.compositeFilter.filters.map(r=>EI(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return G()}}(t.compositeFilter.op))}(n):G()}function TR(n){return gR[n]}function AR(n){return mR[n]}function bR(n){return yR[n]}function Ji(n){return{fieldPath:n.canonicalString()}}function Yi(n){return Le.fromServerFormat(n.fieldPath)}function II(n){return n instanceof ae?function(t){if(t.op==="=="){if(Mw(t.value))return{unaryFilter:{field:Ji(t.field),op:"IS_NAN"}};if(xw(t.value))return{unaryFilter:{field:Ji(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Mw(t.value))return{unaryFilter:{field:Ji(t.field),op:"IS_NOT_NAN"}};if(xw(t.value))return{unaryFilter:{field:Ji(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ji(t.field),op:AR(t.op),value:t.value}}}(n):n instanceof pe?function(t){let r=t.getFilters().map(i=>II(i));return r.length===1?r[0]:{compositeFilter:{op:bR(t.op),filters:r}}}(n):G()}function CR(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function TI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var hs=class n{constructor(e,t,r,i,s=X.min(),o=X.min(),c=Ze.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Vu=class{constructor(e){this.ct=e}};function SR(n,e){let t;if(e.document)t=yI(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=U.fromSegments(e.noDocument.path),i=ei(e.noDocument.readTime);t=Ge.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return G();{let r=U.fromSegments(e.unknownDocument.path),i=ei(e.unknownDocument.version);t=Ge.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new De(i[0],i[1]);return X.fromTimestamp(s)}(e.readTime)),t}function Jw(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ou(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Ea(s,o.key),fields:o.data.value.mapValue.fields,updateTime:ls(s,o.version.toTimestamp()),createTime:ls(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Zr(e.version)};else{if(!e.isUnknownDocument())return G();r.unknownDocument={path:t.path.toArray(),version:Zr(e.version)}}return r}function Ou(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Zr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ei(n){let e=new De(n.seconds,n.nanoseconds);return X.fromTimestamp(e)}function qr(n,e){let t=(e.baseMutations||[]).map(s=>Xf(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let c=e.mutations[s+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Xf(n.ct,s)),i=De.fromMillis(e.localWriteTimeMs);return new ya(e.batchId,i,t,r)}function ia(n){let e=ei(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ei(n.lastLimboFreeSnapshotVersion):X.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return H(s.documents.length===1),gt(Is(gI(s.documents[0])))}(n.query):function(s){return gt(wI(s))}(n.query),new hs(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ze.fromBase64String(n.resumeToken))}function AI(n,e){let t=Zr(e.snapshotVersion),r=Zr(e.lastLimboFreeSnapshotVersion),i;i=Pu(e.target)?_I(n.ct,e.target):vI(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Jr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Ig(n){let e=wI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ku(e,e.limit,"L"):e}function hf(n,e){return new _a(e.largestBatchId,Xf(n.ct,e.overlayMutation))}function Yw(n,e){let t=e.path.lastSegment();return[n,pt(e.path.popLast()),t]}function Zw(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Zr(r.readTime),documentKey:pt(r.documentKey.path),largestBatchId:r.largestBatchId}}var Jf=class{getBundleMetadata(e,t){return eE(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:ei(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return eE(e).put(function(i){return{bundleId:i.id,createTime:Zr(Ue(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return tE(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:Ig(s.bundledQuery),readTime:ei(s.readTime)}}(r)})}saveNamedQuery(e,t){return tE(e).put(function(i){return{name:i.name,readTime:Zr(Ue(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function eE(n){return et(n,"bundles")}function tE(n){return et(n,"namedQueries")}var Fu=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Zo(e).get(Yw(this.userId,t)).next(r=>r?hf(this.serializer,r):null)}getOverlays(e,t){let r=hn();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let c=new _a(t,o);i.push(this.ht(e,c))}),C.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(pt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let c=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Zo(e).j("collectionPathOverlayIndex",c))}),C.waitFor(s)}getOverlaysForCollection(e,t,r){let i=hn(),s=pt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Zo(e).U("collectionPathOverlayIndex",o).next(c=>{for(let u of c){let l=hf(this.serializer,u);i.set(l.getKey(),l)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=hn(),o,c=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Zo(e).J({index:"collectionGroupOverlayIndex",range:c},(u,l,f)=>{let p=hf(this.serializer,l);s.size()<i||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return Zo(e).put(function(i,s,o){let[c,u,l]=Yw(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:l,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Ia(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Zo(n){return et(n,"documentOverlays")}var kn=class{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(Ne(e.integerValue));else if("doubleValue"in e){let r=Ne(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),ha(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Et(t,20),typeof r=="string"&&(r=Mn(r)),t.At(`${r.seconds||""}`),t.dt(r.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(fr(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?jE(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):G()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let r=e.fields||{};this.Et(t,55);for(let i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){let r=e.values||[];this.Et(t,50);for(let i of r)this.It(i,t)}gt(e,t){this.Et(t,37),U.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}};kn.bt=new kn;function RR(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function nE(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=RR(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var Yf=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ct(r.value),r=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Mt(r.value),r=t.next();this.xt()}Ot(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{let i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{let i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){let t=this.Bt(e),r=nE(t);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){let t=this.Bt(e),r=nE(t);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ct(e){let t=255&e;t===0?(this.Kt(0),this.Kt(255)):t===255?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Zf=class{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}},ep=class{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}},zr=class{constructor(){this.Gt=new Yf,this.zt=new Zf(this.Gt),this.jt=new ep(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return e===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var Gr=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Jt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function sr(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=rE(n.arrayValue,e.arrayValue),t!==0?t:(t=rE(n.directionalValue,e.directionalValue),t!==0?t:U.comparator(n.documentKey,e.documentKey)))}function rE(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Lu=class{constructor(e){this.Yt=new we((t,r)=>Le.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(let t of e.filters){let r=t;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(e){if(H(e.collectionGroup===this.collectionId),this.en)return!1;let t=If(e);if(t!==void 0&&!this.nn(t))return!1;let r=Br(e),i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){let c=this.Yt.getIterator().getNext();if(!i.has(c.field.canonicalString())){let u=r[s];if(!this.rn(c,u)||!this.sn(this.Zt[o++],u))return!1}++s}for(;s<r.length;++s){let c=r[s];if(o>=this.Zt.length||!this.sn(this.Zt[o++],c))return!1}return!0}on(){if(this.en)return null;let e=new we(Le.comparator),t=[];for(let r of this.Xt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new ts(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new ts(r.field,0))}for(let r of this.Zt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new ts(r.field,r.dir==="asc"?0:1)));return new ss(ss.UNKNOWN_ID,this.collectionId,t,la.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function bI(n){var e,t;if(H(n instanceof ae||n instanceof pe),n instanceof ae){if(n instanceof Ru){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ae.create(n.field,"==",s)))||[];return pe.create(i,"or")}return n}let r=n.filters.map(i=>bI(i));return pe.create(r,n.op)}function PR(n){if(n.getFilters().length===0)return[];let e=rp(bI(n));return H(CI(e)),tp(e)||np(e)?[e]:e.getFilters()}function tp(n){return n instanceof ae}function np(n){return n instanceof pe&&_g(n)}function CI(n){return tp(n)||np(n)||function(t){if(t instanceof pe&&Df(t)){for(let r of t.getFilters())if(!tp(r)&&!np(r))return!1;return!0}return!1}(n)}function rp(n){if(H(n instanceof ae||n instanceof pe),n instanceof ae)return n;if(n.filters.length===1)return rp(n.filters[0]);let e=n.filters.map(r=>rp(r)),t=pe.create(e,n.op);return t=Uu(t),CI(t)?t:(H(t instanceof pe),H(as(t)),H(t.filters.length>1),t.filters.reduce((r,i)=>Tg(r,i)))}function Tg(n,e){let t;return H(n instanceof ae||n instanceof pe),H(e instanceof ae||e instanceof pe),t=n instanceof ae?e instanceof ae?function(i,s){return pe.create([i,s],"and")}(n,e):iE(n,e):e instanceof ae?iE(e,n):function(i,s){if(H(i.filters.length>0&&s.filters.length>0),as(i)&&as(s))return zE(i,s.getFilters());let o=Df(i)?i:s,c=Df(i)?s:i,u=o.filters.map(l=>Tg(l,c));return pe.create(u,"or")}(n,e),Uu(t)}function iE(n,e){if(as(e))return zE(e,n.getFilters());{let t=e.filters.map(r=>Tg(n,r));return pe.create(t,"or")}}function Uu(n){if(H(n instanceof ae||n instanceof pe),n instanceof ae)return n;let e=n.getFilters();if(e.length===1)return Uu(e[0]);if($E(n))return n;let t=e.map(i=>Uu(i)),r=[];return t.forEach(i=>{i instanceof ae?r.push(i):i instanceof pe&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:pe.create(r,n.op)}var ip=class{constructor(){this._n=new Ta}addToCollectionParentIndex(e,t){return this._n.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(Ft.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(Ft.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},Ta=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new we(ue.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new we(ue.comparator)).toArray()}};var lu=new Uint8Array(0),sp=class{constructor(e,t){this.databaseId=t,this.an=new Ta,this.un=new yn(r=>Jr(r),(r,i)=>Ma(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let s={collectionId:r,parent:pt(i)};return sE(e).put(s)}return C.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[SE(t),""],!1,!0);return sE(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(ln(o.parent))}return r})}addFieldIndex(e,t){let r=ea(e),i=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Ki(e);return s.next(c=>{o.put(Zw(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=ea(e),i=Ki(e),s=Wi(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=ea(e),r=Wi(e),i=Ki(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return C.forEach(this.cn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Lu(r).on();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=Wi(e),i=!0,s=new Map;return C.forEach(this.cn(t),o=>this.ln(e,o).next(c=>{i&&(i=!!c),s.set(o,c)})).next(()=>{if(i){let o=se(),c=[];return C.forEach(s,(u,l)=>{N("IndexedDbIndexManager",`Using index ${function(V){return`id=${V.indexId}|cg=${V.collectionGroup}|f=${V.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(u)} to execute ${Jr(t)}`);let f=function(V,W){let te=If(W);if(te===void 0)return null;for(let ne of Du(V,te.fieldPath))switch(ne.op){case"array-contains-any":return ne.value.arrayValue.values||[];case"array-contains":return[ne.value]}return null}(l,u),p=function(V,W){let te=new Map;for(let ne of Br(W))for(let w of Du(V,ne.fieldPath))switch(w.op){case"==":case"in":te.set(ne.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return te.set(ne.fieldPath.canonicalString(),w.value),Array.from(te.values())}return null}(l,u),m=function(V,W){let te=[],ne=!0;for(let w of Br(W)){let y=w.kind===0?Lw(V,w.fieldPath,V.startAt):Uw(V,w.fieldPath,V.startAt);te.push(y.value),ne&&(ne=y.inclusive)}return new mn(te,ne)}(l,u),E=function(V,W){let te=[],ne=!0;for(let w of Br(W)){let y=w.kind===0?Uw(V,w.fieldPath,V.endAt):Lw(V,w.fieldPath,V.endAt);te.push(y.value),ne&&(ne=y.inclusive)}return new mn(te,ne)}(l,u),k=this.hn(u,l,m),x=this.hn(u,l,E),D=this.Pn(u,l,p),$=this.In(u.indexId,f,k,m.inclusive,x,E.inclusive,D);return C.forEach($,K=>r.G(K,t.limit).next(V=>{V.forEach(W=>{let te=U.fromSegments(W.documentKey);o.has(te)||(o=o.add(te),c.push(te))})}))}).next(()=>c)}return C.resolve(null)})}cn(e){let t=this.un.get(e);return t||(e.filters.length===0?t=[e]:t=PR(pe.create(e.filters,"and")).map(r=>Uf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,r,i,s,o,c){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),l=u/(t!=null?t.length:1),f=[];for(let p=0;p<u;++p){let m=t?this.Tn(t[p/l]):lu,E=this.En(e,m,r[p%l],i),k=this.dn(e,m,s[p%l],o),x=c.map(D=>this.En(e,m,D,!0));f.push(...this.createRange(E,k,x))}return f}En(e,t,r,i){let s=new Gr(e,U.empty(),t,r);return i?s:s.Jt()}dn(e,t,r,i){let s=new Gr(e,U.empty(),t,r);return i?s.Jt():s}ln(e,t){let r=new Lu(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let c of s)r.tn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o})}getIndexType(e,t){let r=2,i=this.cn(t);return C.forEach(i,s=>this.ln(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let l=new we(Le.comparator),f=!1;for(let p of u.filters)for(let m of p.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?f=!0:l=l.add(m.field));for(let p of u.orderBy)p.field.isKeyField()||(l=l.add(p.field));return l.size+(f?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}An(e,t){let r=new zr;for(let i of Br(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Ht(i.kind);kn.bt.Pt(s,o)}return r.Wt()}Tn(e){let t=new zr;return kn.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let r=new zr;return kn.bt.Pt(Qr(this.databaseId,t),r.Ht(function(s){let o=Br(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Wt()}Pn(e,t,r){if(r===null)return[];let i=[];i.push(new zr);let s=0;for(let o of Br(e)){let c=r[s++];for(let u of i)if(this.Vn(t,o.fieldPath)&&ga(c))i=this.mn(i,o,c);else{let l=u.Ht(o.kind);kn.bt.Pt(c,l)}}return this.fn(i)}hn(e,t,r){return this.Pn(e,t,r.position)}fn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Wt();return t}mn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let c of i){let u=new zr;u.seed(c.Wt()),kn.bt.Pt(o,u.Ht(t.kind)),s.push(u)}return s}Vn(e,t){return!!e.filters.find(r=>r instanceof ae&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=ea(e),i=Ki(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return C.forEach(s,c=>i.get([c.indexId,this.uid]).next(u=>{o.push(function(f,p){let m=p?new la(p.sequenceNumber,new Ft(ei(p.readTime),new U(ln(p.documentKey)),p.largestBatchId)):la.empty(),E=f.fields.map(([k,x])=>new ts(Le.fromServerFormat(k),x));return new ss(f.indexId,f.collectionGroup,E,m)}(c,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ie(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=ea(e),s=Ki(e);return this.gn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(c=>C.forEach(c,u=>s.put(Zw(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return C.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?C.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(c=>(r.set(i.collectionGroup,c),C.forEach(c,u=>this.pn(e,i,u).next(l=>{let f=this.yn(s,u);return l.isEqual(f)?C.resolve():this.wn(e,s,u,l,f)}))))})}Sn(e,t,r,i){return Wi(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,t.key),documentKey:t.key.path.toArray()})}bn(e,t,r,i){return Wi(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,t.key),t.key.path.toArray()])}pn(e,t,r){let i=Wi(e),s=new we(sr);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,t)])},(o,c)=>{s=s.add(new Gr(r.indexId,t,c.arrayValue,c.directionalValue))}).next(()=>s)}yn(e,t){let r=new we(sr),i=this.An(t,e);if(i==null)return r;let s=If(t);if(s!=null){let o=e.data.field(s.fieldPath);if(ga(o))for(let c of o.arrayValue.values||[])r=r.add(new Gr(t.indexId,e.key,this.Tn(c),i))}else r=r.add(new Gr(t.indexId,e.key,lu,i));return r}wn(e,t,r,i,s){N("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,l,f,p,m){let E=u.getIterator(),k=l.getIterator(),x=Gi(E),D=Gi(k);for(;x||D;){let $=!1,K=!1;if(x&&D){let V=f(x,D);V<0?K=!0:V>0&&($=!0)}else x!=null?K=!0:$=!0;$?(p(D),D=Gi(k)):K?(m(x),x=Gi(E)):(x=Gi(E),D=Gi(k))}}(i,s,sr,c=>{o.push(this.Sn(e,t,r,c))},c=>{o.push(this.bn(e,t,r,c))}),C.waitFor(o)}gn(e){let t=1;return Ki(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,c)=>sr(o,c)).filter((o,c,u)=>!c||sr(o,u[c-1])!==0);let i=[];i.push(e);for(let o of r){let c=sr(o,e),u=sr(o,t);if(c===0)i[0]=e.Jt();else if(c>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];let c=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,lu,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,lu,[]];s.push(IDBKeyRange.bound(c,u))}return s}Dn(e,t){return sr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(oE)}getMinOffset(e,t){return C.mapArray(this.cn(t),r=>this.ln(e,r).next(i=>i||G())).next(oE)}};function sE(n){return et(n,"collectionParents")}function Wi(n){return et(n,"indexEntries")}function ea(n){return et(n,"indexConfiguration")}function Ki(n){return et(n,"indexState")}function oE(n){H(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;gg(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Ft(e.readTime,e.documentKey,t)}var aE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Vt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function SI(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),c=0,u=r.J({range:o},(f,p,m)=>(c++,m.delete()));s.push(u.next(()=>{H(c===1)}));let l=[];for(let f of t.mutations){let p=ME(e,f.key.path,t.batchId);s.push(i.delete(p)),l.push(f.key)}return C.waitFor(s).next(()=>l)}function ju(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw G();e=n.noDocument}return JSON.stringify(e).length}Vt.DEFAULT_COLLECTION_PERCENTILE=10,Vt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Vt.DEFAULT=new Vt(41943040,Vt.DEFAULT_COLLECTION_PERCENTILE,Vt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Vt.DISABLED=new Vt(-1,0,0);var Bu=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(e,t,r,i){H(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return or(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Zi(e),o=or(e);return o.add({}).next(c=>{H(typeof c=="number");let u=new ya(c,t,r,i),l=function(E,k,x){let D=x.baseMutations.map(K=>Ia(E.ct,K)),$=x.mutations.map(K=>Ia(E.ct,K));return{userId:k,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:D,mutations:$}}(this.serializer,this.userId,u),f=[],p=new we((m,E)=>ie(m.canonicalString(),E.canonicalString()));for(let m of i){let E=ME(this.userId,m.key.path,c);p=p.add(m.key.path.popLast()),f.push(o.put(l)),f.push(s.put(E,OS))}return p.forEach(m=>{f.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Cn[c]=u.keys()}),C.waitFor(f).next(()=>u)})}lookupMutationBatch(e,t){return or(e).get(t).next(r=>r?(H(r.userId===this.userId),qr(this.serializer,r)):null)}vn(e,t){return this.Cn[t]?C.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return or(e).J({index:"userMutationsIndex",range:i},(o,c,u)=>{c.userId===this.userId&&(H(c.batchId>=r),s=qr(this.serializer,c)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return or(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return or(e).U("userMutationsIndex",t).next(r=>r.map(i=>qr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=pu(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Zi(e).J({range:i},(o,c,u)=>{let[l,f,p]=o,m=ln(f);if(l===this.userId&&t.path.isEqual(m))return or(e).get(p).next(E=>{if(!E)throw G();H(E.userId===this.userId),s.push(qr(this.serializer,E))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new we(ie),i=[];return t.forEach(s=>{let o=pu(this.userId,s.path),c=IDBKeyRange.lowerBound(o),u=Zi(e).J({range:c},(l,f,p)=>{let[m,E,k]=l,x=ln(E);m===this.userId&&s.path.isEqual(x)?r=r.add(k):p.done()});i.push(u)}),C.waitFor(i).next(()=>this.Fn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=pu(this.userId,r),o=IDBKeyRange.lowerBound(s),c=new we(ie);return Zi(e).J({range:o},(u,l,f)=>{let[p,m,E]=u,k=ln(m);p===this.userId&&r.isPrefixOf(k)?k.length===i&&(c=c.add(E)):f.done()}).next(()=>this.Fn(e,c))}Fn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(or(e).get(s).next(o=>{if(o===null)throw G();H(o.userId===this.userId),r.push(qr(this.serializer,o))}))}),C.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return SI(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),C.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return C.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Zi(e).J({range:r},(s,o,c)=>{if(s[0]===this.userId){let u=ln(s[1]);i.push(u)}else c.done()}).next(()=>{H(i.length===0)})})}containsKey(e,t){return RI(e,this.userId,t)}xn(e){return PI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function RI(n,e,t){let r=pu(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Zi(n).J({range:s,H:!0},(c,u,l)=>{let[f,p,m]=c;f===e&&p===i&&(o=!0),l.done()}).next(()=>o)}function or(n){return et(n,"mutations")}function Zi(n){return et(n,"documentMutations")}function PI(n){return et(n,"mutationQueues")}var ds=class n{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Ln(){return new n(-1)}};var op=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{let r=new ds(t.highestTargetId);return t.highestTargetId=r.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>X.fromTimestamp(new De(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.Qn(t,r),this.kn(e,r))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Hi(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(H(r.targetCount>0),r.targetCount-=1,this.kn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Hi(e).J((o,c)=>{let u=ia(c);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>C.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Hi(e).J((r,i)=>{let s=ia(i);t(s)})}Bn(e){return cE(e).get("targetGlobalKey").next(t=>(H(t!==null),t))}kn(e,t){return cE(e).put("targetGlobalKey",t)}qn(e,t){return Hi(e).put(AI(this.serializer,t))}Qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Jr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Hi(e).J({range:i,index:"queryTargetsIndex"},(o,c,u)=>{let l=ia(c);Ma(t,l.target)&&(s=l,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=ar(e);return t.forEach(o=>{let c=pt(o.path);i.push(s.put({targetId:r,path:c})),i.push(this.referenceDelegate.addReference(e,r,o))}),C.waitFor(i)}removeMatchingKeys(e,t,r){let i=ar(e);return C.forEach(t,s=>{let o=pt(s.path);return C.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=ar(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=ar(e),s=se();return i.J({range:r,H:!0},(o,c,u)=>{let l=ln(o[1]),f=new U(l);s=s.add(f)}).next(()=>s)}containsKey(e,t){let r=pt(t.path),i=IDBKeyRange.bound([r],[SE(r)],!1,!0),s=0;return ar(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,c],u,l)=>{o!==0&&(s++,l.done())}).next(()=>s>0)}ot(e,t){return Hi(e).get(t).next(r=>r?ia(r):null)}};function Hi(n){return et(n,"targets")}function cE(n){return et(n,"targetGlobal")}function ar(n){return et(n,"targetDocuments")}function uE([n,e],[t,r]){let i=ie(n,t);return i===0?ie(e,r):i}var ap=class{constructor(e){this.Kn=e,this.buffer=new we(uE),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();uE(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},cp=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(e){N("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>R(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ir(t)?N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Er(t)}yield this.zn(3e5)}))}},up=class{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return C.resolve(Rt.oe);let r=new ap(t);return this.jn.forEachTarget(e,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(N("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(aE)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),aE):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let r,i,s,o,c,u,l,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(r=p,c=Date.now(),this.removeTargets(e,r,t))).next(p=>(s=p,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(p=>(l=Date.now(),Qi()<=rn.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(c-o)+`ms
	Removed ${s} targets in `+(u-c)+`ms
	Removed ${p} documents in `+(l-u)+`ms
Total Duration: ${l-f}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}};function DR(n,e){return new up(n,e)}var lp=class{constructor(e,t){this.db=e,this.garbageCollector=DR(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Zn(e){let t=0;return this.Jn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(r,i)=>t(i))}addReference(e,t,r){return hu(e,r)}removeReference(e,t,r){return hu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return hu(e,t)}er(e,t){return function(i,s){let o=!1;return PI(i).Y(c=>RI(i,c,s).next(u=>(u&&(o=!0),C.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(e,(o,c)=>{if(c<=t){let u=this.er(e,o).next(l=>{if(!l)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,X.min()),ar(e).delete(function(p){return[0,pt(p.path)]}(o))))});i.push(u)}}).next(()=>C.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return hu(e,t)}Xn(e,t){let r=ar(e),i,s=Rt.oe;return r.J({index:"documentTargetsIndex"},([o,c],{path:u,sequenceNumber:l})=>{o===0?(s!==Rt.oe&&t(new U(ln(i)),s),s=l,i=u):s=Rt.oe}).next(()=>{s!==Rt.oe&&t(new U(ln(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function hu(n,e){return ar(n).put(function(r,i){return{targetId:0,path:pt(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var $u=class{constructor(){this.changes=new yn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ge.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var hp=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return jr(e).put(r)}removeEntry(e,t,r){return jr(e).delete(function(s,o){let c=s.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Ou(o),c[c.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.tr(e,r)))}getEntry(e,t){let r=Ge.newInvalidDocument(t);return jr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ta(t))},(i,s)=>{r=this.nr(t,s)}).next(()=>r)}rr(e,t){let r={size:0,document:Ge.newInvalidDocument(t)};return jr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ta(t))},(i,s)=>{r={document:this.nr(t,s),size:ju(s)}}).next(()=>r)}getEntries(e,t){let r=_t();return this.ir(e,t,(i,s)=>{let o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(e,t){let r=_t(),i=new Se(U.comparator);return this.ir(e,t,(s,o)=>{let c=this.nr(s,o);r=r.insert(s,c),i=i.insert(s,ju(o))}).next(()=>({documents:r,_r:i}))}ir(e,t,r){if(t.isEmpty())return C.resolve();let i=new we(dE);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(ta(i.first()),ta(i.last())),o=i.getIterator(),c=o.getNext();return jr(e).J({index:"documentKeyIndex",range:s},(u,l,f)=>{let p=U.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;c&&dE(c,p)<0;)r(c,null),c=o.getNext();c&&c.isEqual(p)&&(r(c,l),c=o.hasNext()?o.getNext():null),c?f.$(ta(c)):f.done()}).next(()=>{for(;c;)r(c,null),c=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,c=[o.popLast().toArray(),o.lastSegment(),Ou(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return jr(e).U(IDBKeyRange.bound(c,u,!0)).next(l=>{s?.incrementDocumentReadCount(l.length);let f=_t();for(let p of l){let m=this.nr(U.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);m.isFoundDocument()&&(Va(t,m)||i.has(m.key))&&(f=f.insert(m.key,m))}return f})}getAllFromCollectionGroup(e,t,r,i){let s=_t(),o=hE(t,r),c=hE(t,Ft.max());return jr(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,c,!0)},(u,l,f)=>{let p=this.nr(U.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);s=s.insert(p.key,p),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new dp(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return lE(e).get("remoteDocumentGlobalKey").next(t=>(H(!!t),t))}tr(e,t){return lE(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let r=SR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(X.min())))return r}return Ge.newInvalidDocument(e)}};function DI(n){return new hp(n)}var dp=class extends $u{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new yn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new we((s,o)=>ie(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let c=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,c.readTime)),o.isValidDocument()){let u=Jw(this.ar.serializer,o);i=i.add(s.path.popLast());let l=ju(u);r+=l-c.size,t.push(this.ar.addEntry(e,s,u))}else if(r-=c.size,this.trackRemovals){let u=Jw(this.ar.serializer,o.convertToNoDocument(X.min()));t.push(this.ar.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,r)),C.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(r=>(this.ur.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function lE(n){return et(n,"remoteDocumentGlobal")}function jr(n){return et(n,"remoteDocumentsV14")}function ta(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function hE(n,e){let t=e.documentKey.path.toArray();return[n,Ou(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function dE(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ie(t[s],r[s]),i)return i;return i=ie(t.length,r.length),i||(i=ie(t[t.length-2],r[r.length-2]),i||ie(t[t.length-1],r[r.length-1]))}var fp=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var qu=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&aa(r.mutation,i,Pt.empty(),De.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,se()).next(()=>r))}getLocalViewOfDocuments(e,t,r=se()){let i=hn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=ra();return s.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=hn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,se()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,r,i){let s=_t(),o=oa(),c=function(){return oa()}();return t.forEach((u,l)=>{let f=r.get(l.key);i.has(l.key)&&(f===void 0||f.mutation instanceof Ht)?s=s.insert(l.key,l):f!==void 0?(o.set(l.key,f.mutation.getFieldMask()),aa(f.mutation,l,f.mutation.getFieldMask(),De.now())):o.set(l.key,Pt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((l,f)=>o.set(l,f)),t.forEach((l,f)=>{var p;return c.set(l,new fp(f,(p=o.get(l))!==null&&p!==void 0?p:null))}),c))}recalculateAndSaveOverlays(e,t){let r=oa(),i=new Se((o,c)=>o-c),s=se();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let c of o)c.keys().forEach(u=>{let l=t.get(u);if(l===null)return;let f=r.get(u)||Pt.empty();f=c.applyToLocalView(l,f),r.set(u,f);let p=(i.get(c.batchId)||se()).add(u);i=i.insert(c.batchId,p)})}).next(()=>{let o=[],c=i.getReverseIterator();for(;c.hasNext();){let u=c.getNext(),l=u.key,f=u.value,p=ZE();f.forEach(m=>{if(!s.has(m)){let E=aI(t.get(m),r.get(m));E!==null&&p.set(m,E),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,p))}return C.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return U.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):vg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):C.resolve(hn()),c=-1,u=s;return o.next(l=>C.forEach(l,(f,p)=>(c<p.largestBatchId&&(c=p.largestBatchId),s.get(f)?C.resolve():this.remoteDocumentCache.getEntry(e,f).next(m=>{u=u.insert(f,m)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,u,l,se())).next(f=>({batchId:c,changes:YE(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(r=>{let i=ra();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=ra();return this.indexManager.getCollectionParents(e,s).next(c=>C.forEach(c,u=>{let l=function(p,m){return new Kt(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(f=>{f.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,l)=>{let f=l.getKey();o.get(f)===null&&(o=o.insert(f,Ge.newInvalidDocument(f)))});let c=ra();return o.forEach((u,l)=>{let f=s.get(u);f!==void 0&&aa(f.mutation,l,Pt.empty(),De.now()),Va(t,l)&&(c=c.insert(u,l))}),c})}};var pp=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return C.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ue(i.createTime)}}(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(i){return{name:i.name,query:Ig(i.bundledQuery),readTime:Ue(i.readTime)}}(t)),C.resolve()}};var gp=class{constructor(){this.overlays=new Se(U.comparator),this.hr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let r=hn();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),C.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){let i=hn(),s=t.length+1,o=new U(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){let u=c.getNext().value,l=u.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Se((l,f)=>l-f),o=this.overlays.getIterator();for(;o.hasNext();){let l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let f=s.get(l.largestBatchId);f===null&&(f=hn(),s=s.insert(l.largestBatchId,f)),f.set(l.getKey(),l)}}let c=hn(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((l,f)=>c.set(l,f)),!(c.size()>=i)););return C.resolve(c)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new _a(t,r));let s=this.hr.get(t);s===void 0&&(s=se(),this.hr.set(t,s)),this.hr.set(t,s.add(r.key))}};var Aa=class{constructor(){this.Pr=new we($e.Ir),this.Tr=new we($e.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let r=new $e(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new $e(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){let t=new U(new ue([])),r=new $e(t,e),i=new $e(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new U(new ue([])),r=new $e(t,e),i=new $e(t,e+1),s=se();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new $e(e,0),r=this.Pr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},$e=class{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return U.comparator(e.key,t.key)||ie(e.pr,t.pr)}static Er(e,t){return ie(e.pr,t.pr)||U.comparator(e.key,t.key)}};var mp=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new we($e.Ir)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ya(s,t,r,i);this.mutationQueue.push(o);for(let c of i)this.wr=this.wr.add(new $e(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return C.resolve(o)}lookupMutationBatch(e,t){return C.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.br(r),s=i<0?0:i;return C.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new $e(t,0),i=new $e(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let c=this.Sr(o.pr);s.push(c)}),C.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new we(ie);return t.forEach(i=>{let s=new $e(i,0),o=new $e(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],c=>{r=r.add(c.pr)})}),C.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;U.isDocumentKey(s)||(s=s.child(""));let o=new $e(new U(s),0),c=new we(ie);return this.wr.forEachWhile(u=>{let l=u.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(c=c.add(u.pr)),!0)},o),C.resolve(this.Dr(c))}Dr(e){let t=[];return e.forEach(r=>{let i=this.Sr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){H(this.Cr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return C.forEach(t.mutations,i=>{let s=new $e(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){let r=new $e(t,0),i=this.wr.firstAfterOrEqual(r);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}Cr(e,t){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var yp=class{constructor(e){this.vr=e,this.docs=function(){return new Se(U.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():Ge.newInvalidDocument(t))}getEntries(e,t){let r=_t();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ge.newInvalidDocument(i))}),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=_t(),o=t.path,c=new U(o.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){let{key:l,value:{document:f}}=u.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||gg(PE(f),r)<=0||(i.has(f.key)||Va(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return C.resolve(s)}getAllFromCollectionGroup(e,t,r,i){G()}Fr(e,t){return C.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new _p(this)}getSize(e){return C.resolve(this.size)}},_p=class extends $u{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),C.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}};var vp=class{constructor(e){this.persistence=e,this.Mr=new yn(t=>Jr(t),Ma),this.lastRemoteSnapshotVersion=X.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Aa,this.targetCount=0,this.Lr=ds.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),C.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Lr=new ds(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.qn(t),C.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Mr.forEach((o,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),C.waitFor(s).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let r=this.Mr.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),C.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),C.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Nr.gr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this.Nr.containsKey(t))}};var zu=class{constructor(e,t){this.Br={},this.overlays={},this.kr=new Rt(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new vp(this),this.indexManager=new ip,this.remoteDocumentCache=function(i){return new yp(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new Vu(t),this.$r=new pp(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new gp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new mp(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){N("MemoryPersistence","Starting transaction:",e);let i=new wp(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return C.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}},wp=class extends Tu{constructor(e){super(),this.currentSequenceNumber=e}},Gu=class n{constructor(e){this.persistence=e,this.zr=new Aa,this.jr=null}static Hr(e){return new n(e)}get Jr(){if(this.jr)return this.jr;throw G()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),C.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.Jr,r=>{let i=U.fromPath(r);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,X.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return C.or([()=>C.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}};var Ep=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new Au("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Pw,{unique:!0}),u.createObjectStore("documentMutations")}(e),fE(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=C.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),fE(e)),o=o.next(()=>function(u){let l=u.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:X.min().toTimestamp(),targetCount:0};return l.put("targetGlobalKey",f)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,l){return l.store("mutations").U().next(f=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Pw,{unique:!0});let p=l.store("mutations"),m=f.map(E=>p.put(E));return C.waitFor(m)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let l=u.createObjectStore("documentOverlays",{keyPath:HS});l.createIndex("collectionPathOverlayIndex",QS,{unique:!1}),l.createIndex("collectionGroupOverlayIndex",XS,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let l=u.createObjectStore("remoteDocumentsV14",{keyPath:FS});l.createIndex("documentKeyIndex",LS),l.createIndex("collectionGroupIndex",US)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:zS}).createIndex("sequenceNumberIndex",GS,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:WS}).createIndex("documentKeyIndex",KS,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),o}ei(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=ju(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>C.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(c=>C.forEach(c,u=>{H(u.userId===s.userId);let l=qr(this.serializer,u);return SI(e,s.userId,l).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,c)=>{let u=new ue(o),l=function(p){return[0,pt(p)]}(u);s.push(t.get(l).next(f=>f?C.resolve():(p=>t.put({targetId:0,path:pt(p),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>C.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:qS});let r=t.store("collectionParents"),i=new Ta,s=o=>{if(i.add(o)){let c=o.lastSegment(),u=o.popLast();return r.put({collectionId:c,parent:pt(u)})}};return t.store("remoteDocuments").J({H:!0},(o,c)=>{let u=new ue(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,c,u],l)=>{let f=ln(c);return s(f.popLast())}))}ri(e){let t=e.store("targets");return t.J((r,i)=>{let s=ia(i),o=AI(this.serializer,s);return t.put(o)})}ii(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let c=t.store("remoteDocumentsV14"),u=function(p){return p.document?new U(ue.fromString(p.document.name).popFirst(5)):p.noDocument?U.fromSegments(p.noDocument.path):p.unknownDocument?U.fromSegments(p.unknownDocument.path):G()}(o).path.toArray(),l={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(c.put(l))}).next(()=>C.waitFor(i))}si(e,t){let r=t.store("mutations"),i=DI(this.serializer),s=new zu(Gu.Hr,this.serializer.ct);return r.U().next(o=>{let c=new Map;return o.forEach(u=>{var l;let f=(l=c.get(u.userId))!==null&&l!==void 0?l:se();qr(this.serializer,u).keys().forEach(p=>f=f.add(p)),c.set(u.userId,f)}),C.forEach(c,(u,l)=>{let f=new qe(l),p=Fu.lt(this.serializer,f),m=s.getIndexManager(f),E=Bu.lt(f,this.serializer,m,s.referenceDelegate);return new qu(i,E,p,m).recalculateAndSaveOverlaysForDocumentKeys(new da(t,Rt.oe),u).next()})})}};function fE(n){n.createObjectStore("targetDocuments",{keyPath:BS}).createIndex("documentTargetsIndex",$S,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",jS,{unique:!0}),n.createObjectStore("targetGlobal")}var df="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ip=class n{constructor(e,t,r,i,s,o,c,u,l,f,p=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.oi=s,this.window=o,this.document=c,this._i=l,this.ai=f,this.ui=p,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=m=>Promise.resolve(),!n.D())throw new M(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new lp(this,i),this.Ti=t+"main",this.serializer=new Vu(u),this.Ei=new dr(this.Ti,this.ui,new Ep(this.serializer)),this.Qr=new op(this.referenceDelegate,this.serializer),this.remoteDocumentCache=DI(this.serializer),this.$r=new Jf,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,f===!1&&Fe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new M(P.FAILED_PRECONDITION,df);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new Rt(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=t=>R(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(t=>R(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(()=>R(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>du(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(Ir(e))return N("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return na(e).get("owner").next(t=>C.resolve(this.Si(t)))}bi(e){return du(e).delete(this.clientId)}Di(){return R(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=et(t,"clientMetadata");return r.U().next(i=>{let s=this.vi(i,18e5),o=i.filter(c=>s.indexOf(c)===-1);return C.forEach(o,c=>r.delete(c.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?C.resolve(!0):na(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new M(P.FAILED_PRECONDITION,df);return!1}}return!(!this.networkEnabled||!this.inForeground)||du(e).U().next(r=>this.vi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,c=this.networkEnabled===i.networkEnabled;if(s||o&&c)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&N("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return R(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new da(e,Rt.oe);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Li()})}vi(e,t){return e.filter(r=>this.Ci(r.updateTimeMs,t)&&!this.Mi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>du(e).U().next(t=>this.vi(t,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return Bu.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new sp(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Fu.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,r){N("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===16?YS:u===15?FE:u===14?OE:u===13?VE:u===12?JS:u===11?NE:void G()}(this.ui),o;return this.Ei.runTransaction(e,i,s,c=>(o=new da(c,this.kr?this.kr.next():Rt.oe),t==="readwrite-primary"?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw Fe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new M(P.FAILED_PRECONDITION,DE);return r(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>r(o)))).then(c=>(o.raiseOnCommittedEvent(),c))}ki(e){return na(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new M(P.FAILED_PRECONDITION,df)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return na(e).put("owner",t)}static D(){return dr.D()}yi(e){let t=na(e);return t.get("owner").next(r=>this.Si(r)?(N("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):C.resolve())}Ci(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(Fe(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ci=()=>{this.xi();let t=/(?:Version|Mobile)\/1[456]/;Gh()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let r=((t=this.di)===null||t===void 0?void 0:t.getItem(this.Fi(e)))!==null;return N("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Fe("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){Fe("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function na(n){return et(n,"owner")}function du(n){return et(n,"clientMetadata")}function Ag(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var Tp=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=se(),i=se();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Ap=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Wu=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return Gh()?8:kE(wo())>0?6:4}()}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Ap;return this.Ji(e,t,o).next(c=>{if(s.result=c,this.Ui)return this.Yi(e,t,o,c.size)})}).next(()=>s.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(Qi()<=rn.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Xi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),C.resolve()):(Qi()<=rn.DEBUG&&N("QueryEngine","Query:",Xi(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(Qi()<=rn.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Xi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,gt(t))):C.resolve())}ji(e,t){if(jw(t))return C.resolve(null);let r=gt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ku(t,null,"F"),r=gt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=se(...s);return this.zi.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,r).next(u=>{let l=this.Zi(t,c);return this.Xi(t,l,o,u.readTime)?this.ji(e,ku(t,null,"F")):this.es(e,l,t,u)}))})))}Hi(e,t,r,i){return jw(t)||i.isEqual(X.min())?C.resolve(null):this.zi.getDocuments(e,r).next(s=>{let o=this.Zi(t,s);return this.Xi(t,o,r,i)?C.resolve(null):(Qi()<=rn.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Xi(t)),this.es(e,o,t,RE(i,-1)).next(c=>c))})}Zi(e,t){let r=new we(XE(e));return t.forEach((i,s)=>{Va(e,s)&&(r=r.add(s))}),r}Xi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,r){return Qi()<=rn.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Xi(t)),this.zi.getDocumentsMatchingQuery(e,t,Ft.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var bp=class{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new Se(ie),this.rs=new yn(s=>Jr(s),Ma),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new qu(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}};function kI(n,e,t,r){return new bp(n,e,t,r)}function xI(n,e){return R(this,null,function*(){let t=j(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],c=[],u=se();for(let l of i){o.push(l.batchId);for(let f of l.mutations)u=u.add(f.key)}for(let l of s){c.push(l.batchId);for(let f of l.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next(l=>({us:l,removedBatchIds:o,addedBatchIds:c}))})})})}function kR(n,e){let t=j(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(c,u,l,f){let p=l.batch,m=p.keys(),E=C.resolve();return m.forEach(k=>{E=E.next(()=>f.getEntry(u,k)).next(x=>{let D=l.docVersions.get(k);H(D!==null),x.version.compareTo(D)<0&&(p.applyToRemoteDocument(x,l),x.isValidDocument()&&(x.setReadTime(l.commitVersion),f.addEntry(x)))})}),E.next(()=>c.mutationQueue.removeMutationBatch(u,p))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let u=se();for(let l=0;l<c.mutationResults.length;++l)c.mutationResults[l].transformResults.length>0&&(u=u.add(c.batch.mutations[l].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function MI(n){let e=j(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function xR(n,e){let t=j(n),r=e.snapshotVersion,i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;let c=[];e.targetChanges.forEach((f,p)=>{let m=i.get(p);if(!m)return;c.push(t.Qr.removeMatchingKeys(s,f.removedDocuments,p).next(()=>t.Qr.addMatchingKeys(s,f.addedDocuments,p)));let E=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?E=E.withResumeToken(Ze.EMPTY_BYTE_STRING,X.min()).withLastLimboFreeSnapshotVersion(X.min()):f.resumeToken.approximateByteSize()>0&&(E=E.withResumeToken(f.resumeToken,r)),i=i.insert(p,E),function(x,D,$){return x.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(m,E,f)&&c.push(t.Qr.updateTargetData(s,E))});let u=_t(),l=se();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),c.push(NI(s,o,e.documentUpdates).next(f=>{u=f.cs,l=f.ls})),!r.isEqual(X.min())){let f=t.Qr.getLastRemoteSnapshotVersion(s).next(p=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(f)}return C.waitFor(c).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,l)).next(()=>u)}).then(s=>(t.ns=i,s))}function NI(n,e,t){let r=se(),i=se();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=_t();return t.forEach((c,u)=>{let l=s.get(c);u.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(X.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!l.isValidDocument()||u.version.compareTo(l.version)>0||u.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):N("LocalStore","Ignoring outdated watch update for ",c,". Current version:",l.version," Watch version:",u.version)}),{cs:o,ls:i}})}function MR(n,e){let t=j(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function fs(n,e){let t=j(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(s=>s?(i=s,C.resolve(i)):t.Qr.allocateTargetId(r).next(o=>(i=new hs(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}function ps(n,e,t){return R(this,null,function*(){let r=j(n),i=r.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Ir(o))throw o;N("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)})}function Ku(n,e,t){let r=j(n),i=X.min(),s=se();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,l,f){let p=j(u),m=p.rs.get(f);return m!==void 0?C.resolve(p.ns.get(m)):p.Qr.getTargetData(l,f)}(r,o,gt(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,c.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,t?i:X.min(),t?s:se())).next(c=>(FI(r,QE(e),c),{documents:c,hs:s})))}function VI(n,e){let t=j(n),r=j(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function OI(n,e){let t=j(n),r=t.ss.get(e)||X.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,RE(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(FI(t,e,i),i))}function FI(n,e,t){let r=n.ss.get(e)||X.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(e,r)}function NR(n,e,t,r){return R(this,null,function*(){let i=j(n),s=se(),o=_t();for(let l of t){let f=e.Ps(l.metadata.name);l.document&&(s=s.add(f));let p=e.Is(l);p.setReadTime(e.Ts(l.metadata.readTime)),o=o.insert(f,p)}let c=i.os.newChangeBuffer({trackRemovals:!0}),u=yield fs(i,function(f){return gt(Is(ue.fromString(`__bundle__/docs/${f}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",l=>NI(l,c,o).next(f=>(c.apply(l),f)).next(f=>i.Qr.removeMatchingKeysForTargetId(l,u.targetId).next(()=>i.Qr.addMatchingKeys(l,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(l,f.cs,f.ls)).next(()=>f.cs)))})}function VR(r,i){return R(this,arguments,function*(n,e,t=se()){let s=yield fs(n,gt(Ig(e.bundledQuery))),o=j(n);return o.persistence.runTransaction("Save named query","readwrite",c=>{let u=Ue(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.$r.saveNamedQuery(c,e);let l=s.withResumeToken(Ze.EMPTY_BYTE_STRING,u);return o.ns=o.ns.insert(l.targetId,l),o.Qr.updateTargetData(c,l).next(()=>o.Qr.removeMatchingKeysForTargetId(c,s.targetId)).next(()=>o.Qr.addMatchingKeys(c,t,s.targetId)).next(()=>o.$r.saveNamedQuery(c,e))})})}function pE(n,e){return`firestore_clients_${n}_${e}`}function gE(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function ff(n,e){return`firestore_targets_${n}_${e}`}var Hu=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Es(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new M(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(Fe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},ca=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Es(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new M(r.error.code,r.error.message))),s?new n(e,r.state,i):(Fe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Qu=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=wg();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=xE(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Fe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Cp=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Fe("SharedClientState",`Failed to parse online state: ${e}`),null)}},ba=class{constructor(){this.activeTargetIds=wg()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},ua=class{constructor(e,t,r,i,s){this.window=e,this.oi=t,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new Se(ie),this.started=!1,this.ys=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=pE(this.persistenceKey,this.Vs),this.Ss=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new ba),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){return R(this,null,function*(){let e=yield this.syncEngine.Bi();for(let r of e){if(r===this.Vs)continue;let i=this.getItem(pE(this.persistenceKey,r));if(i){let s=Qu.Es(r,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let t=this.storage.getItem(this.vs);if(t){let r=this.xs(t);r&&this.Os(r)}for(let r of this.ys)this.gs(r);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,r){this.Ls(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(ff(this.persistenceKey,e));if(r){let i=ca.Es(e,r);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ff(this.persistenceKey,e))}updateQueryState(e,t,r){this.qs(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return N("SharedClientState","READ",e,t),t}setItem(e,t){N("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){N("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){let t=e;if(t.storageArea===this.storage){if(N("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void Fe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>R(this,null,function*(){if(this.started){if(t.key!==null){if(this.bs.test(t.key)){if(t.newValue==null){let r=this.$s(t.key);return this.Us(r,null)}{let r=this.Ws(t.key,t.newValue);if(r)return this.Us(r.clientId,r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let r=this.Gs(t.key,t.newValue);if(r)return this.zs(r)}}else if(this.Cs.test(t.key)){if(t.newValue!==null){let r=this.js(t.key,t.newValue);if(r)return this.Hs(r)}}else if(t.key===this.vs){if(t.newValue!==null){let r=this.xs(t.newValue);if(r)return this.Os(r)}}else if(t.key===this.Ss){let r=function(s){let o=Rt.oe;if(s!=null)try{let c=JSON.parse(s);H(typeof c=="number"),o=c}catch(c){Fe("SharedClientState","Failed to read sequence number from WebStorage",c)}return o}(t.newValue);r!==Rt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Fs){let r=this.Js(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,r){let i=new Hu(this.currentUser,e,t,r),s=gE(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){let t=gE(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,r){let i=ff(this.persistenceKey,e),s=new ca(e,t,r);this.setItem(i,s.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let r=this.$s(e);return Qu.Es(r,t)}Gs(e,t){let r=this.Ds.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Hu.Es(new qe(s),i,t)}js(e,t){let r=this.Cs.exec(e),i=Number(r[1]);return ca.Es(i,t)}xs(e){return Cp.Es(e)}Js(e){return JSON.parse(e)}zs(e){return R(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);N("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let r=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(r),o=[],c=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||c.push(u)}),this.syncEngine.eo(o,c).then(()=>{this.ps=r})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=wg();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Xu=class{constructor(){this.no=new ba,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new ba,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Sp=class{io(e){}shutdown(){}};var Ju=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var fu=null;function pf(){return fu===null?fu=function(){return 268435456+Math.round(2147483648*Math.random())}():fu++,"0x"+fu.toString(16)}var OR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Rp=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}};var ut="WebChannelConnection",Pp=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.wo=r+"://"+t.host,this.So=`projects/${i}/databases/${s}`,this.bo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Do(){return!1}Co(t,r,i,s,o){let c=pf(),u=this.vo(t,r.toUriEncodedString());N("RestConnection",`Sending RPC '${t}' ${c}:`,u,i);let l={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(l,s,o),this.Mo(t,u,l,i).then(f=>(N("RestConnection",`Received RPC '${t}' ${c}: `,f),f),f=>{throw Ot("RestConnection",`RPC '${t}' ${c} failed with error: `,f,"url: ",u,"request:",i),f})}xo(t,r,i,s,o,c){return this.Co(t,r,i,s,o)}Fo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Es}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}vo(t,r){let i=OR[t];return`${this.wo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,r,i){let s=pf();return new Promise((o,c)=>{let u=new sf;u.setWithCredentials(!0),u.listenOnce(af.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Yo.NO_ERROR:let f=u.getResponseJson();N(ut,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),o(f);break;case Yo.TIMEOUT:N(ut,`RPC '${e}' ${s} timed out`),c(new M(P.DEADLINE_EXCEEDED,"Request time out"));break;case Yo.HTTP_ERROR:let p=u.getStatus();if(N(ut,`RPC '${e}' ${s} failed with status:`,p,"response text:",u.getResponseText()),p>0){let m=u.getResponseJson();Array.isArray(m)&&(m=m[0]);let E=m?.error;if(E&&E.status&&E.message){let k=function(D){let $=D.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf($)>=0?$:P.UNKNOWN}(E.status);c(new M(k,E.message))}else c(new M(P.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new M(P.UNAVAILABLE,"Connection failed."));break;default:G()}}finally{N(ut,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(i);N(ut,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",l,r,15)})}Oo(e,t,r){let i=pf(),s=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=lf(),c=uf(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(u.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(u.xmlHttpFactory=new of({})),this.Fo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let f=s.join("");N(ut,`Creating RPC '${e}' stream ${i}: ${f}`,u);let p=o.createWebChannel(f,u),m=!1,E=!1,k=new Rp({lo:D=>{E?N(ut,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(m||(N(ut,`Opening RPC '${e}' stream ${i} transport.`),p.open(),m=!0),N(ut,`RPC '${e}' stream ${i} sending:`,D),p.send(D))},ho:()=>p.close()}),x=(D,$,K)=>{D.listen($,V=>{try{K(V)}catch(W){setTimeout(()=>{throw W},0)}})};return x(p,zi.EventType.OPEN,()=>{E||(N(ut,`RPC '${e}' stream ${i} transport opened.`),k.mo())}),x(p,zi.EventType.CLOSE,()=>{E||(E=!0,N(ut,`RPC '${e}' stream ${i} transport closed`),k.po())}),x(p,zi.EventType.ERROR,D=>{E||(E=!0,Ot(ut,`RPC '${e}' stream ${i} transport errored:`,D),k.po(new M(P.UNAVAILABLE,"The operation could not be completed")))}),x(p,zi.EventType.MESSAGE,D=>{var $;if(!E){let K=D.data[0];H(!!K);let V=K,W=V.error||(($=V[0])===null||$===void 0?void 0:$.error);if(W){N(ut,`RPC '${e}' stream ${i} received error:`,W);let te=W.status,ne=function(v){let I=Be[v];if(I!==void 0)return lI(I)}(te),w=W.message;ne===void 0&&(ne=P.INTERNAL,w="Unknown error status: "+te+" with message "+W.message),E=!0,k.po(new M(ne,w)),p.close()}else N(ut,`RPC '${e}' stream ${i} received:`,K),k.yo(K)}}),x(c,cf.STAT_EVENT,D=>{D.stat===uu.PROXY?N(ut,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===uu.NOPROXY&&N(ut,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.fo()},0),k}};function LI(){return typeof window<"u"?window:null}function _u(){return typeof document<"u"?document:null}function Oa(n){return new Wf(n,!0)}var Ca=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.No=r,this.Lo=i,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();let t=Math.floor(this.ko+this.Uo()),r=Math.max(0,Date.now()-this.Qo),i=Math.max(0,t-r);i>0&&N("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){this.qo!==null&&(this.qo.skipDelay(),this.qo=null)}cancel(){this.qo!==null&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}};var Yu=class{constructor(e,t,r,i,s,o,c,u){this.oi=e,this.Go=r,this.zo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new Ca(e,t)}Zo(){return this.state===1||this.state===5||this.Xo()}Xo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.e_()}stop(){return R(this,null,function*(){this.Zo()&&(yield this.close(0))})}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&this.Ho===null&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}r_(){return R(this,null,function*(){if(this.Xo())return this.close(0)})}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(e,t){return R(this,null,function*(){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,e!==4?this.Yo.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(Fe(t.toString()),Fe("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.__(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Ao(t)})}__(){}auth(){this.state=1;let e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.jo===t&&this.u_(r,i)},r=>{e(()=>{let i=new M(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.c_(i)})})}u_(e,t){let r=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{r(()=>this.listener.Po())}),this.stream.To(()=>{r(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{r(()=>this.c_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}e_(){this.state=5,this.Yo.$o(()=>R(this,null,function*(){this.state=0,this.start()}))}c_(e){return N("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Dp=class extends Yu{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();let t=wR(this.serializer,e),r=function(s){if(!("targetChange"in s))return X.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?X.min():o.readTime?Ue(o.readTime):X.min()}(e);return this.listener.h_(t,r)}P_(e){let t={};t.database=Qf(this.serializer),t.addTarget=function(s,o){let c,u=o.target;if(c=Pu(u)?{documents:_I(s,u)}:{query:vI(s,u)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=dI(s,o.resumeToken);let l=Kf(s,o.expectedCount);l!==null&&(c.expectedCount=l)}else if(o.snapshotVersion.compareTo(X.min())>0){c.readTime=ls(s,o.snapshotVersion.toTimestamp());let l=Kf(s,o.expectedCount);l!==null&&(c.expectedCount=l)}return c}(this.serializer,e);let r=IR(this.serializer,e);r&&(t.labels=r),this.i_(t)}I_(e){let t={};t.database=Qf(this.serializer),t.removeTarget=e,this.i_(t)}},kp=class extends Yu{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(H(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();let t=ER(e.writeResults,e.commitTime),r=Ue(e.commitTime);return this.listener.A_(r,t)}return H(!e.writeResults||e.writeResults.length===0),this.T_=!0,this.listener.R_()}V_(){let e={};e.database=Qf(this.serializer),this.i_(e)}d_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Ia(this.serializer,r))};this.i_(t)}};var xp=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new M(P.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,r,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Co(e,Hf(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new M(P.UNKNOWN,s.toString())})}xo(e,t,r,i,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.xo(e,Hf(t,r),i,o,c,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new M(P.UNKNOWN,o.toString())})}terminate(){this.m_=!0,this.connection.terminate()}},Mp=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,e==="Online"&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(Fe(t),this.y_=!1):N("OnlineStateTracker",t)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var Np=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io(o=>{r.enqueueAndForget(()=>R(this,null,function*(){Tr(this)&&(N("RemoteStore","Restarting streams for network reachability change."),yield function(u){return R(this,null,function*(){let l=j(u);l.M_.add(4),yield Ts(l),l.N_.set("Unknown"),l.M_.delete(4),yield Fa(l)})}(this))}))}),this.N_=new Mp(r,i)}};function Fa(n){return R(this,null,function*(){if(Tr(n))for(let e of n.x_)yield e(!0)})}function Ts(n){return R(this,null,function*(){for(let e of n.x_)yield e(!1)})}function yl(n,e){let t=j(n);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),Sg(t)?Cg(t):bs(t).Xo()&&bg(t,e))}function gs(n,e){let t=j(n),r=bs(t);t.F_.delete(e),r.Xo()&&UI(t,e),t.F_.size===0&&(r.Xo()?r.n_():Tr(t)&&t.N_.set("Unknown"))}function bg(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(X.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}bs(n).P_(e)}function UI(n,e){n.L_.xe(e),bs(n).I_(e)}function Cg(n){n.L_=new Gf({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),bs(n).start(),n.N_.w_()}function Sg(n){return Tr(n)&&!bs(n).Zo()&&n.F_.size>0}function Tr(n){return j(n).M_.size===0}function jI(n){n.L_=void 0}function FR(n){return R(this,null,function*(){n.N_.set("Online")})}function LR(n){return R(this,null,function*(){n.F_.forEach((e,t)=>{bg(n,e)})})}function UR(n,e){return R(this,null,function*(){jI(n),Sg(n)?(n.N_.D_(e),Cg(n)):n.N_.set("Unknown")})}function jR(n,e,t){return R(this,null,function*(){if(n.N_.set("Online"),e instanceof Mu&&e.state===2&&e.cause)try{yield function(i,s){return R(this,null,function*(){let o=s.cause;for(let c of s.targetIds)i.F_.has(c)&&(yield i.remoteSyncer.rejectListen(c,o),i.F_.delete(c),i.L_.removeTarget(c))})}(n,e)}catch(r){N("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Zu(n,r)}else if(e instanceof rs?n.L_.Ke(e):e instanceof xu?n.L_.He(e):n.L_.We(e),!t.isEqual(X.min()))try{let r=yield MI(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let c=s.L_.rt(o);return c.targetChanges.forEach((u,l)=>{if(u.resumeToken.approximateByteSize()>0){let f=s.F_.get(l);f&&s.F_.set(l,f.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,l)=>{let f=s.F_.get(u);if(!f)return;s.F_.set(u,f.withResumeToken(Ze.EMPTY_BYTE_STRING,f.snapshotVersion)),UI(s,u);let p=new hs(f.target,u,l,f.sequenceNumber);bg(s,p)}),s.remoteSyncer.applyRemoteEvent(c)}(n,t))}catch(r){N("RemoteStore","Failed to raise snapshot:",r),yield Zu(n,r)}})}function Zu(n,e,t){return R(this,null,function*(){if(!Ir(e))throw e;n.M_.add(1),yield Ts(n),n.N_.set("Offline"),t||(t=()=>MI(n.localStore)),n.asyncQueue.enqueueRetryable(()=>R(this,null,function*(){N("RemoteStore","Retrying IndexedDB access"),yield t(),n.M_.delete(1),yield Fa(n)}))})}function BI(n,e){return e().catch(t=>Zu(n,t,e))}function As(n){return R(this,null,function*(){let e=j(n),t=wr(e),r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;BR(e);)try{let i=yield MR(e.localStore,r);if(i===null){e.v_.length===0&&t.n_();break}r=i.batchId,$R(e,i)}catch(i){yield Zu(e,i)}$I(e)&&qI(e)})}function BR(n){return Tr(n)&&n.v_.length<10}function $R(n,e){n.v_.push(e);let t=wr(n);t.Xo()&&t.E_&&t.d_(e.mutations)}function $I(n){return Tr(n)&&!wr(n).Zo()&&n.v_.length>0}function qI(n){wr(n).start()}function qR(n){return R(this,null,function*(){wr(n).V_()})}function zR(n){return R(this,null,function*(){let e=wr(n);for(let t of n.v_)e.d_(t.mutations)})}function GR(n,e,t){return R(this,null,function*(){let r=n.v_.shift(),i=$f.from(r,e,t);yield BI(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield As(n)})}function WR(n,e){return R(this,null,function*(){e&&wr(n).E_&&(yield function(r,i){return R(this,null,function*(){if(function(o){return uI(o)&&o!==P.ABORTED}(i.code)){let s=r.v_.shift();wr(r).t_(),yield BI(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield As(r)}})}(n,e)),$I(n)&&qI(n)})}function mE(n,e){return R(this,null,function*(){let t=j(n);t.asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials");let r=Tr(t);t.M_.add(3),yield Ts(t),r&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield Fa(t)})}function Vp(n,e){return R(this,null,function*(){let t=j(n);e?(t.M_.delete(2),yield Fa(t)):e||(t.M_.add(2),yield Ts(t),t.N_.set("Unknown"))})}function bs(n){return n.B_||(n.B_=function(t,r,i){let s=j(t);return s.f_(),new Dp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:FR.bind(null,n),To:LR.bind(null,n),Ao:UR.bind(null,n),h_:jR.bind(null,n)}),n.x_.push(e=>R(this,null,function*(){e?(n.B_.t_(),Sg(n)?Cg(n):n.N_.set("Unknown")):(yield n.B_.stop(),jI(n))}))),n.B_}function wr(n){return n.k_||(n.k_=function(t,r,i){let s=j(t);return s.f_(),new kp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:()=>Promise.resolve(),To:qR.bind(null,n),Ao:WR.bind(null,n),R_:zR.bind(null,n),A_:GR.bind(null,n)}),n.x_.push(e=>R(this,null,function*(){e?(n.k_.t_(),yield As(n)):(yield n.k_.stop(),n.v_.length>0&&(N("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))}))),n.k_}var Op=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ze,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,c=new n(e,t,o,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new M(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Cs(n,e){if(Fe("AsyncQueue",`${e}: ${n}`),Ir(n))return new M(P.UNAVAILABLE,`${e}: ${n}`);throw n}var el=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||U.comparator(t.key,r.key):(t,r)=>U.comparator(t.key,r.key),this.keyedMap=ra(),this.sortedSet=new Se(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var tl=class{constructor(){this.q_=new Se(U.comparator)}track(e){let t=e.doc.key,r=this.q_.get(t);r?e.type!==0&&r.type===3?this.q_=this.q_.insert(t,e):e.type===3&&r.type!==1?this.q_=this.q_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.q_=this.q_.remove(t):e.type===1&&r.type===2?this.q_=this.q_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):G():this.q_=this.q_.insert(t,e)}Q_(){let e=[];return this.q_.inorderTraversal((t,r)=>{e.push(r)}),e}},ms=class n{constructor(e,t,r,i,s,o,c,u,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new n(e,t,el.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Na(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Fp=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}},Lp=class{constructor(){this.queries=new yn(e=>HE(e),Na),this.onlineState="Unknown",this.z_=new Set}};function Rg(n,e){return R(this,null,function*(){let t=j(n),r=3,i=e.query,s=t.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new Fp,r=e.G_()?0:1);try{switch(r){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let c=Cs(o,`Initialization of query '${Xi(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&Dg(t)})}function Pg(n,e){return R(this,null,function*(){let t=j(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.U_.indexOf(e);o>=0&&(s.U_.splice(o,1),s.U_.length===0?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function KR(n,e){let t=j(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let c of o.U_)c.H_(i)&&(r=!0);o.K_=i}}r&&Dg(t)}function HR(n,e,t){let r=j(n),i=r.queries.get(e);if(i)for(let s of i.U_)s.onError(t);r.queries.delete(e)}function Dg(n){n.z_.forEach(e=>{e.next()})}var Up,yE;(yE=Up||(Up={})).J_="default",yE.Cache="cache";var Sa=class{constructor(e,t,r){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ms(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache||!this.G_())return!0;let r=t!=="Offline";return(!this.options.ra||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ea(e){if(e.docChanges.length>0)return!0;let t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}na(e){e=ms.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==Up.Cache}};var jp=class{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}};var nl=class{constructor(e){this.serializer=e}Ps(e){return fn(this.serializer,e)}Is(e){return e.metadata.exists?yI(this.serializer,e.document,!1):Ge.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return Ue(e)}},Bp=class{constructor(e,t,r){this.oa=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=zI(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;let r=ue.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){let t=new Map,r=new nl(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Ps(i.metadata.name);for(let o of i.metadata.queries){let c=(t.get(o)||se()).add(s);t.set(o,c)}}return t}complete(){return R(this,null,function*(){let e=yield NR(this.localStore,new nl(this.serializer),this.documents,this.oa.id),t=this.aa(this.documents);for(let r of this.queries)yield VR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:e}})}};function zI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var rl=class{constructor(e){this.key=e}},il=class{constructor(e){this.key=e}},sl=class{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=se(),this.mutatedKeys=se(),this.Ia=XE(e),this.Ta=new el(this.Ia)}get Ea(){return this.la}da(e,t){let r=t?t.Aa:new tl,i=t?t.Ta:this.Ta,s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,p)=>{let m=i.get(f),E=Va(this.query,p)?p:null,k=!!m&&this.mutatedKeys.has(m.key),x=!!E&&(E.hasLocalMutations||this.mutatedKeys.has(E.key)&&E.hasCommittedMutations),D=!1;m&&E?m.data.isEqual(E.data)?k!==x&&(r.track({type:3,doc:E}),D=!0):this.Ra(m,E)||(r.track({type:2,doc:E}),D=!0,(u&&this.Ia(E,u)>0||l&&this.Ia(E,l)<0)&&(c=!0)):!m&&E?(r.track({type:0,doc:E}),D=!0):m&&!E&&(r.track({type:1,doc:m}),D=!0,(u||l)&&(c=!0)),D&&(E?(o=o.add(E),s=x?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),r.track({type:1,doc:f})}return{Ta:o,Aa:r,Xi:c,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;let o=e.Aa.Q_();o.sort((f,p)=>function(E,k){let x=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return G()}};return x(E)-x(k)}(f.type,p.type)||this.Ia(f.doc,p.doc)),this.Va(r),i=i!=null&&i;let c=t&&!i?this.ma():[],u=this.Pa.size===0&&this.current&&!i?1:0,l=u!==this.ha;return this.ha=u,o.length!==0||l?{snapshot:new ms(this.query,e.Ta,s,o,e.mutatedKeys,u===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:c}:{fa:c}}j_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new tl,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];let e=this.Pa;this.Pa=se(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});let t=[];return e.forEach(r=>{this.Pa.has(r)||t.push(new il(r))}),this.Pa.forEach(r=>{e.has(r)||t.push(new rl(r))}),t}pa(e){this.la=e.hs,this.Pa=se();let t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return ms.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},$p=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},qp=class{constructor(e){this.key=e,this.wa=!1}},zp=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new yn(c=>HE(c),Na),this.Da=new Map,this.Ca=new Set,this.va=new Se(U.comparator),this.Fa=new Map,this.Ma=new Aa,this.xa={},this.Oa=new Map,this.Na=ds.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function QR(n,e,t=!0){return R(this,null,function*(){let r=_l(n),i,s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield GI(r,e,t,!0),i})}function XR(n,e){return R(this,null,function*(){let t=_l(n);yield GI(t,e,!0,!1)})}function GI(n,e,t,r){return R(this,null,function*(){let i=yield fs(n.localStore,gt(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",c;return r&&(c=yield kg(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&yl(n.remoteStore,i),c})}function kg(n,e,t,r,i){return R(this,null,function*(){n.Ba=(p,m,E)=>function(x,D,$,K){return R(this,null,function*(){let V=D.view.da($);V.Xi&&(V=yield Ku(x.localStore,D.query,!1).then(({documents:w})=>D.view.da(w,V)));let W=K&&K.targetChanges.get(D.targetId),te=K&&K.targetMismatches.get(D.targetId)!=null,ne=D.view.applyChanges(V,x.isPrimaryClient,W,te);return Gp(x,D.targetId,ne.fa),ne.snapshot})}(n,p,m,E);let s=yield Ku(n.localStore,e,!0),o=new sl(e,s.hs),c=o.da(s.documents),u=wa.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),l=o.applyChanges(c,n.isPrimaryClient,u);Gp(n,t,l.fa);let f=new $p(e,t,o);return n.ba.set(e,f),n.Da.has(t)?n.Da.get(t).push(e):n.Da.set(t,[e]),l.snapshot})}function JR(n,e,t){return R(this,null,function*(){let r=j(n),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!Na(o,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield ps(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&gs(r.remoteStore,i.targetId),ys(r,i.targetId)}).catch(Er))):(ys(r,i.targetId),yield ps(r.localStore,i.targetId,!0))})}function YR(n,e){return R(this,null,function*(){let t=j(n),r=t.ba.get(e),i=t.Da.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),gs(t.remoteStore,r.targetId))})}function ZR(n,e,t){return R(this,null,function*(){let r=Vg(n);try{let i=yield function(o,c){let u=j(o),l=De.now(),f=c.reduce((E,k)=>E.add(k.key),se()),p,m;return u.persistence.runTransaction("Locally write mutations","readwrite",E=>{let k=_t(),x=se();return u.os.getEntries(E,f).next(D=>{k=D,k.forEach(($,K)=>{K.isValidDocument()||(x=x.add($))})}).next(()=>u.localDocuments.getOverlayedDocuments(E,k)).next(D=>{p=D;let $=[];for(let K of c){let V=fR(K,p.get(K.key).overlayedDocument);V!=null&&$.push(new Ht(K.key,V,BE(V.value.mapValue),Ve.exists(!0)))}return u.mutationQueue.addMutationBatch(E,l,$,c)}).next(D=>{m=D;let $=D.applyToLocalDocumentSet(p,x);return u.documentOverlayCache.saveOverlays(E,D.batchId,$)})}).then(()=>({batchId:m.batchId,changes:YE(p)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,c,u){let l=o.xa[o.currentUser.toKey()];l||(l=new Se(ie)),l=l.insert(c,u),o.xa[o.currentUser.toKey()]=l}(r,i.batchId,t),yield Ln(r,i.changes),yield As(r.remoteStore)}catch(i){let s=Cs(i,"Failed to persist write");t.reject(s)}})}function WI(n,e){return R(this,null,function*(){let t=j(n);try{let r=yield xR(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Fa.get(s);o&&(H(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?H(o.wa):i.removedDocuments.size>0&&(H(o.wa),o.wa=!1))}),yield Ln(t,r,e)}catch(r){yield Er(r)}})}function _E(n,e,t){let r=j(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.ba.forEach((s,o)=>{let c=o.view.j_(e);c.snapshot&&i.push(c.snapshot)}),function(o,c){let u=j(o);u.onlineState=c;let l=!1;u.queries.forEach((f,p)=>{for(let m of p.U_)m.j_(c)&&(l=!0)}),l&&Dg(u)}(r.eventManager,e),i.length&&r.Sa.h_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function eP(n,e,t){return R(this,null,function*(){let r=j(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Fa.get(e),s=i&&i.key;if(s){let o=new Se(U.comparator);o=o.insert(s,Ge.newNoDocument(s,X.min()));let c=se().add(s),u=new va(X.min(),new Map,new Se(ie),o,c);yield WI(r,u),r.va=r.va.remove(s),r.Fa.delete(e),Ng(r)}else yield ps(r.localStore,e,!1).then(()=>ys(r,e,t)).catch(Er)})}function tP(n,e){return R(this,null,function*(){let t=j(n),r=e.batch.batchId;try{let i=yield kR(t.localStore,e);Mg(t,r,null),xg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Ln(t,i)}catch(i){yield Er(i)}})}function nP(n,e,t){return R(this,null,function*(){let r=j(n);try{let i=yield function(o,c){let u=j(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let f;return u.mutationQueue.lookupMutationBatch(l,c).next(p=>(H(p!==null),f=p.keys(),u.mutationQueue.removeMutationBatch(l,p))).next(()=>u.mutationQueue.performConsistencyCheck(l)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(l,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,f)).next(()=>u.localDocuments.getDocuments(l,f))})}(r.localStore,e);Mg(r,e,t),xg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Ln(r,i)}catch(i){yield Er(i)}})}function rP(n,e){return R(this,null,function*(){let t=j(n);Tr(t.remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let c=j(o);return c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>c.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();let i=t.Oa.get(r)||[];i.push(e),t.Oa.set(r,i)}catch(r){let i=Cs(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function xg(n,e){(n.Oa.get(e)||[]).forEach(t=>{t.resolve()}),n.Oa.delete(e)}function Mg(n,e,t){let r=j(n),i=r.xa[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function ys(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Da.get(e))n.ba.delete(r),t&&n.Sa.ka(r,t);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Vr(e).forEach(r=>{n.Ma.containsKey(r)||KI(n,r)})}function KI(n,e){n.Ca.delete(e.path.canonicalString());let t=n.va.get(e);t!==null&&(gs(n.remoteStore,t),n.va=n.va.remove(e),n.Fa.delete(t),Ng(n))}function Gp(n,e,t){for(let r of t)r instanceof rl?(n.Ma.addReference(r.key,e),iP(n,r)):r instanceof il?(N("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,e),n.Ma.containsKey(r.key)||KI(n,r.key)):G()}function iP(n,e){let t=e.key,r=t.path.canonicalString();n.va.get(t)||n.Ca.has(r)||(N("SyncEngine","New document in limbo: "+t),n.Ca.add(r),Ng(n))}function Ng(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){let e=n.Ca.values().next().value;n.Ca.delete(e);let t=new U(ue.fromString(e)),r=n.Na.next();n.Fa.set(r,new qp(t)),n.va=n.va.insert(t,r),yl(n.remoteStore,new hs(gt(Is(t.path)),r,"TargetPurposeLimboResolution",Rt.oe))}}function Ln(n,e,t){return R(this,null,function*(){let r=j(n),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach((c,u)=>{o.push(r.Ba(u,e,t).then(l=>{if((l||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,l?.fromCache?"not-current":"current"),l){i.push(l);let f=Tp.Ki(u.targetId,l);s.push(f)}}))}),yield Promise.all(o),r.Sa.h_(i),yield function(u,l){return R(this,null,function*(){let f=j(u);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>C.forEach(l,m=>C.forEach(m.qi,E=>f.persistence.referenceDelegate.addReference(p,m.targetId,E)).next(()=>C.forEach(m.Qi,E=>f.persistence.referenceDelegate.removeReference(p,m.targetId,E)))))}catch(p){if(!Ir(p))throw p;N("LocalStore","Failed to update sequence numbers: "+p)}for(let p of l){let m=p.targetId;if(!p.fromCache){let E=f.ns.get(m),k=E.snapshotVersion,x=E.withLastLimboFreeSnapshotVersion(k);f.ns=f.ns.insert(m,x)}}})}(r.localStore,s))})}function sP(n,e){return R(this,null,function*(){let t=j(n);if(!t.currentUser.isEqual(e)){N("SyncEngine","User change. New user:",e.toKey());let r=yield xI(t.localStore,e);t.currentUser=e,function(s,o){s.Oa.forEach(c=>{c.forEach(u=>{u.reject(new M(P.CANCELLED,o))})}),s.Oa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Ln(t,r.us)}})}function oP(n,e){let t=j(n),r=t.Fa.get(e);if(r&&r.wa)return se().add(r.key);{let i=se(),s=t.Da.get(e);if(!s)return i;for(let o of s){let c=t.ba.get(o);i=i.unionWith(c.view.Ea)}return i}}function aP(n,e){return R(this,null,function*(){let t=j(n),r=yield Ku(t.localStore,e.query,!0),i=e.view.pa(r);return t.isPrimaryClient&&Gp(t,e.targetId,i.fa),i})}function cP(n,e){return R(this,null,function*(){let t=j(n);return OI(t.localStore,e).then(r=>Ln(t,r))})}function uP(n,e,t,r){return R(this,null,function*(){let i=j(n),s=yield function(c,u){let l=j(c),f=j(l.mutationQueue);return l.persistence.runTransaction("Lookup mutation documents","readonly",p=>f.vn(p,u).next(m=>m?l.localDocuments.getDocuments(p,m):C.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield As(i.remoteStore):t==="acknowledged"||t==="rejected"?(Mg(i,e,r||null),xg(i,e),function(c,u){j(j(c).mutationQueue).Mn(u)}(i.localStore,e)):G(),yield Ln(i,s)):N("SyncEngine","Cannot apply mutation batch with id: "+e)})}function lP(n,e){return R(this,null,function*(){let t=j(n);if(_l(t),Vg(t),e===!0&&t.La!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield vE(t,r.toArray());t.La=!0,yield Vp(t.remoteStore,!0);for(let s of i)yl(t.remoteStore,s)}else if(e===!1&&t.La!==!1){let r=[],i=Promise.resolve();t.Da.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(ys(t,o),ps(t.localStore,o,!0))),gs(t.remoteStore,o)}),yield i,yield vE(t,r),function(o){let c=j(o);c.Fa.forEach((u,l)=>{gs(c.remoteStore,l)}),c.Ma.mr(),c.Fa=new Map,c.va=new Se(U.comparator)}(t),t.La=!1,yield Vp(t.remoteStore,!1)}})}function vE(n,e,t){return R(this,null,function*(){let r=j(n),i=[],s=[];for(let o of e){let c,u=r.Da.get(o);if(u&&u.length!==0){c=yield fs(r.localStore,gt(u[0]));for(let l of u){let f=r.ba.get(l),p=yield aP(r,f);p.snapshot&&s.push(p.snapshot)}}else{let l=yield VI(r.localStore,o);c=yield fs(r.localStore,l),yield kg(r,HI(l),o,!1,c.resumeToken)}i.push(c)}return r.Sa.h_(s),i})}function HI(n){return KE(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function hP(n){return function(t){return j(j(t).persistence).Bi()}(j(n).localStore)}function dP(n,e,t,r){return R(this,null,function*(){let i=j(n);if(i.La)return void N("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield OI(i.localStore,QE(s[0])),c=va.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ze.EMPTY_BYTE_STRING);yield Ln(i,o,c);break}case"rejected":yield ps(i.localStore,e,!0),ys(i,e,r);break;default:G()}})}function fP(n,e,t){return R(this,null,function*(){let r=_l(n);if(r.La){for(let i of e){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){N("SyncEngine","Adding an already active target "+i);continue}let s=yield VI(r.localStore,i),o=yield fs(r.localStore,s);yield kg(r,HI(s),o.targetId,!1,o.resumeToken),yl(r.remoteStore,o)}for(let i of t)r.Da.has(i)&&(yield ps(r.localStore,i,!1).then(()=>{gs(r.remoteStore,i),ys(r,i)}).catch(Er))}})}function _l(n){let e=j(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=WI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=oP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=eP.bind(null,e),e.Sa.h_=KR.bind(null,e.eventManager),e.Sa.ka=HR.bind(null,e.eventManager),e}function Vg(n){let e=j(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=tP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=nP.bind(null,e),e}function pP(n,e,t){let r=j(n);(function(s,o,c){return R(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(E,k){let x=j(E),D=Ue(k.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",$=>x.$r.getBundleMetadata($,k.id)).then($=>!!$&&$.createTime.compareTo(D)>=0)}(s.localStore,u))return yield o.close(),c._completeWith(function(E){return{taskState:"Success",documentsLoaded:E.totalDocuments,bytesLoaded:E.totalBytes,totalDocuments:E.totalDocuments,totalBytes:E.totalBytes}}(u)),Promise.resolve(new Set);c._updateProgress(zI(u));let l=new Bp(u,s.localStore,o.serializer),f=yield o.qa();for(;f;){let m=yield l._a(f);m&&c._updateProgress(m),f=yield o.qa()}let p=yield l.complete();return yield Ln(s,p.ca,void 0),yield function(E,k){let x=j(E);return x.persistence.runTransaction("Save bundle","readwrite",D=>x.$r.saveBundleMetadata(D,k))}(s.localStore,u),c._completeWith(p.progress),Promise.resolve(p.ua)}catch(u){return Ot("SyncEngine",`Loading bundle failed with ${u}`),c._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Ra=class{constructor(){this.synchronizeTabs=!1}initialize(e){return R(this,null,function*(){this.serializer=Oa(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return kI(this.persistence,new Wu,e.initialUser,this.serializer)}createPersistence(e){return new zu(Gu.Hr,this.serializer)}createSharedClientState(e){return new Xu}terminate(){return R(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var ol=class n extends Ra{constructor(e,t,r){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return R(this,null,function*(){yield Ah(n.prototype,this,"initialize").call(this,e),yield this.Qa.initialize(this,e),yield Vg(this.Qa.syncEngine),yield As(this.Qa.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return kI(this.persistence,new Wu,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new cp(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Cf(t,this.persistence);return new bf(e.asyncQueue,r)}createPersistence(e){let t=Ag(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Vt.withCacheSize(this.cacheSizeBytes):Vt.DEFAULT;return new Ip(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,LI(),_u(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Xu}},Wp=class n extends ol{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return R(this,null,function*(){yield Ah(n.prototype,this,"initialize").call(this,e);let t=this.Qa.syncEngine;this.sharedClientState instanceof ua&&(this.sharedClientState.syncEngine={Zs:uP.bind(null,t),Xs:dP.bind(null,t),eo:fP.bind(null,t),Bi:hP.bind(null,t),Ys:cP.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.fi(r=>R(this,null,function*(){yield lP(this.Qa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=LI();if(!ua.D(t))throw new M(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Ag(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ua(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Pa=class{initialize(e,t){return R(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>_E(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=sP.bind(null,this.syncEngine),yield Vp(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Lp}()}createDatastore(e){let t=Oa(e.databaseInfo.databaseId),r=function(s){return new Pp(s)}(e.databaseInfo);return function(s,o,c,u){return new xp(s,o,c,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,c){return new Np(r,i,s,o,c)}(this.localStore,this.datastore,e.asyncQueue,t=>_E(this.syncEngine,t,0),function(){return Ju.D()?new Ju:new Sp}())}createSyncEngine(e,t){return function(i,s,o,c,u,l,f){let p=new zp(i,s,o,c,u,l);return f&&(p.La=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return R(this,null,function*(){var e;yield function(r){return R(this,null,function*(){let i=j(r);N("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield Ts(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function wE(n,e=10240){let t=0;return{read(){return R(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return R(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var _s=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):Fe("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Kp=class{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new ze,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){return R(this,null,function*(){return this.metadata.promise})}qa(){return R(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return R(this,null,function*(){let e=yield this.za();if(e===null)return null;let t=this.Wa.decode(e),r=Number(t);isNaN(r)&&this.ja(`length string (${t}) is not valid number`);let i=yield this.Ha(r);return new jp(JSON.parse(i),e.length+r)})}Ja(){return this.buffer.findIndex(e=>e===123)}za(){return R(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let e=this.Ja();e<0&&this.ja("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Ha(e){return R(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let t=this.Wa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){return R(this,null,function*(){let e=yield this.Ua.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Hp=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return R(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new M(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return R(this,null,function*(){let o=j(i),c={documents:s.map(p=>Ea(o.serializer,p))},u=yield o.xo("BatchGetDocuments",o.serializer.databaseId,ue.emptyPath(),c,s.length),l=new Map;u.forEach(p=>{let m=vR(o.serializer,p);l.set(m.key.toString(),m)});let f=[];return s.forEach(p=>{let m=l.get(p.toString());H(!!m),f.push(m)}),f})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new vr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return R(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=U.fromPath(r);this.mutations.push(new ma(i,this.precondition(i)))}),yield function(r,i){return R(this,null,function*(){let s=j(r),o={writes:i.map(c=>Ia(s.serializer,c))};yield s.Co("Commit",s.serializer.databaseId,ue.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw G();t=X.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new M(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(X.min())?Ve.exists(!1):Ve.updateTime(t):Ve.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(X.min()))throw new M(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ve.updateTime(t)}return Ve.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Qp=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Yo=new Ca(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Yo.$o(()=>R(this,null,function*(){let e=new Hp(this.datastore),t=this.tu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.nu(i)}))}).catch(r=>{this.nu(r)})}))}tu(e){try{let t=this.updateFunction(e);return!xa(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!uI(t)}return!1}};var Xp=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=qe.UNAUTHENTICATED,this.clientId=Eu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>R(this,null,function*(){N("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(N("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new M(P.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ze;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>R(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Cs(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function vu(n,e){return R(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>R(this,null,function*(){r.isEqual(i)||(yield xI(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Jp(n,e){return R(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Og(n);N("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>mE(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>mE(e.remoteStore,i)),n._onlineComponents=e})}function QI(n){return n.name==="FirebaseError"?n.code===P.FAILED_PRECONDITION||n.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function Og(n){return R(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){N("FirestoreClient","Using user provided OfflineComponentProvider");try{yield vu(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!QI(t))throw t;Ot("Error using user provided cache. Falling back to memory cache: "+t),yield vu(n,new Ra)}}else N("FirestoreClient","Using default OfflineComponentProvider"),yield vu(n,new Ra);return n._offlineComponents})}function vl(n){return R(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(N("FirestoreClient","Using user provided OnlineComponentProvider"),yield Jp(n,n._uninitializedComponentsProvider._online)):(N("FirestoreClient","Using default OnlineComponentProvider"),yield Jp(n,new Pa))),n._onlineComponents})}function XI(n){return Og(n).then(e=>e.persistence)}function Fg(n){return Og(n).then(e=>e.localStore)}function JI(n){return vl(n).then(e=>e.remoteStore)}function Lg(n){return vl(n).then(e=>e.syncEngine)}function gP(n){return vl(n).then(e=>e.datastore)}function vs(n){return R(this,null,function*(){let e=yield vl(n),t=e.eventManager;return t.onListen=QR.bind(null,e.syncEngine),t.onUnlisten=JR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=XR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=YR.bind(null,e.syncEngine),t})}function mP(n){return n.asyncQueue.enqueue(()=>R(this,null,function*(){let e=yield XI(n),t=yield JI(n);return e.setNetworkEnabled(!0),function(i){let s=j(i);return s.M_.delete(0),Fa(s)}(t)}))}function yP(n){return n.asyncQueue.enqueue(()=>R(this,null,function*(){let e=yield XI(n),t=yield JI(n);return e.setNetworkEnabled(!1),function(i){return R(this,null,function*(){let s=j(i);s.M_.add(0),yield Ts(s),s.N_.set("Offline")})}(t)}))}function _P(n,e){let t=new ze;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s,o){return R(this,null,function*(){try{let c=yield function(l,f){let p=j(l);return p.persistence.runTransaction("read document","readonly",m=>p.localDocuments.getDocument(m,f))}(i,s);c.isFoundDocument()?o.resolve(c):c.isNoDocument()?o.resolve(null):o.reject(new M(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){let u=Cs(c,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield Fg(n),e,t)})),t.promise}function YI(n,e,t={}){let r=new ze;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(s,o,c,u,l){let f=new _s({next:m=>{o.enqueueAndForget(()=>Pg(s,p));let E=m.docs.has(c);!E&&m.fromCache?l.reject(new M(P.UNAVAILABLE,"Failed to get document because the client is offline.")):E&&m.fromCache&&u&&u.source==="server"?l.reject(new M(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(m)},error:m=>l.reject(m)}),p=new Sa(Is(c.path),f,{includeMetadataChanges:!0,ra:!0});return Rg(s,p)}(yield vs(n),n.asyncQueue,e,t,r)})),r.promise}function vP(n,e){let t=new ze;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s,o){return R(this,null,function*(){try{let c=yield Ku(i,s,!0),u=new sl(s,c.hs),l=u.da(c.documents),f=u.applyChanges(l,!1);o.resolve(f.snapshot)}catch(c){let u=Cs(c,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield Fg(n),e,t)})),t.promise}function ZI(n,e,t={}){let r=new ze;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(s,o,c,u,l){let f=new _s({next:m=>{o.enqueueAndForget(()=>Pg(s,p)),m.fromCache&&u.source==="server"?l.reject(new M(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(m)},error:m=>l.reject(m)}),p=new Sa(c,f,{includeMetadataChanges:!0,ra:!0});return Rg(s,p)}(yield vs(n),n.asyncQueue,e,t,r)})),r.promise}function wP(n,e){let t=new _s(e);return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s){j(i).z_.add(s),s.next()}(yield vs(n),t)})),()=>{t.$a(),n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s){j(i).z_.delete(s)}(yield vs(n),t)}))}}function EP(n,e,t,r){let i=function(o,c){let u;return u=typeof o=="string"?hI().encode(o):o,function(f,p){return new Kp(f,p)}(function(f,p){if(f instanceof Uint8Array)return wE(f,p);if(f instanceof ArrayBuffer)return wE(new Uint8Array(f),p);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),c)}(t,Oa(e));n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){pP(yield Lg(n),i,r)}))}function IP(n,e){return n.asyncQueue.enqueue(()=>R(this,null,function*(){return function(r,i){let s=j(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield Fg(n),e)}))}function e0(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var EE=new Map;function Ug(n,e,t){if(!t)throw new M(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function jg(n,e,t,r){if(e===!0&&r===!0)throw new M(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function IE(n){if(!U.isDocumentKey(n))throw new M(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function TE(n){if(U.isDocumentKey(n))throw new M(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function wl(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":G()}function le(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new M(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=wl(n);throw new M(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function t0(n,e){if(e<=0)throw new M(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var al=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new M(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new M(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}jg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=e0((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new M(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new M(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new M(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},ti=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new al({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new M(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new M(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new al(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new gf;switch(r.type){case"firstParty":return new vf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new M(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=EE.get(t);r&&(N("ComponentProvider","Removing Datastore"),EE.delete(t),r.terminate())}(this),Promise.resolve()}};function El(n,e,t,r={}){var i;let s=(n=le(n,ti))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Ot("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let c,u;if(typeof r.mockUserToken=="string")c=r.mockUserToken,u=qe.MOCK_USER;else{c=Ac(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let l=r.mockUserToken.sub||r.mockUserToken.user_id;if(!l)throw new M(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new qe(l)}n._authCredentials=new mf(new wu(c,u))}}var rt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Ae=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},pn=class n extends rt{constructor(e,t,r){super(e,t,Is(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ae(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Il(n,e,...t){if(n=Ce(n),Ug("collection","path",e),n instanceof ti){let r=ue.fromString(e,...t);return TE(r),new pn(n,null,r)}{if(!(n instanceof Ae||n instanceof pn))throw new M(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ue.fromString(e,...t));return TE(r),new pn(n.firestore,null,r)}}function Bg(n,e){if(n=le(n,ti),Ug("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new M(P.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new rt(n,null,function(r){return new Kt(ue.emptyPath(),r)}(e))}function Ss(n,e,...t){if(n=Ce(n),arguments.length===1&&(e=Eu.newId()),Ug("doc","path",e),n instanceof ti){let r=ue.fromString(e,...t);return IE(r),new Ae(n,null,new U(r))}{if(!(n instanceof Ae||n instanceof pn))throw new M(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ue.fromString(e,...t));return IE(r),new Ae(n.firestore,n instanceof pn?n.converter:null,new U(r))}}function Tl(n,e){return n=Ce(n),e=Ce(e),(n instanceof Ae||n instanceof pn)&&(e instanceof Ae||e instanceof pn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Al(n,e){return n=Ce(n),e=Ce(e),n instanceof rt&&e instanceof rt&&n.firestore===e.firestore&&Na(n._query,e._query)&&n.converter===e.converter}var Yp=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new Ca(this,"async_queue_retry"),this.hu=()=>{let t=_u();t&&N("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};let e=_u();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let t=_u();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let t=new ze;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){return R(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Yo.reset()}catch(e){if(!Ir(e))throw e;N("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}})}Iu(e){let t=this.iu.then(()=>(this.uu=!0,e().catch(r=>{this.au=r,this.uu=!1;let i=function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),c}(r);throw Fe("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.uu=!1,r))));return this.iu=t,t}enqueueAfterDelay(e,t,r){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);let i=Op.createAndSchedule(this,e,t,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&G()}verifyOperationInProgress(){}du(){return R(this,null,function*(){let e;do e=this.iu,yield e;while(e!==this.iu)})}Au(e){for(let t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this._u)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let t=this._u.indexOf(e);this._u.splice(t,1)}};function Zp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var eg=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new ze,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var n0=-1,Pe=class extends ti{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new Yp}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||i0(this),this._firestoreClient.terminate()}};function r0(n,e){let t=typeof n=="object"?n:Ri(),r=typeof n=="string"?n:e||"(default)",i=Eo(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Tc("firestore");s&&El(i,...s)}return i}function Xe(n){return n._firestoreClient||i0(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function i0(n){var e,t,r;let i=n._freezeSettings(),s=function(c,u,l,f){return new Sf(c,u,l,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,e0(f.experimentalLongPollingOptions),f.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Xp(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function $g(n,e){o0(n=le(n,Pe));let t=Xe(n);if(t._uninitializedComponentsProvider)throw new M(P.FAILED_PRECONDITION,"SDK cache is already specified.");Ot("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Pa;return s0(t,i,new ol(i,r.cacheSizeBytes,e?.forceOwnership))}function qg(n){o0(n=le(n,Pe));let e=Xe(n);if(e._uninitializedComponentsProvider)throw new M(P.FAILED_PRECONDITION,"SDK cache is already specified.");Ot("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Pa;return s0(e,r,new Wp(r,t.cacheSizeBytes))}function s0(n,e,t){let r=new ze;return n.asyncQueue.enqueue(()=>R(this,null,function*(){try{yield vu(n,t),yield Jp(n,e),r.resolve()}catch(i){let s=i;if(!QI(s))throw s;Ot("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function zg(n){if(n._initialized&&!n._terminated)throw new M(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new ze;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>R(this,null,function*(){try{yield function(r){return R(this,null,function*(){if(!dr.D())return Promise.resolve();let i=r+"main";yield dr.delete(i)})}(Ag(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Gg(n){return function(t){let r=new ze;return t.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return rP(yield Lg(t),r)})),r.promise}(Xe(n=le(n,Pe)))}function Wg(n){return mP(Xe(n=le(n,Pe)))}function Kg(n){return yP(Xe(n=le(n,Pe)))}function Hg(n,e){let t=Xe(n=le(n,Pe)),r=new eg;return EP(t,n._databaseId,e,r),r}function Qg(n,e){return IP(Xe(n=le(n,Pe)),e).then(t=>t?new rt(n,null,t.query):null)}function o0(n){if(n._initialized||n._terminated)throw new M(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var _n=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ze.fromBase64String(e))}catch(t){throw new M(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ze.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Qt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new M(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var On=class{constructor(e){this._methodName=e}};var ni=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new M(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new M(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ie(this._lat,e._lat)||ie(this._long,e._long)}};var TP=/^__.*__$/,tg=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ht(e,this.data,this.fieldMask,t,this.fieldTransforms):new _r(e,this.data,t,this.fieldTransforms)}},cl=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ht(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function a0(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G()}}var ul=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return ll(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(e.length===0)throw this.Du("Document fields must not be empty");if(a0(this.fu)&&TP.test(e))throw this.Du('Document fields cannot begin and end with "__"')}},ng=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Oa(e)}Fu(e,t,r,i=!1){return new ul({fu:e,methodName:t,vu:r,path:Le.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function oi(n){let e=n._freezeSettings(),t=Oa(n._databaseId);return new ng(n._databaseId,!!e.ignoreUndefinedProperties,t)}function bl(n,e,t,r,i,s={}){let o=n.Fu(s.merge||s.mergeFields?2:0,e,t,i);Yg("Data must be an object, but it was:",o,r);let c=l0(r,o),u,l;if(s.merge)u=new Pt(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let p of s.mergeFields){let m=ag(e,p,t);if(!o.contains(m))throw new M(P.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);d0(f,m)||f.push(m)}u=new Pt(f),l=o.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,l=o.fieldTransforms;return new tg(new lt(c),u,l)}var Da=class n extends On{_toFieldTransform(e){if(e.fu!==2)throw e.fu===1?e.Du(`${this._methodName}() can only appear at the top level of your update data`):e.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function c0(n,e,t){return new ul({fu:3,vu:e.settings.vu,methodName:n._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var rg=class n extends On{_toFieldTransform(e){return new Yr(e.path,new mr)}isEqual(e){return e instanceof n}},ig=class n extends On{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=c0(this,e,!0),r=this.Mu.map(s=>ai(s,t)),i=new Nn(r);return new Yr(e.path,i)}isEqual(e){return e instanceof n&&Wh(this.Mu,e.Mu)}},sg=class n extends On{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=c0(this,e,!0),r=this.Mu.map(s=>ai(s,t)),i=new Vn(r);return new Yr(e.path,i)}isEqual(e){return e instanceof n&&Wh(this.Mu,e.Mu)}},og=class n extends On{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){let t=new yr(e.serializer,nI(e.serializer,this.xu));return new Yr(e.path,t)}isEqual(e){return e instanceof n&&this.xu===e.xu}};function Xg(n,e,t,r){let i=n.Fu(1,e,t);Yg("Data must be an object, but it was:",i,r);let s=[],o=lt.empty();si(r,(u,l)=>{let f=Zg(e,u,t);l=Ce(l);let p=i.Su(f);if(l instanceof Da)s.push(f);else{let m=ai(l,p);m!=null&&(s.push(f),o.set(f,m))}});let c=new Pt(s);return new cl(o,c,i.fieldTransforms)}function Jg(n,e,t,r,i,s){let o=n.Fu(1,e,t),c=[ag(e,r,t)],u=[i];if(s.length%2!=0)throw new M(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)c.push(ag(e,s[m])),u.push(s[m+1]);let l=[],f=lt.empty();for(let m=c.length-1;m>=0;--m)if(!d0(l,c[m])){let E=c[m],k=u[m];k=Ce(k);let x=o.Su(E);if(k instanceof Da)l.push(E);else{let D=ai(k,x);D!=null&&(l.push(E),f.set(E,D))}}let p=new Pt(l);return new cl(f,p,o.fieldTransforms)}function u0(n,e,t,r=!1){return ai(t,n.Fu(r?4:3,e))}function ai(n,e){if(h0(n=Ce(n)))return Yg("Unsupported field value:",e,n),l0(n,e);if(n instanceof On)return function(r,i){if(!a0(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&e.fu!==4)throw e.Du("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let c of r){let u=ai(c,i.bu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=Ce(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return nI(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=De.fromDate(r);return{timestampValue:ls(i.serializer,s)}}if(r instanceof De){let s=new De(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ls(i.serializer,s)}}if(r instanceof ni)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof _n)return{bytesValue:dI(i.serializer,r._byteString)};if(r instanceof Ae){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Eg(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${wl(r)}`)}(n,e)}function l0(n,e){let t={};return LE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):si(n,(r,i)=>{let s=ai(i,e.pu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function h0(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof De||n instanceof ni||n instanceof _n||n instanceof Ae||n instanceof On)}function Yg(n,e,t){if(!h0(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=wl(t);throw r==="an object"?e.Du(n+" a custom object"):e.Du(n+" "+r)}}function ag(n,e,t){if((e=Ce(e))instanceof Qt)return e._internalPath;if(typeof e=="string")return Zg(n,e);throw ll("Field path arguments must be of type string or ",n,!1,void 0,t)}var AP=new RegExp("[~\\*/\\[\\]]");function Zg(n,e,t){if(e.search(AP)>=0)throw ll(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Qt(...e.split("."))._internalPath}catch{throw ll(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ll(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new M(P.INVALID_ARGUMENT,c+n+u)}function d0(n,e){return n.some(t=>t.isEqual(e))}var ri=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ae(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new cg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Cl("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},cg=class extends ri{data(){return super.data()}};function Cl(n,e){return typeof e=="string"?Zg(n,e):e instanceof Qt?e._internalPath:e._delegate._internalPath}function f0(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new M(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ka=class{},ii=class extends ka{};function vn(n,e,...t){let r=[];e instanceof ka&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof ug).length,c=s.filter(u=>u instanceof hl).length;if(o>1||o>0&&c>0)throw new M(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var hl=class n extends ii{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return g0(e._query,t),new rt(e.firestore,e.converter,jf(e._query,t))}_parse(e){let t=oi(e.firestore);return function(s,o,c,u,l,f,p){let m;if(l.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new M(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){bE(p,f);let E=[];for(let k of p)E.push(AE(u,s,k));m={arrayValue:{values:E}}}else m=AE(u,s,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||bE(p,f),m=u0(c,o,p,f==="in"||f==="not-in");return ae.create(l,f,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function em(n,e,t){let r=e,i=Cl("where",n);return hl._create(i,r,t)}var ug=class n extends ka{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:pe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,c=s.getFlattenedFilters();for(let u of c)g0(o,u),o=jf(o,u)}(e._query,t),new rt(e.firestore,e.converter,jf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var lg=class n extends ii{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new M(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new M(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Xr(s,o)}(e._query,this._field,this._direction);return new rt(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Kt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function tm(n,e="asc"){let t=e,r=Cl("orderBy",n);return lg._create(r,t)}var dl=class n extends ii{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new rt(e.firestore,e.converter,ku(e._query,this._limit,this._limitType))}};function nm(n){return t0("limit",n),dl._create("limit",n,"F")}function rm(n){return t0("limitToLast",n),dl._create("limitToLast",n,"L")}var fl=class n extends ii{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=p0(e,this.type,this._docOrFields,this._inclusive);return new rt(e.firestore,e.converter,function(i,s){return new Kt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function im(...n){return fl._create("startAt",n,!0)}function sm(...n){return fl._create("startAfter",n,!1)}var pl=class n extends ii{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=p0(e,this.type,this._docOrFields,this._inclusive);return new rt(e.firestore,e.converter,function(i,s){return new Kt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function om(...n){return pl._create("endBefore",n,!1)}function am(...n){return pl._create("endAt",n,!0)}function p0(n,e,t,r){if(t[0]=Ce(t[0]),t[0]instanceof ri)return function(s,o,c,u,l){if(!u)throw new M(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let p of ns(s))if(p.field.isKeyField())f.push(Qr(o,u.key));else{let m=u.data.field(p.field);if(ml(m))throw new M(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let E=p.field.canonicalString();throw new M(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${E}' (used as the orderBy) does not exist.`)}f.push(m)}return new mn(f,l)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=oi(n.firestore);return function(o,c,u,l,f,p){let m=o.explicitOrderBy;if(f.length>m.length)throw new M(P.INVALID_ARGUMENT,`Too many arguments provided to ${l}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let E=[];for(let k=0;k<f.length;k++){let x=f[k];if(m[k].field.isKeyField()){if(typeof x!="string")throw new M(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${l}(), but got a ${typeof x}`);if(!vg(o)&&x.indexOf("/")!==-1)throw new M(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${l}() must be a plain document ID, but '${x}' contains a slash.`);let D=o.path.child(ue.fromString(x));if(!U.isDocumentKey(D))throw new M(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${l}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);let $=new U(D);E.push(Qr(c,$))}else{let D=u0(u,l,x);E.push(D)}}return new mn(E,p)}(n._query,n.firestore._databaseId,i,e,t,r)}}function AE(n,e,t){if(typeof(t=Ce(t))=="string"){if(t==="")throw new M(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!vg(e)&&t.indexOf("/")!==-1)throw new M(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ue.fromString(t));if(!U.isDocumentKey(r))throw new M(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Qr(n,new U(r))}if(t instanceof Ae)return Qr(n,t._key);throw new M(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${wl(t)}.`)}function bE(n,e){if(!Array.isArray(n)||n.length===0)throw new M(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function g0(n,e){let t=function(i,s){for(let o of i)for(let c of o.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new M(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new M(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var ws=class{convertValue(e,t="none"){switch(Hr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ne(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(fr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw G()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return si(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new ni(Ne(e.latitude),Ne(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=yg(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(fa(e));default:return null}}convertTimestamp(e){let t=Mn(e);return new De(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ue.fromString(e);H(TI(r));let i=new pr(r.get(1),r.get(3)),s=new U(r.popFirst(5));return i.isEqual(t)||Fe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Sl(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var hg=class extends ws{constructor(e){super(),this.firestore=e}convertBytes(e){return new _n(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ae(this.firestore,null,t)}};var xn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Lt=class extends ri{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new lr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Cl("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},lr=class extends Lt{data(e={}){return super.data(e)}},Xt=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new xn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new lr(this._firestore,this._userDataWriter,r.key,r,new xn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new M(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(c=>{let u=new lr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new xn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let u=new lr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new xn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),l=-1,f=-1;return c.type!==0&&(l=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:bP(c.type),doc:u,oldIndex:l,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function bP(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return G()}}function Rl(n,e){return n instanceof Lt&&e instanceof Lt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Xt&&e instanceof Xt&&n._firestore===e._firestore&&Al(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function cm(n){n=le(n,Ae);let e=le(n.firestore,Pe);return YI(Xe(e),n._key).then(t=>ym(e,n,t))}var Fn=class extends ws{constructor(e){super(),this.firestore=e}convertBytes(e){return new _n(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ae(this.firestore,null,t)}};function um(n){n=le(n,Ae);let e=le(n.firestore,Pe),t=Xe(e),r=new Fn(e);return _P(t,n._key).then(i=>new Lt(e,r,n._key,i,new xn(i!==null&&i.hasLocalMutations,!0),n.converter))}function lm(n){n=le(n,Ae);let e=le(n.firestore,Pe);return YI(Xe(e),n._key,{source:"server"}).then(t=>ym(e,n,t))}function hm(n){n=le(n,rt);let e=le(n.firestore,Pe),t=Xe(e),r=new Fn(e);return f0(n._query),ZI(t,n._query).then(i=>new Xt(e,r,n,i))}function dm(n){n=le(n,rt);let e=le(n.firestore,Pe),t=Xe(e),r=new Fn(e);return vP(t,n._query).then(i=>new Xt(e,r,n,i))}function fm(n){n=le(n,rt);let e=le(n.firestore,Pe),t=Xe(e),r=new Fn(e);return ZI(t,n._query,{source:"server"}).then(i=>new Xt(e,r,n,i))}function Pl(n,e,t){n=le(n,Ae);let r=le(n.firestore,Pe),i=Sl(n.converter,e,t);return Rs(r,[bl(oi(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ve.none())])}function Dl(n,e,t,...r){n=le(n,Ae);let i=le(n.firestore,Pe),s=oi(i),o;return o=typeof(e=Ce(e))=="string"||e instanceof Qt?Jg(s,"updateDoc",n._key,e,t,r):Xg(s,"updateDoc",n._key,e),Rs(i,[o.toMutation(n._key,Ve.exists(!0))])}function pm(n){return Rs(le(n.firestore,Pe),[new vr(n._key,Ve.none())])}function gm(n,e){let t=le(n.firestore,Pe),r=Ss(n),i=Sl(n.converter,e);return Rs(t,[bl(oi(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Ve.exists(!1))]).then(()=>r)}function kl(n,...e){var t,r,i;n=Ce(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Zp(e[o])||(s=e[o],o++);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Zp(e[o])){let p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(r=p.error)===null||r===void 0?void 0:r.bind(p),e[o+2]=(i=p.complete)===null||i===void 0?void 0:i.bind(p)}let u,l,f;if(n instanceof Ae)l=le(n.firestore,Pe),f=Is(n._key.path),u={next:p=>{e[o]&&e[o](ym(l,n,p))},error:e[o+1],complete:e[o+2]};else{let p=le(n,rt);l=le(p.firestore,Pe),f=p._query;let m=new Fn(l);u={next:E=>{e[o]&&e[o](new Xt(l,m,p,E))},error:e[o+1],complete:e[o+2]},f0(n._query)}return function(m,E,k,x){let D=new _s(x),$=new Sa(E,D,k);return m.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return Rg(yield vs(m),$)})),()=>{D.$a(),m.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return Pg(yield vs(m),$)}))}}(Xe(l),f,c,u)}function mm(n,e){return wP(Xe(n=le(n,Pe)),Zp(e)?e:{next:e})}function Rs(n,e){return function(r,i){let s=new ze;return r.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return ZR(yield Lg(r),i,s)})),s.promise}(Xe(n),e)}function ym(n,e,t){let r=t.docs.get(e._key),i=new Fn(n);return new Lt(n,i,e._key,r,new xn(t.hasPendingWrites,t.fromCache),e.converter)}var CP={maxAttempts:5};var gl=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=oi(e)}set(e,t,r){this._verifyNotCommitted();let i=cr(e,this._firestore),s=Sl(i.converter,t,r),o=bl(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Ve.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=cr(e,this._firestore),o;return o=typeof(t=Ce(t))=="string"||t instanceof Qt?Jg(this._dataReader,"WriteBatch.update",s._key,t,r,i):Xg(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Ve.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=cr(e,this._firestore);return this._mutations=this._mutations.concat(new vr(t._key,Ve.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new M(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function cr(n,e){if((n=Ce(n)).firestore!==e)throw new M(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var dg=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=oi(t)}get(t){let r=cr(t,this._firestore),i=new hg(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return G();let o=s[0];if(o.isFoundDocument())return new ri(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new ri(this._firestore,i,r._key,null,r.converter);throw G()})}set(t,r,i){let s=cr(t,this._firestore),o=Sl(s.converter,r,i),c=bl(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,c),this}update(t,r,i,...s){let o=cr(t,this._firestore),c;return c=typeof(r=Ce(r))=="string"||r instanceof Qt?Jg(this._dataReader,"Transaction.update",o._key,r,i,s):Xg(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,c),this}delete(t){let r=cr(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=cr(e,this._firestore),r=new Fn(this._firestore);return super.get(e).then(i=>new Lt(this._firestore,r,t._key,i._document,new xn(!1,!1),t.converter))}};function _m(n,e,t){n=le(n,Pe);let r=Object.assign(Object.assign({},CP),t);return function(s){if(s.maxAttempts<1)throw new M(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,c){let u=new ze;return s.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){let l=yield gP(s);new Qp(s.asyncQueue,l,c,o,u).Xa()})),u.promise}(Xe(n),i=>e(new dg(n,i)),r)}function vm(){return new Da("deleteField")}function wm(){return new rg("serverTimestamp")}function Em(...n){return new ig("arrayUnion",n)}function Im(...n){return new sg("arrayRemove",n)}function Tm(n){return new og("increment",n)}(function(e,t=!0){(function(i){Es=i})(Rc),Vr(new Pn("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),c=new Pe(new yf(r.getProvider("auth-internal")),new Ef(r.getProvider("app-check-internal")),function(l,f){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new M(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pr(l.options.projectId,f)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),Je(Cw,"4.6.2",e),Je(Cw,"4.6.2","esm2017")})();var SP="@firebase/firestore-compat",RP="0.3.31";function Pm(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new M("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function m0(){if(typeof Uint8Array>"u")throw new M("unimplemented","Uint8Arrays are not available in this environment.")}function y0(){if(!UE())throw new M("unimplemented","Blobs are unavailable in Firestore in this environment.")}var xl=class n{constructor(e){this._delegate=e}static fromBase64String(e){return y0(),new n(_n.fromBase64String(e))}static fromUint8Array(e){return m0(),new n(_n.fromUint8Array(e))}toBase64(){return y0(),this._delegate.toBase64()}toUint8Array(){return m0(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Am(n){return PP(n,["next","error","complete"])}function PP(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var bm=class{enableIndexedDbPersistence(e,t){return $g(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return qg(e._delegate)}clearIndexedDbPersistence(e){return zg(e._delegate)}},Ml=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof pr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ot("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){El(this._delegate,e,t,r)}enableNetwork(){return Wg(this._delegate)}disableNetwork(){return Kg(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,jg("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Gg(this._delegate)}onSnapshotsInSync(e){return mm(this._delegate,e)}get app(){if(!this._appCompat)throw new M("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ks(this,Il(this._delegate,e))}catch(t){throw mt(t,"collection()","Firestore.collection()")}}doc(e){try{return new wn(this,Ss(this._delegate,e))}catch(t){throw mt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new hi(this,Bg(this._delegate,e))}catch(t){throw mt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return _m(this._delegate,t=>e(new Nl(this,t)))}batch(){return Xe(this._delegate),new Vl(new gl(this._delegate,e=>Rs(this._delegate,e)))}loadBundle(e){return Hg(this._delegate,e)}namedQuery(e){return Qg(this._delegate,e).then(t=>t?new hi(this,t):null)}},Ps=class extends ws{constructor(e){super(),this.firestore=e}convertBytes(e){return new xl(new _n(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return wn.forKey(t,this.firestore,null)}};function DP(n){fg(n)}var Nl=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ps(e)}get(e){let t=ci(e);return this._delegate.get(t).then(r=>new ui(this._firestore,new Lt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=ci(e);return r?(Pm("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=ci(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=ci(e);return this._delegate.delete(t),this}},Vl=class{constructor(e){this._delegate=e}set(e,t,r){let i=ci(e);return r?(Pm("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=ci(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=ci(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Ds=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new lr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new li(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Ps(e),t),i.set(t,s)),s}};Ds.INSTANCES=new WeakMap;var wn=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ps(e)}static forPath(e,t,r){if(e.length%2!==0)throw new M("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new Ae(t._delegate,r,new U(e)))}static forKey(e,t,r){return new n(t,new Ae(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new ks(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ks(this.firestore,Il(this._delegate,e))}catch(t){throw mt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Ce(e),e instanceof Ae?Tl(this._delegate,e):!1}set(e,t){t=Pm("DocumentReference.set",t);try{return t?Pl(this._delegate,e,t):Pl(this._delegate,e)}catch(r){throw mt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Dl(this._delegate,e):Dl(this._delegate,e,t,...r)}catch(i){throw mt(i,"updateDoc()","DocumentReference.update()")}}delete(){return pm(this._delegate)}onSnapshot(...e){let t=_0(e),r=v0(e,i=>new ui(this.firestore,new Lt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return kl(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=um(this._delegate):e?.source==="server"?t=lm(this._delegate):t=cm(this._delegate),t.then(r=>new ui(this.firestore,new Lt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ds.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function mt(n,e,t){return n.message=n.message.replace(e,t),n}function _0(n){for(let e of n)if(typeof e=="object"&&!Am(e))return e;return{}}function v0(n,e){var t,r;let i;return Am(n[0])?i=n[0]:Am(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var ui=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new wn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Rl(this._delegate,e._delegate)}},li=class extends ui{data(e){let t=this._delegate.data(e);return this._delegate._converter||CE(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},hi=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ps(e)}where(e,t,r){try{return new n(this.firestore,vn(this._delegate,em(e,t,r)))}catch(i){throw mt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,vn(this._delegate,tm(e,t)))}catch(r){throw mt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,vn(this._delegate,nm(e)))}catch(t){throw mt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,vn(this._delegate,rm(e)))}catch(t){throw mt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,vn(this._delegate,im(...e)))}catch(t){throw mt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,vn(this._delegate,sm(...e)))}catch(t){throw mt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,vn(this._delegate,om(...e)))}catch(t){throw mt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,vn(this._delegate,am(...e)))}catch(t){throw mt(t,"endAt()","Query.endAt()")}}isEqual(e){return Al(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=dm(this._delegate):e?.source==="server"?t=fm(this._delegate):t=hm(this._delegate),t.then(r=>new La(this.firestore,new Xt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=_0(e),r=v0(e,i=>new La(this.firestore,new Xt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return kl(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ds.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Cm=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new li(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},La=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new hi(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new li(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Cm(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new li(this._firestore,r))})}isEqual(e){return Rl(this._delegate,e._delegate)}},ks=class n extends hi{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new wn(this.firestore,e):null}doc(e){try{return e===void 0?new wn(this.firestore,Ss(this._delegate)):new wn(this.firestore,Ss(this._delegate,e))}catch(t){throw mt(t,"doc()","CollectionReference.doc()")}}add(e){return gm(this._delegate,e).then(t=>new wn(this.firestore,t))}isEqual(e){return Tl(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ds.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ci(n){return le(n,Ae)}var Sm=class n{constructor(...e){this._delegate=new Qt(...e)}static documentId(){return new n(Le.keyField().canonicalString())}isEqual(e){return e=Ce(e),e instanceof Qt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Rm=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=wm();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=vm();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=Em(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=Im(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=Tm(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var kP={Firestore:Ml,GeoPoint:ni,Timestamp:De,Blob:xl,Transaction:Nl,WriteBatch:Vl,DocumentReference:wn,DocumentSnapshot:ui,Query:hi,QueryDocumentSnapshot:li,QuerySnapshot:La,CollectionReference:ks,FieldPath:Sm,FieldValue:Rm,setLogLevel:DP,CACHE_SIZE_UNLIMITED:n0};function xP(n,e){n.INTERNAL.registerComponent(new Pn("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},kP)))}function MP(n){xP(n,(e,t)=>new Ml(e,t,new bm)),n.registerVersion(SP,RP)}MP(At);function NP(n,e=cc){return new Dt(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function w0(n,e){return NP(n,e)}function VP(n,e){return w0(n,e).pipe(Ii(void 0),lc(),Y(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function xm(n,e){return w0(n,e).pipe(Y(t=>({payload:t,type:"query"})))}var Ol=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=T0(r,t);return new Ll(i,s,this.afs)}snapshotChanges(){return VP(this.ref,this.afs.schedulers.outsideAngular).pipe(ft)}valueChanges(e={}){return this.snapshotChanges().pipe(Y(({payload:t})=>e.idField?ye(z({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return ge(this.ref.get(e)).pipe(ft)}};function Fl(n,e){return xm(n,e).pipe(Ii(void 0),lc(),Y(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(c=>({type:c.type,payload:c}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((c,u)=>{let l=s.find(p=>p.doc.ref.isEqual(c.ref)),f=r?.payload.docs.find(p=>p.ref.isEqual(c.ref));l&&JSON.stringify(l.doc.metadata)===JSON.stringify(c.metadata)||!l&&f&&JSON.stringify(f.metadata)===JSON.stringify(c.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:c}})}),o}))}function E0(n,e,t){return Fl(n,t).pipe(Ei((r,i)=>OP(r,i.map(s=>s.payload),e),[]),h_(),Y(r=>r.map(i=>({type:i.type,payload:i}))))}function OP(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=FP(n,r))}),n}function Dm(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function FP(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return Dm(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Dm(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Dm(n,e.oldIndex,1);break}return n}function I0(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Ll=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Fl(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Y(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Ii(void 0),lc(),It(([r,i])=>i.length>0||!r),Y(([,r])=>r),ft)}auditTrail(e){return this.stateChanges(e).pipe(Ei((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=I0(e);return E0(this.query,t,this.afs.schedulers.outsideAngular).pipe(ft)}valueChanges(e={}){return xm(this.query,this.afs.schedulers.outsideAngular).pipe(Y(t=>t.payload.docs.map(r=>e.idField?ye(z({},r.data()),{[e.idField]:r.id}):r.data())),ft)}get(e){return ge(this.query.get(e)).pipe(ft)}add(e){return this.ref.add(e)}doc(e){return new Ol(this.ref.doc(e),this.afs)}},km=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Fl(this.query,this.afs.schedulers.outsideAngular).pipe(ft):Fl(this.query,this.afs.schedulers.outsideAngular).pipe(Y(t=>t.filter(r=>e.indexOf(r.type)>-1)),It(t=>t.length>0),ft)}auditTrail(e){return this.stateChanges(e).pipe(Ei((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=I0(e);return E0(this.query,t,this.afs.schedulers.outsideAngular).pipe(ft)}valueChanges(e={}){return xm(this.query,this.afs.schedulers.outsideAngular).pipe(Y(r=>r.payload.docs.map(i=>e.idField?z({[e.idField]:i.id},i.data()):i.data())),ft)}get(e){return ge(this.query.get(e)).pipe(ft)}},LP=new re("angularfire2.enableFirestorePersistence"),UP=new re("angularfire2.firestore.persistenceSettings"),jP=new re("angularfire2.firestore.settings"),BP=new re("angularfire2.firestore.use-emulator");function T0(n,e=t=>t){return{query:e(n),ref:n}}var Ar=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,c,u,l,f,p,m,E,k,x,D,$,K){this.schedulers=u;let V=Xo(t,c,r),W=f;p&&nf(V,c,m,k,x,D,E,$),[this.firestore,this.persistenceEnabled$]=au(`${V.name}.firestore`,"AngularFirestore",V.name,()=>{let te=c.runOutsideAngular(()=>V.firestore());if(s&&te.settings(s),W&&te.useEmulator(...W),i&&!Rn(o)){let ne=()=>{try{return ge(te.enablePersistence(l||void 0).then(()=>!0,()=>!1))}catch(w){return typeof console<"u"&&console.warn(w),J(!1)}};return[te,c.runOutsideAngular(ne)]}else return[te,J(!1)]},[s,W,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=T0(i,r),c=this.schedulers.ngZone.run(()=>s);return new Ll(c,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new km(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Ol(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(O($i),O(qi,8),O(LP,8),O(jP,8),O(Tt),O(de),O(cn),O(UP,8),O(BP,8),O(un,8),O(Xd,8),O(Jd,8),O(Yd,8),O(Zd,8),O(ef,8),O(tf,8),O(St,8))};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var jl=(()=>{let e=class e{constructor(r){this.firestore=r}getPackages(){return this.firestore.collection("packages").valueChanges({idField:"id"})}getPackage(r){return this.firestore.collection("packages").doc(r).valueChanges()}};e.\u0275fac=function(i){return new(i||e)(O(Ar))},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var vt=(()=>{let e=class e{constructor(r,i){this.afAuth=r,this.firestore=i}register(r,i,s,o,c){return ge(this.afAuth.createUserWithEmailAndPassword(r,i).then(u=>this.firestore.collection("users").doc(u.user?.uid).set({name:s,phone:o,address:c,email:r})))}login(r,i){return ge(this.afAuth.signInWithEmailAndPassword(r,i))}logout(){return ge(this.afAuth.signOut())}get user$(){return this.afAuth.authState}};e.\u0275fac=function(i){return new(i||e)(O(un),O(Ar))},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function $P(n,e){if(n&1&&(q(0,"div",3),B(1),L()),n&2){let t=Qe();Ie(),tn(t.errorMessage)}}function qP(n,e){if(n&1){let t=Sn();q(0,"div",5)(1,"h3"),B(2),L(),q(3,"p")(4,"strong"),B(5,"Description:"),L(),B(6),L(),q(7,"button",6),_e("click",function(){let i=jt(t).$implicit,s=Qe(2);return Bt(s.viewDetails(i.id))}),B(8,"View Details"),L(),q(9,"button",6),_e("click",function(){let i=jt(t).$implicit,s=Qe(2);return Bt(s.purchasePackage(i.id))}),B(10,"Purchase"),L()()}if(n&2){let t=e.$implicit;Ie(2),tn(t.name),Ie(4),Xn(" ",t.description,"")}}function zP(n,e){if(n&1&&(q(0,"div"),$t(1,qP,11,2,"div",4),L()),n&2){let t=Qe();Ie(),je("ngForOf",t.packages)}}function GP(n,e){n&1&&(q(0,"p"),B(1,"Loading packages..."),L())}var b0=(()=>{let e=class e{constructor(r,i,s){this.packageService=r,this.router=i,this.authService=s,this.packages=[],this.errorMessage="",this.isLoggedIn=!1}ngOnInit(){this.authService.user$.subscribe(r=>{this.isLoggedIn=!!r}),this.packageService.getPackages().subscribe({next:r=>{console.log("Fetched packages:",r),this.packages=r},error:r=>{console.error("Error fetching packages",r),this.errorMessage=r.message}})}viewDetails(r){r?this.isLoggedIn?this.router.navigate(["/package",r]):this.router.navigate(["/login"]):console.error("Package ID is undefined")}purchasePackage(r){r?this.isLoggedIn?this.router.navigate(["/confirm-purchase",r]):this.router.navigate(["/login"]):console.error("Package ID is undefined")}};e.\u0275fac=function(i){return new(i||e)(Z(jl),Z(Te),Z(vt))},e.\u0275cmp=Me({type:e,selectors:[["app-package-list"]],decls:4,vars:3,consts:[["loading",""],["class","error",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"error"],["class","package-item",4,"ngFor","ngForOf"],[1,"package-item"],[3,"click"]],template:function(i,s){if(i&1&&$t(0,$P,2,1,"div",1)(1,zP,2,1,"div",2)(2,GP,2,0,"ng-template",null,0,R_),i&2){let o=A_(3);je("ngIf",s.errorMessage),Ie(),je("ngIf",s.packages.length>0)("ngIfElse",o)}},dependencies:[$_,nn],styles:[".package-item[_ngcontent-%COMP%]{padding:1rem;margin:1rem 0;background-color:#f9f9f9;border-radius:10px;box-shadow:0 0 10px #0000001a}h3[_ngcontent-%COMP%]{color:#333}p[_ngcontent-%COMP%]{color:#555;font-size:1rem;margin-bottom:.5rem}p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333}button[_ngcontent-%COMP%]{display:inline-block;margin-top:1rem;margin-right:1rem;padding:.5rem 1rem;color:#fff;background-color:#007bff;border:none;border-radius:5px;cursor:pointer}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]});let n=e;return n})();function WP(n,e){if(n&1&&(q(0,"div",2),B(1),L()),n&2){let t=Qe();Ie(),tn(t.errorMessage)}}function KP(n,e){if(n&1){let t=Sn();q(0,"div",3)(1,"h2"),B(2),L(),q(3,"p")(4,"strong"),B(5,"Description:"),L(),B(6),L(),q(7,"p")(8,"strong"),B(9,"Data:"),L(),B(10),L(),q(11,"p")(12,"strong"),B(13,"Minutes:"),L(),B(14),L(),q(15,"p")(16,"strong"),B(17,"SMS:"),L(),B(18),L(),q(19,"p")(20,"strong"),B(21,"Price:"),L(),B(22),C_(23,"currency"),L(),q(24,"button",4),_e("click",function(){jt(t);let i=Qe();return Bt(i.goToPackages())}),B(25,"Back to Packages"),L(),q(26,"button",4),_e("click",function(){jt(t);let i=Qe();return Bt(i.purchasePackage())}),B(27,"Purchase"),L()()}if(n&2){let t=Qe();Ie(2),tn(t.package.name),Ie(4),Xn(" ",t.package.description,""),Ie(4),Xn(" ",t.package.data," GB"),Ie(4),Xn(" ",t.package.minutes,""),Ie(4),Xn(" ",t.package.sms,""),Ie(4),Xn(" ",S_(23,6,t.package.price),"")}}var C0=(()=>{let e=class e{constructor(r,i,s,o){this.route=r,this.packageService=i,this.router=s,this.authService=o,this.errorMessage="",this.isLoggedIn=!1}ngOnInit(){this.authService.user$.subscribe(i=>{this.isLoggedIn=!!i});let r=this.route.snapshot.paramMap.get("id");r?this.packageService.getPackage(r).subscribe({next:i=>{i&&(this.package=ye(z({},i),{id:r}))},error:i=>{console.error("Error fetching package",i),this.errorMessage=i.message}}):console.error("Package ID is undefined")}goToPackages(){this.router.navigate(["/packages"])}purchasePackage(){this.package?.id?this.isLoggedIn?this.router.navigate(["/confirm-purchase",this.package.id]):this.router.navigate(["/login"]):console.error("Package ID is undefined")}};e.\u0275fac=function(i){return new(i||e)(Z(qt),Z(jl),Z(Te),Z(vt))},e.\u0275cmp=Me({type:e,selectors:[["app-package-detail"]],decls:2,vars:2,consts:[["class","error",4,"ngIf"],["class","package-detail",4,"ngIf"],[1,"error"],[1,"package-detail"],[3,"click"]],template:function(i,s){i&1&&$t(0,WP,2,1,"div",0)(1,KP,28,8,"div",1),i&2&&(je("ngIf",s.errorMessage),Ie(),je("ngIf",s.package))},dependencies:[nn,q_],styles:[".package-detail[_ngcontent-%COMP%]{padding:2rem;background-color:#f9f9f9;border-radius:10px;box-shadow:0 0 10px #0000001a}h2[_ngcontent-%COMP%]{color:#333;margin-bottom:1rem}p[_ngcontent-%COMP%]{color:#555;font-size:1.2rem;margin-bottom:.5rem}p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333}button[_ngcontent-%COMP%]{display:inline-block;margin-top:1rem;margin-right:1rem;padding:.5rem 1rem;color:#fff;background-color:#007bff;border:none;border-radius:5px;cursor:pointer}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]});let n=e;return n})();var V0=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(Z(fo),Z(uo))},e.\u0275dir=yt({type:e});let n=e;return n})(),HP=(()=>{let e=class e extends V0{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Ai(e)))(s||e)}})(),e.\u0275dir=yt({type:e,features:[Qn]});let n=e;return n})(),O0=new re("");var QP={provide:O0,useExisting:ao(()=>Cr),multi:!0};function XP(){let n=Nr()?Nr().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var JP=new re(""),Cr=(()=>{let e=class e extends V0{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!XP())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(Z(fo),Z(uo),Z(JP,8))},e.\u0275dir=yt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&_e("input",function(c){return s._handleInput(c.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(c){return s._compositionEnd(c.target.value)})},features:[go([QP]),Qn]});let n=e;return n})();function br(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function F0(n){return n!=null&&typeof n.length=="number"}var Om=new re(""),L0=new re(""),YP=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,tt=class{static min(e){return ZP(e)}static max(e){return eD(e)}static required(e){return U0(e)}static requiredTrue(e){return tD(e)}static email(e){return nD(e)}static minLength(e){return rD(e)}static maxLength(e){return iD(e)}static pattern(e){return sD(e)}static nullValidator(e){return ql(e)}static compose(e){return G0(e)}static composeAsync(e){return K0(e)}};function ZP(n){return e=>{if(br(e.value)||br(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function eD(n){return e=>{if(br(e.value)||br(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function U0(n){return br(n.value)?{required:!0}:null}function tD(n){return n.value===!0?null:{required:!0}}function nD(n){return br(n.value)||YP.test(n.value)?null:{email:!0}}function rD(n){return e=>br(e.value)||!F0(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function iD(n){return e=>F0(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function sD(n){if(!n)return ql;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(br(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function ql(n){return null}function j0(n){return n!=null}function B0(n){return vc(n)?ge(n):n}function $0(n){let e={};return n.forEach(t=>{e=t!=null?z(z({},e),t):e}),Object.keys(e).length===0?null:e}function q0(n,e){return e.map(t=>t(n))}function oD(n){return!n.validate}function z0(n){return n.map(e=>oD(e)?e:t=>e.validate(t))}function G0(n){if(!n)return null;let e=n.filter(j0);return e.length==0?null:function(t){return $0(q0(t,e))}}function W0(n){return n!=null?G0(z0(n)):null}function K0(n){if(!n)return null;let e=n.filter(j0);return e.length==0?null:function(t){let r=q0(t,e).map(B0);return c_(r).pipe(Y($0))}}function H0(n){return n!=null?K0(z0(n)):null}function S0(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function Q0(n){return n._rawValidators}function X0(n){return n._rawAsyncValidators}function Mm(n){return n?Array.isArray(n)?n:[n]:[]}function zl(n,e){return Array.isArray(n)?n.includes(e):n===e}function R0(n,e){let t=Mm(e);return Mm(n).forEach(i=>{zl(t,i)||t.push(i)}),t}function P0(n,e){return Mm(e).filter(t=>!zl(n,t))}var Gl=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=W0(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=H0(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Ms=class extends Gl{get formDirective(){return null}get path(){return null}},Ba=class extends Gl{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Wl=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},aD={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},NN=ye(z({},aD),{"[class.ng-submitted]":"isSubmitted"}),Vs=(()=>{let e=class e extends Wl{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(Z(Ba,2))},e.\u0275dir=yt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&Uh("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Qn]});let n=e;return n})(),Os=(()=>{let e=class e extends Wl{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(Z(Ms,10))},e.\u0275dir=yt({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&Uh("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[Qn]});let n=e;return n})();var Ua="VALID",Bl="INVALID",xs="PENDING",ja="DISABLED";function Fm(n){return(Xl(n)?n.validators:n)||null}function cD(n){return Array.isArray(n)?W0(n):n||null}function Lm(n,e){return(Xl(e)?e.asyncValidators:n)||null}function uD(n){return Array.isArray(n)?H0(n):n||null}function Xl(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function J0(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new Ee(1e3,"");if(!r[t])throw new Ee(1001,"")}function Y0(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new Ee(1002,"")})}var Ns=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Ua}get invalid(){return this.status===Bl}get pending(){return this.status==xs}get disabled(){return this.status===ja}get enabled(){return this.status!==ja}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(R0(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(R0(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(P0(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(P0(e,this._rawAsyncValidators))}hasValidator(e){return zl(this._rawValidators,e)}hasAsyncValidator(e){return zl(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=xs,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=ja,this.errors=null,this._forEachChild(r=>{r.disable(ye(z({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(ye(z({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ua,this._forEachChild(r=>{r.enable(ye(z({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(ye(z({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ua||this.status===xs)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?ja:Ua}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=xs,this._hasOwnPendingAsyncValidator=!0;let t=B0(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new en,this.statusChanges=new en}_calculateStatus(){return this._allControlsDisabled()?ja:this.errors?Bl:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(xs)?xs:this._anyControlsHaveStatus(Bl)?Bl:Ua}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Xl(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=cD(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=uD(this._rawAsyncValidators)}},Kl=class extends Ns{constructor(e,t,r){super(Fm(t),Lm(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){Y0(this,!0,e),Object.keys(e).forEach(r=>{J0(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var Nm=class extends Kl{};var Z0=new re("CallSetDisabledState",{providedIn:"root",factory:()=>Um}),Um="always";function lD(n,e){return[...e.path,n]}function D0(n,e,t=Um){jm(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),dD(n,e),pD(n,e),fD(n,e),hD(n,e)}function k0(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),Ql(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Hl(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function hD(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function jm(n,e){let t=Q0(n);e.validator!==null?n.setValidators(S0(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=X0(n);e.asyncValidator!==null?n.setAsyncValidators(S0(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();Hl(e._rawValidators,i),Hl(e._rawAsyncValidators,i)}function Ql(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=Q0(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=X0(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return Hl(e._rawValidators,r),Hl(e._rawAsyncValidators,r),t}function dD(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&eT(n,e)})}function fD(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&eT(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function eT(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function pD(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function gD(n,e){n==null,jm(n,e)}function mD(n,e){return Ql(n,e)}function yD(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function _D(n){return Object.getPrototypeOf(n.constructor)===HP}function vD(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function wD(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===Cr?t=s:_D(s)?r=s:i=s}),i||r||t||null}function ED(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function x0(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function M0(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var $l=class extends Ns{constructor(e=null,t,r){super(Fm(t),Lm(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Xl(t)&&(t.nonNullable||t.initialValueIsDefault)&&(M0(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){x0(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){x0(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){M0(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var ID=n=>n instanceof $l;var Fs=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=yt({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})();var tT=new re("");var TD={provide:Ms,useExisting:ao(()=>fi)},fi=(()=>{let e=class e extends Ms{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new en,this._setValidators(r),this._setAsyncValidators(i)}ngOnChanges(r){this._checkFormPresent(),r.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Ql(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(r){let i=this.form.get(r.path);return D0(i,r,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(r),i}getControl(r){return this.form.get(r.path)}removeControl(r){k0(r.control||null,r,!1),ED(this.directives,r)}addFormGroup(r){this._setUpFormContainer(r)}removeFormGroup(r){this._cleanUpFormContainer(r)}getFormGroup(r){return this.form.get(r.path)}addFormArray(r){this._setUpFormContainer(r)}removeFormArray(r){this._cleanUpFormContainer(r)}getFormArray(r){return this.form.get(r.path)}updateModel(r,i){this.form.get(r.path).setValue(i)}onSubmit(r){return this.submitted=!0,vD(this.form,this.directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_updateDomValue(){this.directives.forEach(r=>{let i=r.control,s=this.form.get(r.path);i!==s&&(k0(i||null,r),ID(s)&&(D0(s,r,this.callSetDisabledState),r.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(r){let i=this.form.get(r.path);gD(i,r),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(r){if(this.form){let i=this.form.get(r.path);i&&mD(i,r)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){jm(this.form,this),this._oldForm&&Ql(this._oldForm,this)}_checkFormPresent(){this.form}};e.\u0275fac=function(i){return new(i||e)(Z(Om,10),Z(L0,10),Z(Z0,8))},e.\u0275dir=yt({type:e,selectors:[["","formGroup",""]],hostBindings:function(i,s){i&1&&_e("submit",function(c){return s.onSubmit(c)})("reset",function(){return s.onReset()})},inputs:{form:[bn.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[go([TD]),Qn,Mr]});let n=e;return n})();var AD={provide:Ba,useExisting:ao(()=>pi)},pi=(()=>{let e=class e extends Ba{set isDisabled(r){}constructor(r,i,s,o,c){super(),this._ngModelWarningConfig=c,this._added=!1,this.name=null,this.update=new en,this._ngModelWarningSent=!1,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=wD(this,o)}ngOnChanges(r){this._added||this._setUpControl(),yD(r,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}get path(){return lD(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};e._ngModelWarningSentOnce=!1,e.\u0275fac=function(i){return new(i||e)(Z(Ms,13),Z(Om,10),Z(L0,10),Z(O0,10),Z(tT,8))},e.\u0275dir=yt({type:e,selectors:[["","formControlName",""]],inputs:{name:[bn.None,"formControlName","name"],isDisabled:[bn.None,"disabled","isDisabled"],model:[bn.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[go([AD]),Qn,Mr]});let n=e;return n})();var bD=(()=>{let e=class e{constructor(){this._validator=ql}ngOnChanges(r){if(this.inputName in r){let i=this.normalizeInput(r[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):ql,this._onChange&&this._onChange()}}validate(r){return this._validator(r)}registerOnValidatorChange(r){this._onChange=r}enabled(r){return r!=null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=yt({type:e,features:[Mr]});let n=e;return n})();var CD={provide:Om,useExisting:ao(()=>gi),multi:!0};var gi=(()=>{let e=class e extends bD{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Ci,this.createValidator=r=>U0}enabled(r){return r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Ai(e)))(s||e)}})(),e.\u0275dir=yt({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,s){i&2&&gc("required",s._enabled?"":null)},inputs:{required:"required"},features:[go([CD]),Qn]});let n=e;return n})();var SD=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=He({type:e}),e.\u0275inj=We({});let n=e;return n})(),Vm=class extends Ns{constructor(e,t,r){super(Fm(t),Lm(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){Y0(this,!1,e),e.forEach((r,i)=>{J0(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function N0(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var Ls=(()=>{let e=class e{constructor(){this.useNonNullable=!1}get nonNullable(){let r=new e;return r.useNonNullable=!0,r}group(r,i=null){let s=this._reduceControls(r),o={};return N0(i)?o=i:i!==null&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new Kl(s,o)}record(r,i=null){let s=this._reduceControls(r);return new Nm(s,i)}control(r,i,s){let o={};return this.useNonNullable?(N0(i)?o=i:(o.validators=i,o.asyncValidators=s),new $l(r,ye(z({},o),{nonNullable:!0}))):new $l(r,i,s)}array(r,i,s){let o=r.map(c=>this._createControl(c));return new Vm(o,i,s)}_reduceControls(r){let i={};return Object.keys(r).forEach(s=>{i[s]=this._createControl(r[s])}),i}_createControl(r){if(r instanceof $l)return r;if(r instanceof Ns)return r;if(Array.isArray(r)){let i=r[0],s=r.length>1?r[1]:null,o=r.length>2?r[2]:null;return this.control(i,s,o)}else return this.control(r)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var nT=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:tT,useValue:r.warnOnNgModelWithFormControl??"always"},{provide:Z0,useValue:r.callSetDisabledState??Um}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=He({type:e}),e.\u0275inj=We({imports:[SD]});let n=e;return n})();function RD(n,e){if(n&1&&(q(0,"div",7),B(1),L()),n&2){let t=Qe();Ie(),tn(t.errorMessage)}}var rT=(()=>{let e=class e{constructor(r,i,s){this.fb=r,this.authService=i,this.router=s,this.errorMessage="",this.loginForm=this.fb.group({email:["",[tt.required,tt.email]],password:["",tt.required]})}onSubmit(){if(console.log("Form submitted",this.loginForm.value),this.loginForm.valid){let{email:r,password:i}=this.loginForm.value;this.authService.login(r,i).subscribe({next:()=>{console.log("Login successful"),this.router.navigate(["/profile"])},error:s=>{console.error("Login error",s),this.errorMessage=s.message}})}}};e.\u0275fac=function(i){return new(i||e)(Z(Ls),Z(vt),Z(Te))},e.\u0275cmp=Me({type:e,selectors:[["app-login"]],decls:10,vars:2,consts:[[3,"ngSubmit","formGroup"],["for","email"],["id","email","formControlName","email","required","","type","email"],["for","password"],["id","password","formControlName","password","required","","type","password"],["type","submit"],["class","error",4,"ngIf"],[1,"error"]],template:function(i,s){i&1&&(q(0,"form",0),_e("ngSubmit",function(){return s.onSubmit()}),q(1,"label",1),B(2,"Email"),L(),Oe(3,"input",2),q(4,"label",3),B(5,"Password"),L(),Oe(6,"input",4),q(7,"button",5),B(8,"Login"),L(),$t(9,RD,2,1,"div",6),L()),i&2&&(je("formGroup",s.loginForm),Ie(9),je("ngIf",s.errorMessage))},dependencies:[nn,Fs,Cr,Vs,Os,gi,fi,pi],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}label[_ngcontent-%COMP%]{margin-top:1rem}input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{margin-top:.5rem}button[_ngcontent-%COMP%]{margin-top:1rem;background-color:#007bff;color:#fff;border:none;padding:.5rem 1rem;cursor:pointer}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.error[_ngcontent-%COMP%]{color:red;margin-top:1rem}"]});let n=e;return n})();function PD(n,e){if(n&1&&(q(0,"div",13),B(1),L()),n&2){let t=Qe();Ie(),tn(t.errorMessage)}}var iT=(()=>{let e=class e{constructor(r,i,s){this.fb=r,this.authService=i,this.router=s,this.errorMessage="",this.registerForm=this.fb.group({email:["",[tt.required,tt.email]],password:["",tt.required],name:["",tt.required],phone:["",tt.required],address:["",tt.required]})}onSubmit(){if(console.log("Form submitted",this.registerForm.value),this.registerForm.valid){let{email:r,password:i,name:s,phone:o,address:c}=this.registerForm.value;this.authService.register(r,i,s,o,c).subscribe({next:()=>{console.log("Registration successful"),this.router.navigate(["/login"])},error:u=>{console.error("Registration error",u),this.errorMessage=u.message}})}}};e.\u0275fac=function(i){return new(i||e)(Z(Ls),Z(vt),Z(Te))},e.\u0275cmp=Me({type:e,selectors:[["app-register"]],decls:19,vars:2,consts:[[3,"ngSubmit","formGroup"],["for","email"],["id","email","formControlName","email","required","","type","email"],["for","password"],["id","password","formControlName","password","required","","type","password"],["for","name"],["id","name","formControlName","name","required","","type","text"],["for","phone"],["id","phone","formControlName","phone","required","","type","text"],["for","address"],["id","address","formControlName","address","required","","type","text"],["type","submit"],["class","error",4,"ngIf"],[1,"error"]],template:function(i,s){i&1&&(q(0,"form",0),_e("ngSubmit",function(){return s.onSubmit()}),q(1,"label",1),B(2,"Email"),L(),Oe(3,"input",2),q(4,"label",3),B(5,"Password"),L(),Oe(6,"input",4),q(7,"label",5),B(8,"Name"),L(),Oe(9,"input",6),q(10,"label",7),B(11,"Phone"),L(),Oe(12,"input",8),q(13,"label",9),B(14,"Address"),L(),Oe(15,"input",10),q(16,"button",11),B(17,"Register"),L(),$t(18,PD,2,1,"div",12),L()),i&2&&(je("formGroup",s.registerForm),Ie(18),je("ngIf",s.errorMessage))},dependencies:[nn,Fs,Cr,Vs,Os,gi,fi,pi],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}label[_ngcontent-%COMP%]{margin-top:1rem}input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{margin-top:.5rem}button[_ngcontent-%COMP%]{margin-top:1rem;background-color:#007bff;color:#fff;border:none;padding:.5rem 1rem;cursor:pointer}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.error[_ngcontent-%COMP%]{color:red;margin-top:1rem}"]});let n=e;return n})();var sT=(()=>{let e=class e{constructor(r,i,s){this.fb=r,this.afAuth=i,this.firestore=s,this.userId=null,this.packageName="",this.userProfileForm=this.fb.group({name:["",tt.required],email:[{value:"",disabled:!0},tt.required],phone:["",tt.required],address:["",tt.required],package:[{value:"",disabled:!0}]})}ngOnInit(){this.afAuth.authState.pipe(xe(r=>r?(this.userId=r.uid,this.firestore.collection("users").doc(r.uid).valueChanges()):new Dt),xe(r=>r&&r.package?this.firestore.collection("packages").doc(r.package).valueChanges().pipe(Y(i=>(this.packageName=i.name,r))):new Dt(i=>{i.next(r),i.complete()}))).subscribe(r=>{r&&this.userProfileForm.patchValue({name:r.name,email:r.email,phone:r.phone,address:r.address,package:this.packageName})})}onSave(){this.userProfileForm.valid&&this.userId&&this.firestore.collection("users").doc(this.userId).update(this.userProfileForm.value).then(()=>{alert("Profile updated successfully!")}).catch(r=>{console.error("Error updating profile",r)})}};e.\u0275fac=function(i){return new(i||e)(Z(Ls),Z(un),Z(Ar))},e.\u0275cmp=Me({type:e,selectors:[["app-user-profile"]],decls:18,vars:1,consts:[[3,"ngSubmit","formGroup"],["for","email"],["id","email","formControlName","email","required","","type","email"],["for","package"],["id","package","formControlName","package"],["for","name"],["id","name","formControlName","name","required",""],["for","phone"],["id","phone","formControlName","phone","required",""],["for","address"],["id","address","formControlName","address","required",""],["type","submit"]],template:function(i,s){i&1&&(q(0,"form",0),_e("ngSubmit",function(){return s.onSave()}),q(1,"label",1),B(2,"Email"),L(),Oe(3,"input",2),q(4,"label",3),B(5,"Package"),L(),Oe(6,"input",4),q(7,"label",5),B(8,"Name"),L(),Oe(9,"input",6),q(10,"label",7),B(11,"Phone"),L(),Oe(12,"input",8),q(13,"label",9),B(14,"Address"),L(),Oe(15,"input",10),q(16,"button",11),B(17,"Save"),L()()),i&2&&je("formGroup",s.userProfileForm)},dependencies:[Fs,Cr,Vs,Os,gi,fi,pi],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}label[_ngcontent-%COMP%]{margin-top:1rem}input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{margin-top:.5rem}button[_ngcontent-%COMP%]{margin-top:1rem;background-color:#007bff;color:#fff;border:none;padding:.5rem 1rem;cursor:pointer}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]});let n=e;return n})();var oT=(()=>{let e=class e{constructor(r,i){this.afAuth=r,this.router=i}canActivate(r,i){return this.afAuth.authState.pipe(xt(1),Y(s=>s!=null),Re(s=>{s||this.router.navigate(["/login"])}))}};e.\u0275fac=function(i){return new(i||e)(O(un),O(Te))},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var aT=(()=>{let e=class e{constructor(r,i){this.authService=r,this.router=i}canActivate(r,i){return this.authService.user$.pipe(xt(1),Y(s=>s?(this.router.navigate(["/profile"]),!1):!0))}};e.\u0275fac=function(i){return new(i||e)(O(vt),O(Te))},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var cT=(()=>{let e=class e{constructor(r){this.firestore=r}getUser(r){return this.firestore.collection("users").doc(r).valueChanges().pipe(Y(i=>{if(i)return i;throw new Error("User not found")}),Kn(i=>{throw console.error("Error fetching user:",i),i}))}updateUser(r,i){return this.firestore.collection("users").doc(r).update(i)}};e.\u0275fac=function(i){return new(i||e)(O(Ar))},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var uT=(()=>{let e=class e{constructor(r,i,s,o){this.route=r,this.router=i,this.authService=s,this.userService=o,this.packageId=null,this.userId=null}ngOnInit(){this.packageId=this.route.snapshot.paramMap.get("id"),this.authService.user$.subscribe(r=>{r?this.userId=r.uid:this.router.navigate(["/login"])})}confirmPurchase(){this.packageId&&this.userId&&this.userService.updateUser(this.userId,{package:this.packageId}).then(()=>{alert("Purchase confirmed!"),this.router.navigate(["/profile"])}).catch(r=>{console.error("Error updating user package:",r)})}cancelPurchase(){this.router.navigate(["/packages"])}};e.\u0275fac=function(i){return new(i||e)(Z(qt),Z(Te),Z(vt),Z(cT))},e.\u0275cmp=Me({type:e,selectors:[["app-confirm-purchase"]],decls:8,vars:0,consts:[[3,"click"]],template:function(i,s){i&1&&(q(0,"h2"),B(1,"Confirm Purchase"),L(),q(2,"p"),B(3,"Are you sure you want to purchase this package?"),L(),q(4,"button",0),_e("click",function(){return s.confirmPurchase()}),B(5,"Yes, Confirm"),L(),q(6,"button",0),_e("click",function(){return s.cancelPurchase()}),B(7,"No, Cancel"),L())}});let n=e;return n})();var Jl=(()=>{let e=class e{constructor(){}ngOnInit(){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Me({type:e,selectors:[["app-home"]],decls:34,vars:0,consts:[[1,"welcome-container"],["routerLink","/packages"],["routerLink","/register"]],template:function(i,s){i&1&&(q(0,"div",0)(1,"h1"),B(2,"Welcome to Mobile Package App"),L(),q(3,"p"),B(4," Discover the best mobile packages tailored just for you. Whether you need more data, minutes, or texts, our app has you covered with the latest offers and deals. "),L(),q(5,"h2"),B(6,"Why Choose Us?"),L(),q(7,"ul")(8,"li")(9,"strong"),B(10,"Flexible Packages:"),L(),B(11," Customize your plan to fit your needs and lifestyle. "),L(),q(12,"li")(13,"strong"),B(14,"Affordable Prices:"),L(),B(15," Get the best value for your money with our competitive pricing. "),L(),q(16,"li")(17,"strong"),B(18,"Easy Management:"),L(),B(19," Manage your account and packages effortlessly with our user-friendly interface. "),L(),q(20,"li")(21,"strong"),B(22,"24/7 Support:"),L(),B(23," Our dedicated support team is here to help you anytime, anywhere. "),L()(),q(24,"h2"),B(25,"Get Started"),L(),q(26,"p"),B(27," Ready to find the perfect mobile package? "),q(28,"a",1),B(29,"Browse our packages"),L(),B(30," or "),q(31,"a",2),B(32,"create an account"),L(),B(33," to get personalized recommendations. "),L()())},dependencies:[iw],styles:[".welcome-container[_ngcontent-%COMP%]{text-align:center;padding:2rem;background-color:#f9f9f9;border-radius:10px;box-shadow:0 0 10px #0000001a}h1[_ngcontent-%COMP%]{color:#333;margin-bottom:1rem}p[_ngcontent-%COMP%]{color:#555;font-size:1.2rem;margin-bottom:2rem}h2[_ngcontent-%COMP%]{color:#444;margin-top:2rem}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;text-align:left;max-width:600px;margin:0 auto}li[_ngcontent-%COMP%]{color:#555;font-size:1.1rem;margin-bottom:1rem}li[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333}a[_ngcontent-%COMP%]{color:#007bff;text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]});let n=e;return n})();var Yl=(()=>{let e=class e{constructor(r,i){this.afAuth=r,this.router=i}canActivate(){return this.afAuth.authState.pipe(xt(1),Y(r=>!!r),Re(r=>{r&&this.router.navigate(["/profile"])}),Y(r=>!r))}};e.\u0275fac=function(i){return new(i||e)(O(un),O(Te))},e.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var kD=[{path:"",component:Jl},{path:"packages",component:b0},{path:"package/:id",component:C0},{path:"login",component:rT,canActivate:[Yl]},{path:"register",component:iT,canActivate:[aT]},{path:"confirm-purchase/:id",component:uT},{path:"profile",component:sT,canActivate:[oT]}],lT=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=He({type:e}),e.\u0275inj=We({imports:[Ho.forRoot(kD),Ho]});let n=e;return n})();function xD(n,e){if(n&1){let t=Sn();q(0,"button",0),_e("click",function(){jt(t);let i=Qe();return Bt(i.navigateToLogin())}),B(1,"Login"),L()}}function MD(n,e){if(n&1){let t=Sn();q(0,"button",0),_e("click",function(){jt(t);let i=Qe();return Bt(i.navigateToRegister())}),B(1,"Register"),L()}}function ND(n,e){if(n&1){let t=Sn();q(0,"button",0),_e("click",function(){jt(t);let i=Qe();return Bt(i.navigateToProfile())}),B(1,"Profile"),L()}}function VD(n,e){if(n&1){let t=Sn();q(0,"button",0),_e("click",function(){jt(t);let i=Qe();return Bt(i.logout())}),B(1,"Logout"),L()}}var hT=(()=>{let e=class e{constructor(r,i){this.router=r,this.authService=i,this.isLoggedIn=!1}ngOnInit(){this.authService.user$.subscribe(r=>{this.isLoggedIn=!!r})}navigateToHome(){this.router.navigate(["/"])}navigateToPackages(){this.router.navigate(["/packages"])}navigateToLogin(){this.router.navigate(["/login"])}navigateToRegister(){this.router.navigate(["/register"])}navigateToProfile(){this.router.navigate(["/profile"])}logout(){this.authService.logout().subscribe(()=>{this.router.navigate(["/"])})}};e.\u0275fac=function(i){return new(i||e)(Z(Te),Z(vt))},e.\u0275cmp=Me({type:e,selectors:[["app-header"]],decls:9,vars:4,consts:[[3,"click"],[3,"click",4,"ngIf"]],template:function(i,s){i&1&&(q(0,"nav")(1,"button",0),_e("click",function(){return s.navigateToHome()}),B(2,"Home"),L(),q(3,"button",0),_e("click",function(){return s.navigateToPackages()}),B(4,"Packages"),L(),$t(5,xD,2,0,"button",1)(6,MD,2,0,"button",1)(7,ND,2,0,"button",1)(8,VD,2,0,"button",1),L()),i&2&&(Ie(5),je("ngIf",!s.isLoggedIn),Ie(),je("ngIf",!s.isLoggedIn),Ie(),je("ngIf",s.isLoggedIn),Ie(),je("ngIf",s.isLoggedIn))},dependencies:[nn],styles:["nav[_ngcontent-%COMP%]{display:flex;justify-content:space-around;background-color:#333;padding:1rem}nav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#fff;background:none;border:none;text-decoration:none;padding:.5rem 1rem;cursor:pointer;font-size:1rem}nav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#555}"]});let n=e;return n})();var dT=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Me({type:e,selectors:[["app-footer"]],decls:3,vars:0,template:function(i,s){i&1&&(q(0,"footer")(1,"p"),B(2,"\xA9 2024 Mobile Package Shop"),L()())},styles:["nav[_ngcontent-%COMP%]{display:flex;justify-content:space-around;background-color:#333;padding:.1rem}nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;padding:.05rem .1rem}nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#555}"]});let n=e;return n})();var fT=(()=>{let e=class e{constructor(){this.title="Mobile Package Purchase App"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Me({type:e,selectors:[["app-root"]],decls:4,vars:0,consts:[[1,"content"]],template:function(i,s){i&1&&(Oe(0,"app-header"),q(1,"div",0),Oe(2,"router-outlet"),L(),Oe(3,"app-footer"))},dependencies:[Od,hT,dT],styles:["body[_ngcontent-%COMP%]{margin:0;font-family:Arial,sans-serif}.content[_ngcontent-%COMP%]{padding:20px}"]});let n=e;return n})();var pT="auth",$a=class{constructor(e){return e}},mi=class{constructor(){return Ur(pT)}};var $m=new re("angularfire2.auth-instances");function Fk(n,e){let t=ji(pT,n,e);return t&&new $a(t)}function Lk(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new $a(r)}}var Uk={provide:mi,deps:[[new Ke,$m]]},jk={provide:$a,useFactory:Fk,deps:[[new Ke,$m],tr]};function gT(n,...e){return Je("angularfire",Gt.full,"auth"),Mt([jk,Uk,{provide:$m,useFactory:Lk(n),multi:!0,deps:[de,Zt,cn,nr,[new Ke,St],...e]}])}var mT=Bi(Kh,!0);var qa=class{constructor(e){return e}},yT="firestore",qm=class{constructor(){return Ur(yT)}};var zm=new re("angularfire2.firestore-instances");function Bk(n,e){let t=ji(yT,n,e);return t&&new qa(t)}function $k(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new qa(r)}}var qk={provide:qm,deps:[[new Ke,zm]]},zk={provide:qa,useFactory:Bk,deps:[[new Ke,zm],tr]};function _T(n,...e){return Je("angularfire",Gt.full,"fst"),Mt([zk,qk,{provide:zm,useFactory:$k(n),multi:!0,deps:[de,Zt,cn,nr,[new Ke,mi],[new Ke,St],...e]}])}var vT=Bi(r0,!0);var bT="firebasestorage.googleapis.com",Gk="storageBucket",Wk=2*60*1e3,Kk=10*60*1e3;var En=class n extends Cc{constructor(e,t,r=0){super(Gm(e),`Firebase Storage: ${t} (${Gm(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Gm(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},jn=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(jn||{});function Gm(n){return"storage/"+n}function Hk(){let n="An unknown error occurred, please check the error payload for server response.";return new En(jn.UNKNOWN,n)}function Qk(){return new En(jn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Xk(){return new En(jn.CANCELED,"User canceled the upload/download.")}function Jk(n){return new En(jn.INVALID_URL,"Invalid URL '"+n+"'.")}function Yk(n){return new En(jn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function wT(n){return new En(jn.INVALID_ARGUMENT,n)}function CT(){return new En(jn.APP_DELETED,"The Firebase app was deleted.")}function Zk(n){return new En(jn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}var Un=class n{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=n.makeFromUrl(e,t)}catch{return new n(e,"")}if(r.path==="")return r;throw Yk(e)}static makeFromUrl(e,t){let r=null,i="([A-Za-z0-9.\\-_]+)";function s(W){W.path.charAt(W.path.length-1)==="/"&&(W.path_=W.path_.slice(0,-1))}let o="(/(.*))?$",c=new RegExp("^gs://"+i+o,"i"),u={bucket:1,path:3};function l(W){W.path_=decodeURIComponent(W.path)}let f="v[A-Za-z0-9_]+",p=t.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",E=new RegExp(`^https?://${p}/${f}/b/${i}/o${m}`,"i"),k={bucket:1,path:3},x=t===bT?"(?:storage.googleapis.com|storage.cloud.google.com)":t,D="([^?#]*)",$=new RegExp(`^https?://${x}/${i}/${D}`,"i"),V=[{regex:c,indices:u,postModify:s},{regex:E,indices:k,postModify:l},{regex:$,indices:{bucket:1,path:2},postModify:l}];for(let W=0;W<V.length;W++){let te=V[W],ne=te.regex.exec(e);if(ne){let w=ne[te.indices.bucket],y=ne[te.indices.path];y||(y=""),r=new n(w,y),te.postModify(r);break}}if(r==null)throw Jk(e);return r}},Wm=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function ex(n,e,t){let r=1,i=null,s=null,o=!1,c=0;function u(){return c===2}let l=!1;function f(...D){l||(l=!0,e.apply(null,D))}function p(D){i=setTimeout(()=>{i=null,n(E,u())},D)}function m(){s&&clearTimeout(s)}function E(D,...$){if(l){m();return}if(D){m(),f.call(null,D,...$);return}if(u()||o){m(),f.call(null,D,...$);return}r<64&&(r*=2);let V;c===1?(c=2,V=0):V=(r+Math.random())*1e3,p(V)}let k=!1;function x(D){k||(k=!0,m(),!l&&(i!==null?(D||(c=2),clearTimeout(i),p(0)):D||(c=1)))}return p(0),s=setTimeout(()=>{o=!0,x(!0)},t),x}function tx(n){n(!1)}function nx(n){return n!==void 0}function ET(n,e,t,r){if(r<e)throw wT(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw wT(`Invalid value for '${n}'. Expected ${t} or less.`)}function rx(n){let e=encodeURIComponent,t="?";for(let r in n)if(n.hasOwnProperty(r)){let i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}var Km=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(Km||{});function ix(n,e){let t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||i||s}var Hm=class{constructor(e,t,r,i,s,o,c,u,l,f,p,m=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=u,this.timeout_=l,this.progressCallback_=f,this.connectionFactory_=p,this.retry=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((E,k)=>{this.resolve_=E,this.reject_=k,this.start_()})}start_(){let e=(r,i)=>{if(i){r(!1,new Us(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=c=>{let u=c.loaded,l=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,l)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let c=s.getErrorCode()===Km.NO_ERROR,u=s.getStatus();if(!c||ix(u,this.additionalRetryCodes_)&&this.retry){let f=s.getErrorCode()===Km.ABORT;r(!1,new Us(!1,null,f));return}let l=this.successCodes_.indexOf(u)!==-1;r(!0,new Us(l,s))})},t=(r,i)=>{let s=this.resolve_,o=this.reject_,c=i.connection;if(i.wasSuccessCode)try{let u=this.callback_(c,c.getResponse());nx(u)?s(u):s()}catch(u){o(u)}else if(c!==null){let u=Hk();u.serverResponse=c.getErrorText(),this.errorCallback_?o(this.errorCallback_(c,u)):o(u)}else if(i.canceled){let u=this.appDelete_?CT():Xk();o(u)}else{let u=Qk();o(u)}};this.canceled_?t(!1,new Us(!1,null,!0)):this.backoffId_=ex(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&tx(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},Us=class{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}};function sx(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function ox(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function ax(n,e){e&&(n["X-Firebase-GMPID"]=e)}function cx(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function ux(n,e,t,r,i,s,o=!0){let c=rx(n.urlParams),u=n.url+c,l=Object.assign({},n.headers);return ax(l,e),sx(l,t),ox(l,s),cx(l,r),new Hm(u,n.method,l,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}function lx(n){if(n.length===0)return null;let e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function hx(n){let e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}var qO=256*1024;var Qm=class n{constructor(e,t){this._service=e,t instanceof Un?this._location=t:this._location=Un.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new n(e,t)}get root(){let e=new Un(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return hx(this._location.path)}get storage(){return this._service}get parent(){let e=lx(this._location.path);if(e===null)return null;let t=new Un(this._location.bucket,e);return new n(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw Zk(e)}};function IT(n,e){let t=e?.[Gk];return t==null?null:Un.makeFromBucketSpec(t,n)}function dx(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";let{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:Ac(i,n.app.options.projectId))}var Xm=class{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=bT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Wk,this._maxUploadRetryTime=Kk,this._requests=new Set,i!=null?this._bucket=Un.makeFromBucketSpec(i,this._host):this._bucket=IT(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Un.makeFromBucketSpec(this._url,e):this._bucket=IT(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){ET("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){ET("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return R(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return R(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Qm(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new Wm(CT());{let o=ux(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return R(this,null,function*(){let[r,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()})}},TT="@firebase/storage",AT="0.12.5";var ST="storage";function RT(n=Ri(),e){n=Ce(n);let r=Eo(n,ST).getImmediate({identifier:e}),i=Tc("storage");return i&&PT(r,...i),r}function PT(n,e,t,r={}){dx(n,e,t,r)}function fx(n,{instanceIdentifier:e}){let t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new Xm(t,r,i,e,Rc)}function px(){Vr(new Pn(ST,fx,"PUBLIC").setMultipleInstances(!0)),Je(TT,AT,""),Je(TT,AT,"esm2017")}px();var za=class{constructor(e){return e}},DT="storage",Jm=class{constructor(){return Ur(DT)}};var Ym=new re("angularfire2.storage-instances");function gx(n,e){let t=ji(DT,n,e);return t&&new za(t)}function mx(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new za(r)}}var yx={provide:Jm,deps:[[new Ke,Ym]]},_x={provide:za,useFactory:gx,deps:[[new Ke,Ym],tr]};function kT(n,...e){return Je("angularfire",Gt.full,"gcs"),Mt([_x,yx,{provide:Ym,useFactory:mx(n),multi:!0,deps:[de,Zt,cn,nr,[new Ke,mi],[new Ke,St],...e]}])}var xT=Bi(RT,!0);var vx=(()=>{let e=class e extends kc{constructor(r,i,s){super(r,i,s,Q(pc,{optional:!0}))}ngOnDestroy(){this.flush()}};e.\u0275fac=function(i){return new(i||e)(O(ct),O(Io),O(Dc))},e.\u0275prov=ee({token:e,factory:e.\u0275fac});let n=e;return n})();function wx(){return new X_}function Ex(n,e,t){return new Y_(n,e,t)}var NT=[{provide:Dc,useFactory:wx},{provide:kc,useClass:vx},{provide:bi,useFactory:Ex,deps:[Pi,kc,de]}],MT=[{provide:Io,useFactory:()=>new J_},{provide:lo,useValue:"BrowserAnimations"},...NT],Ix=[{provide:Io,useClass:Q_},{provide:lo,useValue:"NoopAnimations"},...NT],VT=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:r.disableAnimations?Ix:MT}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=He({type:e}),e.\u0275inj=We({providers:MT,imports:[Fc]});let n=e;return n})();var Tx="@",Ax=(()=>{let e=class e{constructor(r,i,s,o,c){this.doc=r,this.delegate=i,this.zone=s,this.animationType=o,this.moduleImpl=c,this._rendererFactoryPromise=null,this.scheduler=Q(pc,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-KV3S2EMJ.js")).catch(i=>{throw new Ee(5300,!1)}).then(({\u0275createEngine:i,\u0275AnimationRendererFactory:s})=>{this._engine=i(this.animationType,this.doc,this.scheduler);let o=new s(this.delegate,this._engine,this.zone);return this.delegate=o,o})}createRenderer(r,i){let s=this.delegate.createRenderer(r,i);if(s.\u0275type===0)return s;typeof s.throwOnSyntheticProps=="boolean"&&(s.throwOnSyntheticProps=!1);let o=new Zm(s);return i?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(c=>{let u=c.createRenderer(r,i);o.use(u)}).catch(c=>{o.use(s)}),o}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};e.\u0275fac=function(i){fc()},e.\u0275prov=ee({token:e,factory:e.\u0275fac});let n=e;return n})(),Zm=class{constructor(e){this.delegate=e,this.replay=[],this.\u0275type=1}use(e){if(this.delegate=e,this.replay!==null){for(let t of this.replay)t(e);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}get destroyNode(){return this.delegate.destroyNode}appendChild(e,t){this.delegate.appendChild(e,t)}insertBefore(e,t,r,i){this.delegate.insertBefore(e,t,r,i)}removeChild(e,t,r){this.delegate.removeChild(e,t,r)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,r,i){this.delegate.setAttribute(e,t,r,i)}removeAttribute(e,t,r){this.delegate.removeAttribute(e,t,r)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,r,i){this.delegate.setStyle(e,t,r,i)}removeStyle(e,t,r){this.delegate.removeStyle(e,t,r)}setProperty(e,t,r){this.shouldReplay(t)&&this.replay.push(i=>i.setProperty(e,t,r)),this.delegate.setProperty(e,t,r)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,r){return this.shouldReplay(t)&&this.replay.push(i=>i.listen(e,t,r)),this.delegate.listen(e,t,r)}shouldReplay(e){return this.replay!==null&&e.startsWith(Tx)}};function OT(n="animations"){return po("NgAsyncAnimations"),Mt([{provide:bi,useFactory:(e,t,r)=>new Ax(e,t,r,n),deps:[ct,Pi,de]},{provide:lo,useValue:n==="noop"?"NoopAnimations":"BrowserAnimations"}])}var FT={production:!1,firebaseConfig:{apiKey:"AIzaSyAWCa26q1qU58EkgdX7LlUq0FyO7YAPd9c",authDomain:"mobilepackageapp.firebaseapp.com",databaseURL:"https://mobilepackageapp-default-rtdb.europe-west1.firebasedatabase.app",projectId:"mobilepackageapp",storageBucket:"mobilepackageapp.appspot.com",messagingSenderId:"179127800679",appId:"1:179127800679:web:7ed81a05edfd5b837b55c2",measurementId:"G-9J4VHPR0KV"}};var LT=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=He({type:e}),e.\u0275inj=We({imports:[Si,Ho.forChild([{path:"",component:Jl}])]});let n=e;return n})();var UT=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=He({type:e,bootstrap:[fT]}),e.\u0275inj=We({providers:[yv(),gT(()=>mT()),_T(()=>vT()),kT(()=>xT()),OT(),Yl],imports:[Fc,lT,Tw.initializeApp(FT.firebaseConfig),nT,VT,Si,LT]});let n=e;return n})();gv().bootstrapModule(UT).catch(n=>console.error(n));
